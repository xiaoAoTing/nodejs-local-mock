<!DOCTYPE html>
<html>

<head lang="zh-CN">
    <meta charset="UTF-8">
    <!-- <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/reset.css"/> -->
    <title>编辑营种商品</title>
    <link href="__PUBLIC__/css//bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/style.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/bootstrap-datetimepicker.min.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/mricode.pagination.css" />
    <link href="__PUBLIC__/css/common.css?v=20190725v=0531" rel="stylesheet">
    <link href="__PUBLIC__/assets/category/iconfont.css?v=<?php echo time();?>" rel="stylesheet">
    <link href="__PUBLIC__/css/selectize.bootstrap3.css" rel="stylesheet">
    <script src="__PUBLIC__/js/jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="__PUBLIC__/js/jquery-migrate-1.0.0.js"></script>
    <script src="__PUBLIC__/js/layer.js"></script>
    <style>
        .gather-li input {
            display: inline-block;
        }

        .cover-swiper div {
            display: inline-block;
            height: 34px;
            padding-top: 7px;
        }

        .imgvi {
            width: 150px;
        }

        .imgvi img {
            width: 150px;
        }

        .addBox {
            position: fixed;
            bottom: 0;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, .1);
            left: 160px;
            right: 0;
            z-index: 100;
            padding: 20px 0 !important;
            background: #fff;
        }

        .tipIco {
            display: inline-block;
            cursor: pointer;
            width: 18px;
            height: 18px;
            border: 1px solid #ccc;
            border-radius: 50%;
            text-align: center;
            line-height: 16px;
            color: #ccc;
            margin-left: 5px;
            font-weight: 700;
        }

        .nick-calendar-tit {
            min-width: 331px;
        }

        #batchPeriodModal .nick-calendar-tit span {
            min-width: 47px
        }

        #batchPeriodModal .nick-calendar-bd {
            min-width: 331px;
        }

        #batchPeriodModal .nick-calendar-bd span {
            min-width: 47px
        }

        .bg-white {
            background: #fff
        }

        .no-border {
            border: 0
        }

        .period-info {
            padding-bottom: 100px;
        }

        #period-con {
            position: relative;
        }

        .period-con-mask {
            width: 100%;
            height: 100%;
            background-color: transparent;
            position: absolute;
            top: 0;
            left: 0;
            cursor: pointer;
            z-index: 99;
            display: none
        }

        .period-con-mask::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 100;
            height: 200px;
            cursor: pointer;
            background: linear-gradient(transparent, #fff);
            /* 标准的语法 */
        }

        .period-con-btn {
            display: none;
            position: absolute;
            cursor: pointer;
            z-index: 100;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100px;
            text-align: center;
            font-size: 18px;
            box-sizing: border-box;
            padding: 30px 0 0 0;
        }

        /* 添加自定义有效期*/

        #yxqbox {
            position: relative;
        }

        .no {
            background-position: -15px, -2px;
        }

        input[name="stock[]"],
        input[name="big_overplus[]"] {
            display: inline-block;
            width: 85%;
        }

        .w300 {
            width: 250px !important;
        }

        .contract_mustread {
            float: left;
            margin-left: 20px;
            height: 34px;
            line-height: 34px;
        }

        .add-contract-box a {
            color: #333;
        }

        .status-period {
            position: absolute;
            left: -12px;
            top: 2px;
            font-size: 14px;
            color: #666;
            transform: rotate(-40deg);
        }

        .typebox .updown {
            width: 20px;
            height: 20px;
            display: inline-block;
            cursor: pointer;
            margin-left: 10px;
        }

        .typebox .updown>img {
            width: 100%;
            height: 100%;
            vertical-align: -5px;
        }

        .imgvis {
            width: 375px;
            position: relative;
        }

        .imgvis #uploadimgfx {
            z-index: 9;
            height: 100%;
        }

        .imgvis #ImgPrfx {
            width: 100%;
        }

        .imgvis input {
            position: absolute;
            bottom: 0;
            left: 0;
            opacity: 0;
            width: 100%;
        }

        #select-nianka .selectize-control {
            display: inline-block;
        }

        .qode {
            width: 120px;
            height: 120px;
            background: url(http://file.dev.xinduobang.cn/headimg/f2d8a2801fba23de23a36477ced5bd57.jpeg) no-repeat;
            background-size: 100% 100%;
            position: absolute;
            top: 80px;
            left: 127px;
            z-index: 10;
            cursor: move;
            /* pointer-events: none; */
        }

        .coor {
            z-index: 11;
            width: 10px;
            height: 10px;
            overflow: hidden;
            cursor: se-resize;
            position: absolute;
            right: 0;
            bottom: 0;
            background-color: #09C;
        }

        #addserviceitem .form-control {
            display: inline-block;
            width: 200px;
        }

        #addserviceitem .form-group {
            margin-bottom: 0;
        }

        .fonticon {
            font-size: 30px;
            font-weight: bold;
            display: inline-block;
            transform: translateY(6px);
            cursor: pointer;
        }

        .float-left {
            float: left;
        }

        .right-nav {
            position: fixed;
            z-index: 1;
            width: 145px;
            top: 0;
            bottom: 0;
            margin: auto;
            right: 50px;
            box-shadow: 0 0 10px #f5f5f5;
            background: #f5f5f5;
        }

        .right-nav-1 {
            height: 86px;
        }

        .right-nav-2 {
            height: 301px;
        }

        .right-nav-link {
            padding-left: 14px;
            display: block;
            height: 43px;
            border-top: 1px solid #f5f5f5;
            line-height: 43px;
            background: #fff;
            color: #c4c4c4;
        }

        .right-nav-link:hover {
            background: #5896d5;
            color: #fff;
        }

        .right-nav-link:focus {
            color: #c4c4c4;
        }

        .right-nav-act {
            background: #5896d5;
            color: #fff;
        }

        .myicon {
            font-size: 20px;
            font-weight: bold;
        }

        #nav-parenting-box,
        .nav-parent {
            display: none;
        }

        #nav-parenting.hidden-title {
            height: 0;
            overflow: hidden;
            padding: 0;
            margin: 0;
            border: none !important;
        }

        .imgvi {
            margin-bottom: 10px
        }

        .show-yanxue,
        .hide-yanxue {
            display: none;
        }

        .bind-school-layer .layui-layer-btn .layui-layer-btn1 {
            border-color: #1E9FFF;
            background-color: #1E9FFF;
            color: #fff;
        }

        .bind-school-layer .layui-layer-btn .layui-layer-btn0 {
            border: 1px solid #dedede;
            background-color: #fff;
            color: #333;
        }

        .selectize-dropdown .option {
            padding: 3px 12px;
            color: #999;
        }

        .selectize-dropdown [data-selectable] {
            color: #333;
        }
        
        .margin0 {
            margin: 0px !important;
        }
    </style>
</head>

<body style="position:relative;">

    <input type="hidden" id="is_show_hide" value="{$is_show_hide}">
    <input type="hidden" value="{$is_axb}" id="is_axb">
    <div class="container courseAdd">
        <include file="./Application/Admin/View/Index/top_new.html" />
        <div class="bottomflex">
            <include file="./Application/Admin/View/Index/left_new.html" />
            <div class="content">
                <ul id="courser-goods-nav" class="nav nav-tabs" role="tablist">
                    <li role="presentation">
                        <a href="__APP__/Admin/CourseGoods/index">营种列表</a>
                    </li>
                    <li role="presentation" class="active">
                        <a href="#CGAdd" role="tab" data-toggle="tab">编辑营种</a>
                    </li>
                </ul>
                <div id="courser-goods-con" class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="CGAdd">
                        <?php
                                if($platform_status){
                                    $dn = 'dn';
                                    $active = 'active';
                                    $txt = 2;
                                }else{
                                    $txt = 3;
                                }
                            ?>
                        <div class="top-tab clearfix">
                            <ul class="nav nav-tabs" role="tablist">
                                <li role="presentation">
                                    <a id="step1-btn" href="#step1" role="tab" data-toggle="tab">1.编辑基本信息</a>
                                </li>
                                <li role="presentation" class="{$dn}">
                                    <a id="step2-btn" href="#step2" role="tab" data-toggle="tab">2.编辑规格期次</a>
                                </li>
                                <li role="presentation" class="">
                                    <a id="step3-btn" href="#step3" role="tab" data-toggle="tab">{$txt}.编辑营销方案</a>
                                </li>
                            </ul>
                        </div>

                        <form id="myform" action="javascript:;" method="post">
                            <div class="tab-con tab-content">
                                <div role="tabpanel" class="tab-pane active" id="step1">
                                    <div class="base-info">
                                        <div class="base-title" id="nav-basic">
                                            <h4>基本信息</h4>
                                        </div>
                                        <div class="form-horizontal">
                                            <div class="form-group">
                                                <!-- ⁎ -->
                                                <label class="col-sm-2 control-label" id="campNameLabel">
                                                    <span class="must">*</span> 营种名称:</label>
                                                <div class="col-sm-3">
                                                    <input type="text" name="cName" value="" class="form-control"
                                                        placeholder="请填写营种名称">
                                                    <input type="hidden" name="cid" value="{$_GET['cid']}">
                                                </div>
                                            </div>
                                            <div class="form-group no9">
                                                <label class="col-sm-2 control-label"
                                                    id="campSecondaryNameLabel">营种副标题:</label>
                                                <div class="col-sm-3">
                                                    <input type="text" name="desc" value="" class="form-control"
                                                        placeholder="请填写营种副标题">
                                                </div>
                                            </div>
                                            <div class="form-group hide-yanxue">
                                                <label class="col-sm-2 control-label"><span class="must">*</span>
                                                    营种分类:</label>

                                                <div class="col-sm-9" id="">
                                                    <select multiple="multiple" class="card-select" id="ctype"></select>
                                                </div>

                                            </div>
                                            <?php
                                            if(((C('DB_NAME_1') == "xiashan") or (C('DB_NAME_1') == "xiashancs") or (C('DB_NAME_1') == "v120") )){
                                      ?>
                                            <div class="form-group hide-yanxue">
                                                <label class="col-sm-2 control-label">营期类型:</label>
                                                <div class="col-sm-2">
                                                    <span class="radio_box r_on">
                                                        <input id="no_moredays_course" type="radio"
                                                            name="is_moredays_course" value="2" class="my_radio"
                                                            checked>
                                                        <label for="no_moredays_course">单日营</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="yes_moredays_course" type="radio"
                                                            name="is_moredays_course" value="1" class="my_radio">
                                                        <label for="yes_moredays_course">多日营</label>
                                                    </span>
                                                </div>
                                            </div>
                                            <?php
                                            }
                                      ?>
                                            <div class="form-group hide-yanxue">
                                                <label class="col-sm-2 control-label"><span class="must">*</span>
                                                    出营类型:</label>
                                                <div class="col-sm-8">
                                                    <span class="radio_box">
                                                        <!-- 默认值为孩子单飞 -->
                                                        <input id="n_product_type" type="radio" name="product_type"
                                                            value="0" checked class="my_radio product_type">
                                                        <label for="n_product_type">单飞</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="y_n_product_type" type="radio" name="product_type"
                                                            value="1" class="my_radio product_type">
                                                        <label for="y_n_product_type">家庭亲子</label>
                                                    </span>
                                                    <span class="radio_box hide">
                                                        <input id="y_product_type" type="radio" name="product_type"
                                                            value="2" class="my_radio product_type">
                                                        <label for="y_product_type">小组竞赛</label>
                                                    </span>
                                                    <span class="radio_box hide">
                                                        <input type="radio" name="product_type" value="3"
                                                            class="my_radio product_type">
                                                        <label>研学</label>
                                                    </span>
                                                    <!--<div class="tipIco" onclick="showTip('如有人购买该营种，此项将不可编辑')">?</div>-->
                                                </div>
                                            </div>
                                            <div class="form-group group-camp hide hide-yanxue">
                                                <label class="col-sm-2 control-label"><span class="must">*</span>
                                                    每组人数:</label>
                                                <div class="col-sm-2">
                                                    <input type="number" name="group_num" value="" class="form-control"
                                                        placeholder="">
                                                </div>
                                            </div>
                                            <?php
                                                    if(in_array(C('yx_appid'),array('TAy1Q9KKsrF','yjdNG3ByMvC'))){
                                                    ?>
                                            <div class="form-group hide-yanxue">
                                                <label class="col-sm-2 control-label">报名审核:</label>
                                                <div class="col-sm-2">
                                                    <span class="radio_box r_on">
                                                        <input id="is_check_close" type="radio" name="is_check"
                                                            value="0" class="my_radio" checked>
                                                        <label for="is_check_close">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="is_check_open" type="radio" name="is_check" value="1"
                                                            class="my_radio">
                                                        <label for="is_check_open">开启</label>
                                                    </span>
                                                </div>
                                            </div>

                                            <?php
                                                        }
                                                    ?>
                                            <div class="form-group {$dn} form_id_box">
                                                <label class="col-sm-2 control-label">
                                                    <span class="must">*</span> 选择报名表:</label>
                                                <div class="col-sm-3 ">
                                                    <select class="form-control" name="form_id" id="form_id"
                                                        style="display: inline-block; width: 60%;">

                                                    </select>
                                                    <i class="fa fa-refresh" style="margin: 0 10px;cursor: pointer;"
                                                        title="刷新数据"></i>
                                                    <a href="/Admin/Set/studentTpl" target="_blank">去设置</a>
                                                </div>
                                            </div>
                                            <div class="form-group no10 hide-yanxue">
                                                <label class="col-sm-2 control-label">
                                                    内部备注表单:</label>
                                                <div class="col-sm-2">
                                                    <select name="mark_form_id" class="form-control" id="mark_form_id">
                                                        <option value="0">请选择</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">
                                                    <span class="must">*</span> 报名合同:
                                                </label>
                                                <div class="col-sm-6">
                                                    <div class="contract-list contract-list-edit" id="contractBox">
                                                    </div>
                                                    <i class="fa fa-refresh" style="margin: 0 10px;cursor: pointer;"
                                                        title="刷新数据"></i>
                                                    <a href="/Admin/set/contractList" target="_blank"
                                                        class="gocontacts">去设置</a>
                                                </div>
                                            </div>
                                            <div class="form-group hide hide-yanxue" id="tyht">
                                                <label class="col-sm-2 control-label">
                                                    退营合同:</label>
                                                <div class="col-sm-2">
                                                    <select name="contract_id2" class="form-control" id="contract_id2">
                                                        <option value="">请选择</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <!-- 退款模板 -->

                                            <div class="form-group hide hide-yanxue" id="tkmb">
                                                <label class="col-sm-2 control-label">
                                                    退款模板:</label>
                                                <div class="col-sm-4">
                                                    <select name="contract_tkmb" class="form-control" id="contract_tkmb"
                                                        style="display: inline-block; width: 45%;">
                                                        <option value="0">请选择</option>
                                                    </select>
                                                    <input type="checkbox" value="0" style="margin-left: 15px;"
                                                        name="zztkmx" id="zztkmx">自助退款免销售审核<img
                                                        src="/Public/images/icon_wenhao.png" onclick="fnOpenWebTitle()"
                                                        style="width:20px ;height:20px ;" />
                                                </div>
                                            </div>



                                            <!-- 退款模板End -->
                                            <div class="form-group hide hide-yanxue" id="hyht">
                                                <label class="col-sm-2 control-label">
                                                    换营合同:</label>
                                                <div class="col-sm-2">
                                                    <select name="contract_id3" class="form-control" id="contract_id3">
                                                        <option value="">请选择</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">电子签章:</label>
                                                <div class="col-sm-6">
                                                    <span class="radio_box">
                                                        <input id="is_seal1" type="radio" name="is_seal" value="0"
                                                            class="my_radio" checked>
                                                        <label for="is_seal1">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="is_seal2" type="radio" name="is_seal" value="1"
                                                            class="my_radio">
                                                        <label for="is_seal2">开启</label>
                                                    </span>
                                                    <div class="tipIco"
                                                        onclick="showTip('开启后，购买此营种的会员可以索取带有电子签章的电子合同')">?</div>
                                                </div>
                                            </div>
                                            <!-- 启程 -->
                                            <div class="form-group no11 hide-yanxue" id="addressGroup">
                                                <label class="col-sm-2 control-label">启程集合地点与时间:</label>
                                                <div class="col-sm-2">
                                                    <span class="radio_box r_on">
                                                        <input id="closeGather" type="radio" name="is_gather" value="0"
                                                            class="my_radio" checked>
                                                        <label for="closeGather">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="openGather" type="radio" name="is_gather" value="1"
                                                            class="my_radio">
                                                        <label for="openGather">开启</label>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="form-group hide no11 hide-yanxue" id="gathersel">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-10">
                                                    启程集合地点选择&nbsp;&nbsp;
                                                    <span class="radio_box r_on">
                                                        <input id="gather_typeprv" type="radio" name="gather_type"
                                                            value="1" checked class="my_radio" />
                                                        <label for="gather_typeprv">报名时选择</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="gather_typenext" type="radio" name="gather_type"
                                                            value="2" class="my_radio" />
                                                        <label for="gather_typenext">开营前选择</label>
                                                    </span>
                                                    <label id="is_sms_gather" class="hide"><input type="checkbox" />
                                                        小程序提醒</label>
                                                </div>
                                            </div>
                                            <div class="form-group no11 hide hide-yanxue" id="gatherBox">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-10">
                                                    <div class="gather-list"></div>
                                                    <div><button type="button" class="btn btn-primary btn-sm"
                                                            id="addGather">添加启程集合地点与时间</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- 返程 -->
                                            <div class="form-group no60 hide-yanxue" id="addressGroup">
                                                <label class="col-sm-2 control-label">返程集合地点与时间:</label>
                                                <div class="col-sm-2">
                                                    <span class="radio_box r_on">
                                                        <input id="e_closeGather" type="radio" name="e_is_gather"
                                                            value="0" class="my_radio" checked>
                                                        <label for="e_closeGather">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="e_openGather" type="radio" name="e_is_gather"
                                                            value="1" class="my_radio">
                                                        <label for="e_openGather">开启</label>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="form-group hide no60 hide-yanxue" id="e_gathersel">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-10">
                                                    返程集合地点选择&nbsp;&nbsp;
                                                    <span class="radio_box r_on">
                                                        <input id="e_gather_typeprv" type="radio" name="e_gather_type"
                                                            value="1" checked class="my_radio" />
                                                        <label for="e_gather_typeprv">报名时选择</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="e_gather_typenext" type="radio" name="e_gather_type"
                                                            value="2" class="my_radio" />
                                                        <label for="e_gather_typenext">开营前选择</label>
                                                    </span>
                                                    <!-- <label id="e_is_sms_gather" class="hide"><input type="checkbox"  /> 小程序提醒</label> -->
                                                </div>
                                            </div>
                                            <div class="form-group hide no60 hide-yanxue" id="e_gatherBox">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-10">
                                                    <div class="e_gather-list"></div>
                                                    <div><button type="button" class="btn btn-primary btn-sm"
                                                            id="e_addGather">添加返程集合地点与时间</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- 返程 -->
                                            <div class="form-group no12 hide-yanxue" id="addressGroup">
                                                <label class="col-sm-2 control-label">活动地点:</label>
                                                <div class="col-sm-2">
                                                    <input class="form-control" type="text" name="address" value="">
                                                </div>
                                            </div>
                                            <div class="form-group no13 hide-yanxue" id="addressGroup">
                                                <label class="col-sm-2 control-label">活动时间:</label>
                                                <div class="col-sm-2">
                                                    <input class="form-control" type="text" name="time_str" value="">
                                                </div>
                                            </div>
                                            <div class="form-group no14 hide-yanxue">
                                                <label class="col-sm-2 control-label">适宜年龄:</label>
                                                <div class="col-sm-3">
                                                    <div class="input-group">
                                                        <input type="text" class="form-control" name="sage"
                                                            value="{$res['sage']}">
                                                        <span class="input-group-addon"
                                                            style="border-left: 0;border-right: 0;">-</span>
                                                        <input type="text" class="form-control" name="eage"
                                                            value="{$res['eage']}">
                                                        <span class="input-group-addon">岁</span>
                                                    </div>
                                                </div>
                                                <span class="col-sm-3 age_show" style="padding-top: 5px;">
                                                    <label class="checkbox-inline pt-0  is_check_age">
                                                        <input type="checkbox" id="is_check_age" name="is_check_age"
                                                            value="1">限制营员年龄必须在此年龄段
                                                </span>
                                                <span class="col-sm-3 age_hide"
                                                    style="padding-top: 5px; display: none;">
                                                    <label class="checkbox-inline pt-0  is_check_age">
                                                        <input type="checkbox" id="is_child_age" name="is_check_age"
                                                            value="2">限制孩子年龄必须在此年龄段
                                                </span>
                                                </label>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">
                                                    <span class="must">*</span> 封面图:</label>
                                                <div class="col-sm-10">
                                                    <span class="imgvi">
                                                        <label>
                                                            <img id="ImgPr6"
                                                                src="https://file.dev.xinduobang.cn/images/chrome-ext/1615368309226876.jpeg" />
                                                            <input type="file" id="uploadimg6" />
                                                            <input class="imgUrl" type="hidden" name="cover_pic"
                                                                value="">
                                                            <font class="hidden">&#10005;</font>
                                                        </label>
                                                    </span>
                                                    <div class="imgview" style="color: red;clear: both;margin: 20px 0;">
                                                        建议尺寸750px*450px，尺寸过大可能会导致小程序崩溃</div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">
                                                    <span class="must">*</span> 轮播图(<span
                                                        id="swiperNo">0</span>/5):</label>
                                                <div class="col-sm-10">
                                                    <div class="pic-box infoImgs">
                                                        <span class="imgvi">
                                                            <label>
                                                                <img
                                                                    src="https://file.dev.xinduobang.cn/images/chrome-ext/1615368309226876.jpeg" />
                                                                <input type="file" />
                                                                <input class="imgUrl" type="hidden" value="">
                                                                <font class="hidden">&#10005;</font>
                                                            </label>
                                                        </span>
                                                    </div>
                                                    <div class="imgview" style="color: red;clear: both;margin: 20px 0;">
                                                        建议尺寸750px*450px，尺寸过大可能会导致小程序崩溃</div>
                                                </div>
                                            </div>
                                            <div class="form-group no15 hide-yanxue" id="video_url">
                                                <label class="col-sm-2 control-label">封面视频:</label>
                                                <div class="col-sm-6">
                                                    <input class="form-control" style="width: 300px;" type="text"
                                                        name="video_url" value="">
                                                    <div style="font-size: 12px;margin-top: 10px;color: #ccc;">
                                                        小程序仅支持视频原始地址，视频网站分享的地址不可用，如需帮助请联系您的专属客户成功</div>
                                                </div>
                                            </div>

                                            <?php
                                                    if($is_et){
                                                ?>
                                            <div class="form-group coverImg hide-yanxue">
                                                <label class="col-sm-2 control-label"><span class="must"></span>
                                                    物料清单:</label>
                                                <div class="col-sm-8">
                                                    <span class="imgvi">
                                                        <label>
                                                            <img id="ImgPr7"
                                                                src="https://file.dev.xinduobang.cn/images/chrome-ext/1615368309226876.jpeg" />
                                                            <input type="file" id="uploadimg7" />
                                                            <input class="imgUrl" type="hidden" name="material_info"
                                                                value="">
                                                            <font class="hidden">&#10005;</font>
                                                        </label>
                                                    </span>
                                                </div>
                                            </div>

                                            <?php
                                                    }
                                                    ?>
                                            <!-- <div class="form-group" id="khdh">
                                                <label class="col-sm-2 control-label">客服电话:</label>
                                                <div class="col-sm-4">
                                                    <div class="input-group" style="position:relative">
                                                        <input class="form-control" placeholder="客服姓名" type="text" name="khdhname" value="{$res['khdh']}">
                                                        <span class="input-group-addon">-</span>
                                                        <input class="form-control" placeholder="客服电话" type="text" name="khdh" value="{$res['khdh']}">
                                                        <span class="input-group-addon">
                                                            <a href="javascript:;" id="addkfdhlist" class="glyphicon glyphicon-plus"></a>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div> -->
                                            <div class="form-group no16 addservice">
                                                <label class="col-sm-2 control-label"><span class="must"></span>
                                                    增值服务:</label>
                                                <div class="col-sm-8">
                                                    <span class="radio_box">
                                                        <input type="radio" name="is_take" value="0" class="my_radio"
                                                            id="off_service" onchange="hideservice()" checked>
                                                        <label for="off_service">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="on_service" type="radio" name="is_take" value="1"
                                                            class="my_radio" onchange="showservice()">
                                                        <label for="on_service">开启</label>
                                                    </span><br>
                                                    <div id="addserviceitem" style="display: none;">
                                                        <div class="form-group ">
                                                            请选择分类
                                                            <select class="form-control types">
                                                                <option>请选择分类</option>
                                                            </select>
                                                            <input class="form-control typesname" placeholder="请输入展示名称">
                                                            <span class="fonticon" onclick="addtype(event)">+</span>
                                                            <span class="fonticon" onclick="removetype(event)">-</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group no17 coverImg hide-yanxue">
                                                <label class="col-sm-2 control-label"><span class="must"></span><span
                                                        class="weixins">微信群二维码:</span> </label>
                                                <div class="col-sm-8">
                                                    <span class="imgvi">
                                                        <label>
                                                            <img id="ImgPr8"
                                                                src="https://file.dev.xinduobang.cn/images/chrome-ext/1615368309226876.jpeg" />
                                                            <input type="file" id="uploadimg8" />
                                                            <input class="imgUrl" type="hidden" name="wechat_code"
                                                                value="">
                                                            <font class="hidden">&#10005;</font>
                                                        </label>
                                                    </span>
                                                    <span>小程序咨询时显示，请注意群二维码的7天有效期，及时更换</span>
                                                </div>
                                            </div>
                                            <div class="form-group no18 hide-yanxue">
                                                <label class="col-sm-2 control-label">客服电话:</label>
                                                <div class="col-sm-6" id="khdhlistbox">
                                                    <div class="input-group mb-10" style="position:relative">
                                                        <input class="form-control" placeholder="客服姓名" type="text"
                                                            name="khdhlistname[]" value="">
                                                        <span class="input-group-addon">-</span>
                                                        <input class="form-control" placeholder="客服电话" type="text"
                                                            name="khdhliststr[]" value="">
                                                        <span class="input-group-addon">
                                                            <a href="javascript:;"
                                                                class="additem glyphicon glyphicon-plus"></a>
                                                        </span>
                                                    </div>
                                                    <!-- <input class="phone form-control" type="text" name="phone" placeholder="&nbsp;客服电话" value=""> -->
                                                </div>
                                            </div>
                                            <div class="form-group no19 hide-yanxue">
                                                <label class="col-sm-2 control-label">TAG标签:</label>
                                                <div class="col-sm-9" id="">
                                                    <select multiple="multiple" class="card-select"
                                                        id="tagSelect"></select>
                                                </div>
                                                <input type="hidden" name="tagname" />
                                            </div>
                                            <div class="form-group hide-yanxue">
                                                <label class="col-sm-2 control-label">提醒标签:</label>
                                                <div class="col-sm-10" style="padding-right: 0;">
                                                    <span class="radio_box">
                                                        <input id="default_remind" type="radio" name="is_remind_tag"
                                                            value="0" class="my_radio" checked>
                                                        <label for="default_remind">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="custom_remind" type="radio" name="is_remind_tag"
                                                            value="1" class="my_radio">
                                                        <label for="custom_remind">开启</label>
                                                    </span>
                                                    <div class="tipIco"
                                                        onclick="showTip(`此标签为营种列表的第一个标签和营种详情页中部的标签，且可以对此标签进行解释，可以展示一些用于提醒用户此商品“退换无忧”等类似的标签，如图所示：<br><br><img src='http://file.dev.xinduobang.cn/headimg/58bdc37eddaaf2373c260620046efc63.png?imageView2/2/w/320' /><br><img src='http://file.dev.xinduobang.cn/headimg/8c4a5dd6c4a1cd2d49c8f44b9806a8dc.png?imageView2/2/w/320' />`)">
                                                        ?</div>
                                                </div>
                                            </div>
                                            <div class="form-group remind-show hide hide-yanxue">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-3" style="padding-right: 0;">
                                                    <label class="control-label col-sm-3"><span class="must">*</span>
                                                        标签标题：</label>
                                                    <input type="text" maxlength="6"
                                                        style="display: inline-block;width: 65%;" class="form-control"
                                                        name="remind_tit" placeholder="例：退换无忧">
                                                </div>
                                            </div>
                                            <div class="form-group remind-show hide hide-yanxue">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-3" style="padding-right: 0;">
                                                    <label class="control-label col-sm-3">标题字号：</label>
                                                    <input type="text" maxlength="2"
                                                        style="display: inline-block;width: 65%;" class="form-control"
                                                        name="remind_tit_size" placeholder="单位：像素" value="30">
                                                </div>
                                            </div>
                                            <div class="form-group remind-show hide hide-yanxue">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-3" style="padding-right: 0;">
                                                    <label class="control-label col-sm-3">标签副标题：</label>
                                                    <input type="text" maxlength="15"
                                                        style="display: inline-block;width: 65%;" class="form-control"
                                                        name="remind_subtit" placeholder="最多输入15个字符">
                                                </div>
                                            </div>
                                            <div class="form-group remind-show hide hide-yanxue">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-3" style="padding-right: 0;">
                                                    <label class="control-label col-sm-3">副标题字号：</label>
                                                    <input type="text" maxlength="2"
                                                        style="display: inline-block;width: 65%;" class="form-control"
                                                        name="remind_subtit_size" placeholder="单位：像素" value="26">
                                                </div>
                                            </div>
                                            <div class="form-group remind-show hide hide-yanxue">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-3" style="padding-right: 0;">
                                                    <label class="control-label col-sm-3"
                                                        style="vertical-align: middle">标签图标：</label>
                                                    <div style="display: inline-block">
                                                        <span class="imgvi"
                                                            style="width: 70px;height: 70px;border: 1px solid #999;">
                                                            <label style="width: 70px;height: 70px;">
                                                                <img id="ImgRemind"
                                                                    src="http://file.dev.xinduobang.cn/headimg/6b1be3ea99aaa09032ca049a953105c3.png"
                                                                    style="width: 70px;height: 70px;" />
                                                                <input type="file" id="upload_remind" />
                                                                <input class="imgUrl" type="hidden" name="remind_icon"
                                                                    value="http://file.dev.xinduobang.cn/headimg/6b1be3ea99aaa09032ca049a953105c3.png">
                                                                <font class="" id="remind-font">&#10005;</font>
                                                            </label>
                                                        </span>
                                                        <span>建议尺寸15px*18px</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group remind-show hide hide-yanxue">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-3" style="padding-right: 0;">
                                                    <label class="control-label col-sm-3"
                                                        style="vertical-align: middle">文字颜色：</label>
                                                    <div style="display: inline-block">
                                                        <input type="text" id="remindText" name="remind_color">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group remind-show hide hide-yanxue">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-3" style="padding-right: 0;">
                                                    <label class="control-label col-sm-3"
                                                        style="vertical-align: middle">背景颜色：</label>
                                                    <div style="display: inline-block">
                                                        <input type="text" id="remindBg" name="remind_bg_color">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group remind-show hide hide-yanxue">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-3" style="padding-right: 0;">
                                                    <label class="control-label col-sm-3"
                                                        style="float: left;">标签点击：</label>
                                                    <span class="radio_box">
                                                        <input id="default_remind_tap" type="radio" name="remind_tap"
                                                            value="0" class="my_radio" checked>
                                                        <label for="default_remind_tap">文字解释</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="custom_remind_tap" type="radio" name="remind_tap"
                                                            value="1" class="my_radio">
                                                        <label for="custom_remind_tap">跳转链接</label>
                                                    </span>
                                                    <div class="col-sm-offset-3" id="remind_tap_form"
                                                        style="width: 65%;">
                                                        <div>
                                                            <textarea name="remind_text" class="form-control"
                                                                placeholder="营种详情页最多外漏一行字符，点击详情可展示更多内容"
                                                                style="height: 100px;" id="remind_text"></textarea>
                                                        </div>
                                                        <div class="hide">
                                                            <input type="text" maxlength="100" class="form-control"
                                                                name="remind_tap_path" placeholder="小程序路径，请以 / 开头">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">排序:</label>
                                                <div class="col-sm-3">
                                                    <input class="form-control" type="text" name="weight" value=""
                                                        style="display: inline-block;width:200px;">
                                                    <div class="tipIco" onclick="showTip('序号越大，在小程序端展示的排列越靠前')">?</div>
                                                </div>

                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">提醒公告:</label>
                                                <div class="col-sm-8" style="padding-right: 0;">
                                                    <span class="radio_box">
                                                        <input type="radio" name="on_off_notice" value="0"
                                                            class="my_radio" id="off_notice" checked>
                                                        <label for="off_notice">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="on_notice" type="radio" name="on_off_notice"
                                                            value="1" class="my_radio">
                                                        <label for="on_notice">开启</label>
                                                    </span>
                                                </div>
                                                <div class="notice_detail_box col-sm-offset-2"
                                                    style="display: none;clear: both;padding-left: 20px">
                                                    公告内容: &nbsp; <div class="notice_detail"
                                                        style="display: inline-block;">
                                                        <input type="text" style="display: inline-block;"
                                                            name="notice_content" class="form-control"
                                                            placeholder="请输入公告内容">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group no57">
                                                <label class="col-sm-2 control-label">立即报名按钮:</label>
                                                <div class="col-sm-10" style="padding-right: 0;">
                                                    <span class="radio_box r_on">
                                                        <input id="default_sign" type="radio" name="registed" value="0"
                                                            class="my_radio" checked>
                                                        <label for="default_sign">默认样式</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="custom_sign" type="radio" name="registed" value="1"
                                                            class="my_radio">
                                                        <label for="custom_sign">自定义样式</label>
                                                    </span>
                                                    <div class="tipIco" onclick="showTip('小程序营种详情页的立即报名按钮自定义样式和文案')">?
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group sign-show hide no57">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-3" style="padding-right: 0;">
                                                    <label class="control-label">按钮文案:</label>
                                                    <input type="text" style="display: inline-block;width: 65%;"
                                                        class="form-control" name="btn-text" maxlength="10">
                                                    <div class="tipIco" onclick="showTip('最长10个字')">?</div>
                                                </div>
                                            </div>
                                            <div class="form-group sign-show hide no57">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-2" style="padding-right: 0;">
                                                    <label class="control-label"
                                                        style="vertical-align: middle">背景颜色:</label>
                                                    <div style="display: inline-block">
                                                        <input type="text" id="signBg">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group sign-show hide no57">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-2" style="padding-right: 0;">
                                                    <label class="control-label"
                                                        style="vertical-align: middle">文字颜色:</label>
                                                    <div style="display: inline-block">
                                                        <input type="text" id="signText">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group no10 hide">
                                                <label class="col-sm-2 control-label">
                                                    所属板块:</label>
                                                <div class="col-sm-2">
                                                    <select name="bk_id" class="form-control">
                                                        <option value="0">请选择</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group no10 hide">
                                                <label class="col-sm-2 control-label">
                                                    所属产品:</label>
                                                <div class="col-sm-2">
                                                    <select name="bk_product_id" class="form-control">
                                                        <option value="0">请选择</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="course-info">
                                        <div class="base-title" id="nav-detail">
                                            <h4>营种详情</h4>
                                        </div>
                                        <div class="form-horizontal">
                                            <div class="form-group show-yanxue">
                                                <label class="col-sm-2 control-label">使用说明:</label>
                                                <div class="col-sm-6">
                                                    <span class="radio_box">
                                                        <input id="is_no_use_desc" type="radio" name="is_show_use"
                                                            value="0" class="my_radio">
                                                        <label for="is_no_use_desc">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="is_use_desc" type="radio" name="is_show_use"
                                                            value="1" class="my_radio" checked>
                                                        <label for="is_use_desc">开启</label>
                                                    </span>
                                                    <div class="tipIco" onclick="showTip('yanxueUseDesc')">?</div>
                                                </div>
                                            </div>
                                            <div class="form-group hide-yanxue">
                                                <label class="col-sm-2 control-label"><span
                                                        class="must"></span>选择导师:</label>
                                                <div class="col-sm-10">
                                                    <div></div>
                                                    <select class="clearfix" id="major-body" multiple=""
                                                        style="width: 170px">

                                                    </select>
                                                    <input type="hidden" name="majorId" value="{$res['battalionid']}">
                                                </div>
                                            </div>
                                            <div class="form-group hide-yanxue">
                                                <label class="col-sm-2 control-label"><span
                                                        class="must"></span>简版行程:</label>
                                                <div class="col-sm-10">
                                                    <div class="form-group">
                                                        <label class="col-sm-1 control-label">时长:</label>
                                                        <div class="col-sm-4">
                                                            <div class="input-group">
                                                                <input type="text" class="form-control" name="days"
                                                                    value="0">
                                                                <span class="input-group-addon">天</span>
                                                                <input type="text" class="form-control" name="night"
                                                                    value="0">
                                                                <span class="input-group-addon">夜</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-1 control-label">简版行程:</label>
                                                        <div class="col-sm-9">
                                                            <table class="subtable">
                                                                <tr class="title">
                                                                    <td>标题</td>
                                                                    <td>清晨</td>
                                                                    <td>上午</td>
                                                                    <td>下午</td>
                                                                    <td>晚上</td>
                                                                </tr>

                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label"><span
                                                        class="must"></span>产品详情:</label>
                                                <div class="col-sm-10">
                                                    <span class="radio_box show-yanxue">
                                                        <input id="is_no_use_info" type="radio" name="is_show_detail"
                                                            value="0" class="my_radio" checked>
                                                        <label for="is_no_use_info">关闭</label>
                                                    </span>
                                                    <span class="radio_box show-yanxue">
                                                        <input id="is_use_info" type="radio" name="is_show_detail"
                                                            value="1" class="my_radio">
                                                        <label for="is_use_info">开启</label>
                                                    </span>
                                                    <div class="form-group">
                                                        <div class="col-sm-9">
                                                            <div name="info" id="textarea1" style="width: 500px;"
                                                                class="hide">
                                                                {:stripslashes($data['info'])}</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group hide-yanxue">
                                                <label class="col-sm-2 control-label"><span
                                                        class="must"></span>用户须知:</label>
                                                <div class="col-sm-10">
                                                    <div class="form-group">
                                                        <div class="col-sm-9">
                                                            <div name="notice" id="textarea2" style="width: 500px;">
                                                                {:stripslashes($data['notice'])}</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="height: 74px"></div>
                                    <div class="right-nav right-nav-1">
                                        <a class="right-nav-link right-nav-act" href="#nav-basic"
                                            onclick="actNav(event)">● 基本信息</a>
                                        <a class="right-nav-link" href="#nav-detail" onclick="actNav(event)">● 营种详情</a>
                                    </div>
                                    <?php
                                            if($platform_status){
                                        ?>
                                    <div class="addBox btn-box">
                                        <button type="button"
                                            class="btn btn-large btn-primary step2-next-btn">下一步</button>
                                        <button type="button"
                                            class="btn btn-large btn-primary save-btn mr15 hide-yanxue">保存</button>
                                        <button type="button"
                                            class="btn btn-large btn-success save-up-btn1 mr15 hide-yanxue">保存并公开售卖</button>
                                        <button type="button"
                                            class="btn btn-large btn-success save-up-btn2 hide-yanxue">保存并非公开售卖</button>
                                        <button type="button"
                                            class="btn btn-large btn-success save-up-btn3 hide-yanxue">保存并预览</button>
                                    </div>
                                    <?php
                                            }else{
                                        ?>
                                    <div class="addBox btn-box">
                                        <button type="button" class="btn btn-large btn-primary next-btn">下一步</button>
                                        <button type="button"
                                            class="btn btn-large btn-primary save-btn mr15 hide-yanxue">保存</button>
                                        <button type="button"
                                            class="btn btn-large btn-success save-up-btn1 mr15 hide-yanxue">保存并公开售卖</button>
                                        <button type="button"
                                            class="btn btn-large btn-success save-up-btn2 hide-yanxue">保存并非公开售卖</button>
                                        <button type="button"
                                            class="btn btn-large btn-success save-up-btn3 hide-yanxue">保存并预览</button>
                                    </div>
                                    <?php
                                            }
                                        ?>
                                </div>

                                <div role="tabpanel" class="tab-pane" id="step2">
                                    <div class="spec-info hide-yanxue">
                                        <div class="base-title">
                                            <h4>营种规格</h4>
                                        </div>
                                        <div class="form-group clearfix">
                                            <div>
                                                <span class="radio_box">
                                                    <input id="noSpec" type="radio" checked name="is_sku" value="0"
                                                        class="my_radio">
                                                    <label for="noSpec">无规格&nbsp;&nbsp;&nbsp;&nbsp;</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="hasSpec" type="radio" name="is_sku" value="1"
                                                        class="my_radio">
                                                    <label for="hasSpec">多规格&nbsp;&nbsp;&nbsp;&nbsp;</label>
                                                </span>
                                                <button type="button"
                                                    class="btn btn-xs btn-primary addSku hidden">添加规格项目</button>
                                                <span class="edit-tips hidden" style="color: red;">
                                                    当前营种已有售出或已同步渠道,不可编辑规格</span>
                                            </div>
                                            <div class="spec-box skuCon hidden">
                                                <div class="skuInfo">

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="period-info">
                                        <div class="base-title">
                                            <h4 class="clearfix">
                                                <div style="float:left;">期次配置 &nbsp;&nbsp;&nbsp;&nbsp;</div>
                                                <div style="float:left; font-weight: 400;font-size: 14px;"
                                                    class="hide-yanxue">
                                                    <input style="vertical-align: -2px;" class="calendar-flag"
                                                        type="checkbox" /> 按照日历形式展示
                                                </div>
                                                <button type="button" style="float:right;"
                                                    class="btn btn-large btn-primary delBatchPeriod">批量删除营期</button>
                                                <button type="button" style="float:right;"
                                                    class="btn btn-large btn-primary addBatchPeriod mr15">批量添加营期</button>
                                                <button type="button" style="float:right;"
                                                    class="btn btn-large btn-primary addPeriod mr15">增加期次</button>
                                                <button type="button" style="float:right;"
                                                    class="btn btn-large btn-primary hidePeriod mr15 hide-yanxue">隐藏营期</button>
                                            </h4>
                                        </div>
                                        <div id="period-con">
                                            <div class="period-con">
                                                <div class="period-item form-horizontal">
                                                    <span class="del-period hidden" data-id="1">&#10005;</span>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">
                                                            <span class="must">*</span> 营种期次:
                                                        </label>
                                                        <div class="col-sm-10">
                                                            <input type="hidden" class="form-control" name="id[]"
                                                                value="">
                                                            <input type="text"
                                                                class="datepicker datepicker1 form-control dataBox range-time1"
                                                                name="sTime[]" id="text1"
                                                                value="" />&nbsp;&nbsp;期次名称:&nbsp;&nbsp;<input
                                                                style="width: 20%;" type="text"
                                                                class="form-control dataBox"
                                                                name="pername[]" />&nbsp;&nbsp;<span
                                                                class="must">*</span> 报名截止时间:&nbsp;&nbsp;<input
                                                                type="text" class="form-control dataBox enroll-time1"
                                                                name="bTime[]" id="text2" value="" />
                                                        </div>
                                                    </div>
                                                    <div class="form-group hide-yanxue">
                                                        <label class="col-sm-2 control-label"> 支付截止时间:</label>
                                                        <div class="col-sm-10">
                                                            <input type="text" class="form-control dataBox payendtime1"
                                                                name="payendtime[]" id="payendtime" value="" />
                                                        </div>
                                                    </div>
                                                    <div class="form-group spec-stock-box">
                                                        <label class="col-sm-2 control-label">
                                                            <span class="must">*</span>
                                                            <span class="stock-name">库存</span>:
                                                        </label>
                                                        <div class="col-sm-2">
                                                            <input type="text" class="form-control" name="stock[]"
                                                                value="0">
                                                        </div>
                                                        <span class="big_overplus_box hide">
                                                            <label class="col-sm-2 control-label"><span
                                                                    class="must">*</span> 成人库存:</label>
                                                            <div class="col-sm-2">
                                                                <input type="text" class="form-control"
                                                                    name="big_overplus[]" value="0">
                                                            </div>
                                                            <label class="col-sm-2 control-label">
                                                                <input type="checkbox" name="" class="is_max" value="0">
                                                                <input type="hidden" name="is_max[]" value="0">亲子总库存:
                                                                <div class="tipIco help">?</div>
                                                            </label>
                                                            <div class="col-sm-2">
                                                                <input type="text" readonly class="form-control"
                                                                    name="limit_overplus[]" value="0">
                                                            </div>
                                                        </span>
                                                    </div>
                                                    <div class="form-group sku-stock-box hidden">
                                                        <label class="col-sm-2 control-label"><span
                                                                class="must">*</span> 库存:</label>
                                                        <div class="col-sm-7">
                                                            <div>
                                                                <div class="createTable"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group hide is_total">
                                                        <label class="col-sm-1 col-sm-offset-1 control-label"> <input
                                                                type="checkbox" class="istotal" /> 规格总库存:</label>
                                                        <div class="col-sm-2">
                                                            <input type="text" disabled class="form-control totalnum"
                                                                value="">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label
                                                            class="col-sm-2 control-label yanxue-is-power">销量:</label>
                                                        <div class="col-sm-10">
                                                            <input type="text"
                                                                class="form-control hide-yanxue hide-yanxue-inline-block"
                                                                value="" name="sale_num[]"
                                                                style="width: 20%;display: inline-block;">
                                                            <div class="tipIco hide-yanxue hide-yanxue-inline-block"
                                                                style="cursor: pointer;"
                                                                onclick="showTip('填写此项后不会影响真正的库存，只会在用户端显示该销量')">?</div>
                                                            <label
                                                                class="hide-yanxue hide-yanxue-inline-block">&nbsp;&nbsp;剩余库存:&nbsp;&nbsp;</label><input
                                                                type="text"
                                                                class="form-control hide-yanxue hide-yanxue-inline-block"
                                                                value="" name="leaft_num[]"
                                                                style="width: 20%;display: inline-block;">
                                                            <div class="tipIco hide-yanxue hide-yanxue-inline-block"
                                                                style="cursor: pointer;"
                                                                onclick="showTip('填写此项后不会影响真正的库存，只会在用户端显示该剩余库存')">?
                                                            </div>
                                                            <label
                                                                class="hide-yanxue hide-yanxue-inline-block">&nbsp;&nbsp;权重:&nbsp;&nbsp;</label><input
                                                                type="text" class="form-control" value="" name="power[]"
                                                                style="width: 20%;display: inline-block;">&nbsp;&nbsp;
                                                            <div class="tipIco" style="cursor: pointer;"
                                                                onclick="showTip('数字越大排名越靠前')">?</div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                            <div class="period-con-mask" title="点击查看更多"></div>
                                            <div class="period-con-btn">
                                                <span>点击查看更多</span>
                                                <p><i class="glyphicon glyphicon-menu-down"></i></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="addBox btn-box">
                                        <button type="button"
                                            class="btn btn-large btn-default prev-btn mr15">上一步</button>
                                        <button type="button"
                                            class="btn btn-large btn-primary step2-next-btn">下一步</button>
                                        <button type="button"
                                            class="btn btn-large btn-primary save-btn mr15 hide-yanxue">保存</button>
                                        <button type="button"
                                            class="btn btn-large btn-success save-up-btn1 mr15 hide-yanxue">保存并公开售卖</button>
                                        <button type="button"
                                            class="btn btn-large btn-success save-up-btn2 hide-yanxue">保存并非公开售卖</button>
                                        <button type="button"
                                            class="btn btn-large btn-success save-up-btn3 hide-yanxue">保存并预览</button>
                                    </div>
                                </div>

                                <div role="tabpanel" class="tab-pane" id="step3">
                                    <div class="form-horizontal price-info no20">
                                        <div class="base-title" id="nav-sale">
                                            <h4>价格配置</h4>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label price-type" data-type="1"
                                                style="text-align: right;padding-top: 7px;">统一定价:</label>
                                            <div class="col-sm-10">
                                                <a href="javascript:;" class="batch-price hide"> 批量设置价格 </a>
                                                <div class="price-table">
                                                    <div class="noSpec-box">
                                                        <span class="noSpec-box-price margin0" style="margin: 0px">
                                                            <span class="price-name"></span>
                                                            <input type="text" class="form-control" name="price">
                                                            <span class="big_price_box hide hide-yanxue">
                                                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 成人价格
                                                                <input type="text" class="form-control"
                                                                    name="big_price">
                                                            </span>
                                                        </span>
                                                    </div>
                                                    <div class="hasSpec-table hide">
                                                        <div>
                                                            <div>
                                                                <div class="createTablePrice"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group no24 hide-yanxue" style="clear: both;">
                                            <label class="col-sm-2 control-label destine-type"
                                                style="text-align: right;padding-top: 7px;">预定价格:</label>
                                            <div class="col-sm-10">
                                                <span class="radio_box">
                                                    <input id="nodestine" type="radio" name="is_pre_order" value="0"
                                                        class="my_radio" checked>
                                                    <label for="nodestine">关闭&nbsp;&nbsp;&nbsp;&nbsp;</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="hasdestine" type="radio" name="is_pre_order" value="1"
                                                        class="my_radio">
                                                    <label for="hasdestine">开启&nbsp;&nbsp;&nbsp;&nbsp;</label>
                                                </span>
                                                <a href="javascript:;" class="batch-destine hide"> 批量设置<span
                                                        class="dingjintext"></span>金额</a>
                                                <!-- <div class="tipIco" onclick="showTip('小组营种不支持预定')">?</div> -->
                                                <div class="destine-table hide">
                                                    <table class="table table-bordered table-hover">
                                                        <thead>
                                                            <tr>
                                                                <th>营期期次</th>
                                                                <th><span class="dingjintext"></span>金额(元)</th>
                                                                <th>订购截止时间</th>
                                                                <th>开始支付尾款时间</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr class="destineTR1">
                                                                <td> --- </td>
                                                                <td>
                                                                    <input type="text" name="deposit[]"
                                                                        class="form-control destine-price-ipt input-sm"
                                                                        value="">
                                                                </td>
                                                                <td>
                                                                    <input type="text" name="deposit_time[]"
                                                                        class="form-control destine-time input-sm"
                                                                        value="">
                                                                </td>
                                                                <td>
                                                                    <input type="text" name="retainage_time[]"
                                                                        class="form-control destine-time input-sm"
                                                                        value="">
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group no25" style="clear: both;">
                                            <label class="col-sm-2 control-label destine-type"
                                                style="text-align: right;padding-top: 7px;">显示价格:</label>
                                            <div class="col-sm-10">
                                                <span class="radio_box">
                                                    <input id="countprice" type="radio" name="price_show_type"
                                                        onchange="hideDesc()" value="0" class="my_radio" checked>
                                                    <label for="countprice">系统自动计算&nbsp;&nbsp;&nbsp;&nbsp;</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="myprice" type="radio" name="price_show_type"
                                                        onchange="showDesc()" value="1" class="my_radio">
                                                    <label for="myprice">自定义&nbsp;&nbsp;&nbsp;&nbsp;</label>
                                                </span>
                                                <span id="priceshowdesc" style="display: none">
                                                    <input class="form-control" style="display: inline;width: 200px;"
                                                        type="text" name="show_price" placeholder="请输入想要显示的价格内容">
                                                    <div class="tipIco"
                                                        onclick="showTip('显示位置为小程序首页产品列表、营种列表页、营种详情页头部和报名按钮处显示的价格')">?
                                                    </div>
                                                </span>
                                            </div>
                                        </div>
                                        <script type="text/javascript">
                                            function hideDesc() {
                                                $('#priceshowdesc').hide()
                                            }

                                            function showDesc() {
                                                $('#priceshowdesc').show()
                                            }
                                        </script>
                                        <div class="form-group no26 hide-yanxue" style="clear: both;">
                                            <label class="col-sm-2 control-label destine-type"
                                                style="text-align: right;padding-top: 7px;">价格备注:</label>
                                            <div class="col-sm-10">
                                                <span class="radio_box">
                                                    <input id="other_price" type="text" name="other_price" value=""
                                                        class="form-control" style="display: inline;width: 200px;">
                                                </span>
                                            </div>
                                        </div>
                                        <div class="form-group no26 hide-yanxue" style="clear: both;">
                                            <label class="col-sm-2 control-label destine-type"
                                                style="text-align: right;padding-top: 7px;">划线价:</label>
                                            <div class="col-sm-10">
                                                <span class="radio_box">
                                                    <input id="line_price" type="text" name="line_price" value=""
                                                        class="form-control" style="display: inline;width: 200px;">
                                                </span>
                                            </div>
                                        </div>

                                        <div class="form-group hide-yanxue" style="clear: both;">
                                            <label class="col-sm-2 control-label"
                                                style="text-align: right;padding-top: 7px;">营期差价:</label>
                                            <div class="col-sm-8">
                                                <span class="radio_box">
                                                    <input id="c-priceDiff" type="radio" name="is_priceDiff" value="0"
                                                        class="my_radio" checked>
                                                    <label for="c-priceDiff">关闭</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="priceDiff" type="radio" name="is_priceDiff" value="1"
                                                        class="my_radio">
                                                    <label for="priceDiff">开启</label>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="form-group priceDiff-box hide hide-yanxue" style="clear: both;">
                                            <label class="col-sm-2 control-label"></label>
                                            <div class="col-sm-6 priceDiff-con">
                                                <table class="table table-bordered table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>营期期次</th>
                                                            <th>差价类型</th>
                                                            <th>差价金额</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr class="priceDiffTR1">
                                                            <td> --- </td>
                                                            <td>
                                                                <span class="radio_box r_on">
                                                                    <input type="radio" value="0" name="priceDiffRd1"
                                                                        class="my_radio priceDiff-type" checked>
                                                                    <label> - </label>
                                                                </span>
                                                                <span class="radio_box">
                                                                    <input type="radio" value="1" name="priceDiffRd1"
                                                                        class="my_radio priceDiff-type">
                                                                    <label> + </label>
                                                                </span>
                                                            </td>
                                                            <td>
                                                                <input type="text"
                                                                    class="form-control priceDiff-ipt input-sm"
                                                                    value="">
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <div class="form-group hide-yanxue" style="clear: both;">
                                            <label class="col-sm-2 control-label destine-type"
                                                style="text-align: right;padding-top: 7px;">成本价:</label>
                                            <div class="col-sm-10">
                                                <span class="radio_box">
                                                    <input id="prime_cost" type="text" name="prime_cost" value=""
                                                        class="form-control" style="display: inline;width: 200px;">
                                                </span>
                                                <span>成本价未来会用于营销建议，利润分析等</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="goods-info hide-yanxue" style="clear: both;">
                                        <div class="base-title" id="nav-receive-discount">
                                            <h4>购买享优惠</h4>
                                        </div>

                                        <div class="form-horizontal">
                                            <div class="form-group no27 is_show_hide">
                                                <label class="col-sm-2 control-label">限期优惠:</label>
                                                <div class="col-sm-10">
                                                    <span class="radio_box">
                                                        <input id="qxno" type="radio" name="is_timepay" value="2"
                                                            class="my_radio" checked>
                                                        <label for="qxno">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="qxyes" type="radio" name="is_timepay" value="1"
                                                            class="my_radio">
                                                        <label for="qxyes">开启</label>
                                                    </span>

                                                </div>
                                            </div>
                                            <div class="form-group yhcon hide no27">
                                                <div class="col-sm-8 col-sm-offset-2">
                                                    <span class="radio_box">
                                                        <input type="radio" style="height:auto" class="my_radio" checked
                                                            name="is_timepay_type" value="1" id="is_timepay_type1">
                                                        <label for="is_timepay_type1">持续到开营前</label>
                                                        <input type="number" class="form-control dataBox" maxlength="3"
                                                            name="timepay_day"
                                                            style="display:inline-block;width:120px">天，期间减
                                                        <input type="number" class="form-control dataBox" maxlength="3"
                                                            name="timepay_price"
                                                            style="display:inline-block;width:120px">元
                                                    </span><br>
                                                    <span class="radio_box">
                                                        <input type="radio" style="height:auto" class="my_radio"
                                                            name="is_timepay_type" value="0" id="is_timepay_type2">
                                                        <label for="is_timepay_type2">按照时间段开启限期优惠</label>
                                                    </span>
                                                </div>
                                                <div class="form-group yhcondatetime hide" style="clear: both;">
                                                    <label class="col-sm-2 control-label"></label>
                                                    <div class="col-sm-8">
                                                        <div class="yhlist">
                                                            <div class="yhli">
                                                                <input type="text"
                                                                    class="datepicker datepicker2 form-control dataBox"
                                                                    id="breakTime"
                                                                    style="border-radius:2px;width: 330px"
                                                                    name="break_time[]" value=""> 之间购买减
                                                                <input class="form-control dataBox" id="break_price"
                                                                    style="width: 100px;" maxlength="10" type="text"
                                                                    name="break_price[]" value=""> 元
                                                                <input class="form-control dataBox" name="break_ynicknames[]" placeholder="请输入昵称" style="width: 120px;" />
                                                                <button
                                                                    type="button"
                                                                    class="btn btn-danger btn-xs deleteyhli hide">删除</button>
                                                            </div>
                                                        </div>

                                                        <div>
                                                            <button type="button"
                                                                class="btn btn-primary btn-xs addyhli">添加优惠项</button>
                                                            <span class="sku-break-box-all hide"> <input type="checkbox"
                                                                    checked>
                                                                适用全部规格 </span>
                                                        </div>
                                                        <div class="sku-break-box hide">

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <span class="form-group nicknames hide no27">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-8">

                                                    <input type="checkbox" name="is_custom_nicknames"
                                                        id="custom_nicknames" />
                                                    <label for="custom_nicknames">自定义昵称</label>
                                                    <input type="text" class="form-control" name="custom_nicknames"
                                                        style="width:120px;display:inline-block;" placeholder="请输入昵称" />
                                                    &nbsp;&nbsp;底色<input type="text" class="form-control" id="bgcolor">
                                                    &nbsp;&nbsp;优惠文字<input type="text" class="form-control"
                                                        id="fontcolor">
                                                    &nbsp;&nbsp;倒计时底色<input type="text" class="form-control"
                                                        id="bgcolor1">
                                                    &nbsp;&nbsp;倒计时文字<input type="text" class="form-control"
                                                        id="fontcolor1">
                                                    &nbsp;&nbsp;倒计时数字<input type="text" class="form-control"
                                                        id="fontcolor2">
                                                </div>
                                            </span>
                                            <div class="form-group no28 is_show_hide">
                                                <label class="col-sm-2 control-label">{$year_name}优惠:</label>
                                                <div class="col-sm-8">
                                                    <span class="radio_box">
                                                        <input id="yearcard_close" type="radio" name="is_yearcard"
                                                            checked value="0" class="my_radio">
                                                        <label for="yearcard_close">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="yearcard_open" type="radio" name="is_yearcard"
                                                            value="1" class="my_radio">
                                                        <label for="yearcard_open">开启</label>
                                                    </span>
                                                    <div class="tipIco"
                                                        onclick="showTip('{$year_name}优惠开启后将不可以与其他优惠同享')">?</div>
                                                    <div id="yearcard_content" style="display: none;">
                                                        <label class="col-sm-2 control-label">
                                                            请选择适用的{$year_name}
                                                        </label>
                                                        <div class="col-sm-10" id="select-nianka">
                                                            <select multiple="multiple" class="yearcard-select"
                                                                id="yearcard" style="width: 300px;"></select>
                                                            <div class="tipIco"
                                                                onclick="showTip('仅显示统一核销的{$year_name}')">?</div>
                                                        </div>
                                                        <label class="col-sm-2 control-label mt-10">
                                                            {$year_name}文案:
                                                        </label>
                                                        <div class="col-sm-10 mt-10" id="">
                                                            <input type="text" name="yearcard_desc"
                                                                placeholder="拥有{$year_name}即享受免费报名" class="form-control"
                                                                style="width: 300px;display: inline-block;" />
                                                            <div class="tipIco" style="cursor: pointer;"
                                                                onclick="showTip('修改的是小程序营种详情页的{$year_name}文案提示')">?
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-10 col-sm-offset-2 mt-10">
                                                            <label class="checkbox-inline">
                                                                <input type="checkbox" id="isYearCardUserUse" value="0"> {$year_name}用户专享
                                                            </label>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>

                                            <div class="form-group no29 is_show_hide">
                                                <label class="col-sm-2 control-label">VIP折扣:</label>
                                                <div class="col-sm-8">
                                                    <span class="radio_box">
                                                        <input id="novip" type="radio" name="is_vipcard" value="0"
                                                            class="my_radio input-has-hide-extra" checked data-control-extra="addClass">
                                                        <label for="novip">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="yesvip" type="radio" name="is_vipcard" value="1"
                                                            class="my_radio input-has-hide-extra" data-control-extra="removeClass">
                                                        <label for="yesvip">开启</label>
                                                    </span>
                                                    <label class="checkbox-inline pt-0 hide is_vipcard-extra">
                                                        <input type="checkbox" name="is_hide_vip_price" value="1">小程序隐藏该优惠项
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="form-group no29 clearfix vipPriceBox hide">
                                                <div class="col-sm-6 col-sm-offset-2" id="qinzi">
                                                    <span class="radio_box">
                                                        <input type="radio" style="height:auto" class="my_radio" checked
                                                            name="vip_pay_type" value="0" id="vip_pay_type1">
                                                        <label for="vip_pay_type1">指定折扣<span
                                                                class="unqinzi hide">:儿童</span></label>
                                                        <input type="number" class="form-control dataBox" maxlength="3"
                                                            id="vipPrice" name="agio"
                                                            style="display:inline-block;width:120px">
                                                        <label for="vip_pay_type2" class="unqinzi hide">折,成人</label>
                                                        <input type="number" class="form-control unqinzi hide"
                                                            name="big_agio" id="bgvipPrice"
                                                            style="display:inline-block;width:120px">折
                                                    </span>
                                                    <br>
                                                    <span class="radio_box">
                                                        <input type="radio" style="height:auto" class="my_radio"
                                                            name="vip_pay_type" value="1" id="vip_pay_type2">
                                                        <label for="vip_pay_type1">固定金额<span
                                                                class="unqinzi hide">:儿童</span></label>
                                                        <input type="number" class="form-control dataBox" maxlength="3"
                                                            id="vip_money" name="vip_money" disabled
                                                            style="display:inline-block;width:120px">
                                                        <label for="vip_pay_type2" class="unqinzi hide">元,成人</label>
                                                        <input type="number" class="form-control unqinzi hide"
                                                            name="big_vip_money" disabled
                                                            style="display:inline-block;width:120px">元
                                                    </span>
                                                    <br>
                                                    <span class="radio_box">
                                                        <input type="radio" style="height:auto" class="my_radio"
                                                            name="vip_pay_type" value="2" id="vip_pay_type3">
                                                        <label for="vip_pay_type3">vip立减<span
                                                                class="unqinzi hide">:儿童</span></label>
                                                        <input type="number" class="form-control dataBox"
                                                            name="vip_reduce" disabled
                                                            style="display:inline-block;width:120px">
                                                        <label for="vip_pay_type3" class="unqinzi hide">元,成人</label>
                                                        <input type="number" class="form-control unqinzi hide"
                                                            name="big_vip_reduce" disabled
                                                            style="display:inline-block;width:120px">元
                                                    </span>
                                                    <br>

                                                    <span class="vipPriceBox hide">
                                                        <input style="vertical-align: -2px; margin-left: 5px;" type="checkbox" id="open-vip-type"> 不与其他优惠同享
                                                        <input style="vertical-align: -2px; margin: 5px 0 0 10px;" type="checkbox" id="is_only_vip"> vip专享
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="form-group no30 is_show_hide">
                                                <label class="col-sm-2 control-label">虚拟币抵扣:</label>
                                                <div class="col-sm-8">
                                                    <span class="radio_box">
                                                        <input id="novirtual" type="radio" name="is_virtual" value="0"
                                                            class="my_radio" checked>
                                                        <label for="novirtual">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="yesvirtual" type="radio" name="is_virtual" value="1"
                                                            class="my_radio">
                                                        <label for="yesvirtual">开启</label>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="form-group no30 virtual-box hide">
                                                <label class="float-left col-sm-offset-2" style="padding-left: 15px">
                                                    <span class="radio_box r_on">
                                                        <input id="partDeduct" type="radio" name="deduct" value="0"
                                                            class="my_radio" checked>
                                                        <label for="partDeduct">部分抵扣</label>
                                                    </span><br>
                                                    <span class="radio_box">
                                                        <input id="allDeduct" type="radio" name="deduct" value="1"
                                                            class="my_radio">
                                                        <label for="allDeduct">全额抵扣</label>
                                                    </span>
                                                </label>
                                                <div class="col-sm-8 virtual-type1">
                                                    最多抵扣 <input type="text" name="coin" class="form-control"
                                                        style="width:100px;display: inline-block;"> 个虚拟币 <br> 可用
                                                    <input type="text" name="coin_1" class="form-control"
                                                        style="width:100px;display: inline-block;"> 个虚拟币直接报名
                                                    <div class="tipIco" onclick="showTip('仅支持无规格单飞营种')">?</div>
                                                    <div>仅对<select class="form-control" name="coin_level"
                                                            id="coin_level"
                                                            style="display: inline-block;width: 100px;"></select>及以上会员开放抵扣
                                                    </div>
                                                    <div id="qedk_box">
                                                        <div id="qedk_list">
                                                        </div>
                                                        <button type="button" class="btn btn-primary btn-xs"
                                                            onclick="fnAddQedk()">添加优惠项</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group no31 is_show_hide">
                                                <label class="col-sm-2 control-label">满减优惠:</label>
                                                <div class="col-sm-8">
                                                    <span class="radio_box">
                                                        <input id="mjyh1" type="radio" name="mjyh_type" checked
                                                            value="0" class="my_radio">
                                                        <label for="mjyh1">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="mjyh2" type="radio" name="mjyh_type" value="1"
                                                            class="my_radio">
                                                        <label for="mjyh2">开启</label>
                                                    </span>
                                                    <div id="mjyh_box" class="hide">
                                                        <div id="mjyh_list">
                                                            <p>
                                                                每满
                                                                <input type="number" name="mjyh_full[]"
                                                                    class="form-control"
                                                                    style="width:100px;display: inline-block;">元减
                                                                <input type="number" name="mjyh_reduce[]"
                                                                    class="form-control"
                                                                    style="width:100px;display: inline-block;">元
                                                                <button type="button" class="btn btn-danger btn-xs"
                                                                    onclick="fnDelMjyh(this)">删除</button>
                                                            </p>
                                                        </div>
                                                        <button type="button" class="btn btn-primary btn-xs"
                                                            onclick="fnAddMjyh()">添加优惠项</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group no62 is_show_hide">
                                                <label class="col-sm-2 control-label">多人优惠:</label>
                                                <div class="col-sm-6">
                                                    <span class="radio_box ">
                                                        <input id="noFullCut" type="radio" name="is_fullCut" value="0"
                                                            class="my_radio" checked>
                                                        <label for="noFullCut">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="fullCut" type="radio" name="is_fullCut" value="1"
                                                            class="my_radio">
                                                        <label for="fullCut">按人数优惠</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="fullCut2" type="radio" name="is_fullCut" value="2"
                                                            class="my_radio">
                                                        <label for="fullCut2">按订单优惠</label>
                                                    </span>
                                                    <label class="checkbox-inline pt-0 hide is_hide_full">
                                                        <input type="checkbox" name="is_hide_full" value="1">小程序隐藏该优惠项
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="form-group no62 fullCutCon hide">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-6">
                                                    <div class="fullCutInfo">
                                                        <div class="fullCutItem">
                                                            满
                                                            <input type="text" value=""
                                                                class="form-control fullCatIpt peopleNum"> 人，每人减
                                                            <input type="text"
                                                                class="form-control fullCatIpt fullCutPrice" value=""> 元
                                                            <button type="button"
                                                                class="btn btn-danger btn-xs deleteFullCut">删除</button>
                                                        </div>

                                                    </div>
                                                    <div>
                                                        <button type="button"
                                                            class="btn btn-primary btn-xs addFullCut">添加优惠项</button>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="form-group no32 is_show_hide">
                                                <label class="col-sm-2 control-label">老营员优惠:</label>
                                                <div class="col-sm-8">
                                                    <span class="radio_box">
                                                        <input id="n_old_free" type="radio" name="old_status" value="0"
                                                            class="my_radio" checked>
                                                        <label for="n_old_free">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="y_old_free" type="radio" name="old_status" value="1"
                                                            class="my_radio">
                                                        <label for="y_old_free">开启</label>
                                                    </span><br>
                                                    <span class="old-free-box hide">
                                                        减 <input type="number"
                                                            style="display: inline-block;width: 100px;" name="old_money"
                                                            class="form-control"> 元
                                                        <div class="tipIco"
                                                            onclick="showTip('仅下单时填写报名表有效 老营员指有过报名且结营的营员')">?</div>
                                                    </span>
                                                </div>
                                            </div>
                                            <!-- 会员等级优惠 -->
                                            <div class="form-group no33 is_show_hide">
                                                <label class="col-sm-2 control-label">会员等级优惠:</label>
                                                <div class="col-sm-8">
                                                    <span class="radio_box">
                                                        <input id="n-level-free" type="radio" name="is_vip_level"
                                                            value="0" class="my_radio input-has-hide-extra" checked data-control-extra="addClass">
                                                        <label for="n-level-free">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="y-level-free" type="radio" name="is_vip_level"
                                                            value="1" class="my_radio input-has-hide-extra" data-control-extra="removeClass">
                                                        <label for="y-level-free">等级立减</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="ydis-level-free" type="radio" name="is_vip_level"
                                                            value="2" class="my_radio input-has-hide-extra" data-control-extra="removeClass">
                                                        <label for="ydis-level-free">等级折扣</label>
                                                    </span>
                                                    <label class="checkbox-inline pt-0 hide is_vip_level-extra">
                                                        <input type="checkbox" name="is_vip_level_hide" value="1">小程序隐藏该优惠项
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="form-group hide no33 level-free-con">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-8">

                                                </div>
                                            </div>
                                            <div class="form-group hide level-free-condis">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-8">

                                                </div>
                                            </div>
                                            <!-- 代客下单欢迎图 -->
                                            <div class="form-group no61 is_show_hide">
                                                <label class="col-sm-2 control-label">代客下单欢迎图:</label>
                                                <div class="col-sm-8">
                                                    <span class="radio_box">
                                                        <input id="n-is_dk_welcome" type="radio" name="is_dk_welcome"
                                                            value="0" class="my_radio" checked>
                                                        <label for="n-is_dk_welcome">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="y-is_dk_welcome" type="radio" name="is_dk_welcome"
                                                            value="1" class="my_radio">
                                                        <label for="y-is_dk_welcome">开启</label>
                                                    </span>
                                                </div>
                                            </div>

                                            <div class="form-group hide no61 welcomeimg-box">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-8">
                                                    <span class="imgvi">
                                                        <label>
                                                            <img id="dkWelomeimgsrc"
                                                                src="https://file.dev.xinduobang.cn/images/chrome-ext/1615368309226876.jpeg" />
                                                            <input type="file" id="dkWelomeimg" />
                                                            <input type="hidden" class="imgUrl" name="dk_welcome_img" />
                                                            <font class="hidden">&#10005;</font>
                                                        </label>
                                                    </span>
                                                    <span style="color:red;">建议宽为750px，高自定义</span>
                                                </div>
                                            </div>

                                            <div class="form-group no62 is_show_hide">
                                                <label class="col-sm-2 control-label">是否可用优惠券:</label>
                                                <div class="col-sm-8">
                                                    <span class="radio_box">
                                                        <input id="n-card_status" type="radio" name="card_status"
                                                            value="1" class="my_radio" checked>
                                                        <label for="n-card_status">可用</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="y-card_status" type="radio" name="card_status"
                                                            value="2" class="my_radio">
                                                        <label for="y-card_status">不可用</label>
                                                    </span>
                                                </div>
                                            </div>

                                            <div class="form-group no63">
                                                <label class="col-sm-2 control-label">是否可用储值卡:</label>
                                                <div class="col-sm-8">
                                                    <span class="radio_box">
                                                        <input id="n-is_moneycard" type="radio" name="is_moneycard"
                                                            value="1" class="my_radio" checked>
                                                        <label for="n-is_moneycard">可用</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="y-is_moneycard" type="radio" name="is_moneycard"
                                                            value="2" class="my_radio">
                                                        <label for="y-is_moneycard">不可用</label>
                                                    </span>
                                                </div>
                                            </div>

                                        </div>

                                        <div class="base-title" id="nav-send-discount">
                                            <h4>购买送优惠</h4>
                                        </div>
                                        <div class="form-horizontal">
                                            <div class="form-group no34 is_show_hide">
                                                <label class="col-sm-2 control-label">购买送券:</label>
                                                <div class="col-sm-3">
                                                    <span class="radio_box r_on">
                                                        <input id="nogivecard" type="radio" name="is_givecard" value="0"
                                                            class="my_radio" checked>
                                                        <label for="nogivecard">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="givecard" type="radio" name="is_givecard" value="1"
                                                            class="my_radio">
                                                        <label for="givecard">开启</label>
                                                    </span>
                                                    <a href="javascript:;"
                                                        class="btn btn-primary btn-sm addbuy cardSelectBox hide">添加</a>
                                                    <span class="cardSelectBox checkednum hide">已选0张</span>
                                                </div>
                                            </div>
                                            <div class="form-group no34 hide" style="margin-left: 0;margin-bottom: 0;"
                                                id="cardlistchecked">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-9">
                                                    <table class="buysendcard table table-bordered table-hover"
                                                        style="width: 290px;">
                                                        <thead>
                                                            <tr>
                                                                <th>名称</th>
                                                                <th>数量</th>
                                                                <th>操作</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="selbucard">
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="form-group no34 dn" id="parenting_config_card">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-5" style="padding-left: 20px">
                                                    亲子配置:
                                                    <span class="radio_box r_on">
                                                        <input id="parentchild" type="radio" name="parenting_config"
                                                            value="1" class="my_radio" checked>
                                                        <label for="parentchild">大人和小孩都送券</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="parent_card" type="radio" name="parenting_config"
                                                            value="2" class="my_radio">
                                                        <label for="parent_card">仅大人报名送券</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="child_card" type="radio" name="parenting_config"
                                                            value="3" class="my_radio">
                                                        <label for="child_card">仅小孩报名送券</label>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="form-group no35 is_show_hide">
                                                <label class="col-sm-2 control-label">购买送币:</label>
                                                <div class="col-sm-8">
                                                    <span class="radio_box">
                                                        <input id="n_give_coin" type="radio" name="is_give_coin"
                                                            value="0" class="my_radio" checked>
                                                        <label for="n_give_coin">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="y_give_coin" type="radio" name="is_give_coin"
                                                            value="1" class="my_radio">
                                                        <label for="y_give_coin">开启</label>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="form-group no35 hide give_coin_con">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-8">
                                                    <span class="radio_box">
                                                        <input id="is_over_give_coin" type="checkbox" name="is_over_give_coin"
                                                            value="1" class="form-control" style="margin-left: 3px;">
                                                        <label for="is_over_give_coin">
                                                            结营后赠送虚拟币
                                                        </label>
                                                    </span>
                                                    <br>
                                                    <span class="radio_box">
                                                        <input id="y_give_coin1" type="radio" name="is_give_coin_type"
                                                            value="1" class="my_radio" checked>
                                                        <label for="y_give_coin1">
                                                            每消费一元获得 <input type="text" class="form-control"
                                                                style="display: inline-block; width: 80px;"
                                                                name="give_coin_type1"> 个币
                                                        </label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="y_give_coin2" type="radio" name="is_give_coin_type"
                                                            value="2" class="my_radio">
                                                        <label for="y_give_coin2">
                                                            共获得 <input type="text" class="form-control"
                                                                style="display: inline-block; width: 80px;"
                                                                name="give_coin_type2">乘以订单人数个虚拟币
                                                        </label>
                                                    </span>
                                                    <br>
                                                    <div class="form-group">
                                                        <label class="float-left control-label">VIP特权:</label>
                                                        <div class="col-sm-10">
                                                            <span class="radio_box r_on">
                                                                <input id="vip_tq_type1" type="radio" name="vip_tq_type"
                                                                    value="1" class="my_radio" checked>
                                                                <label for="vip_tq_type1">按照全局规则</label>
                                                            </span>
                                                            <span class="radio_box">
                                                                <input id="vip_tq_type2" type="radio" name="vip_tq_type"
                                                                    value="2" class="my_radio">
                                                                <label for="vip_tq_type2">自定义规则</label>
                                                            </span>
                                                            <br>
                                                            <div class="vipType hide">
                                                                <span class="radio_box r_on">
                                                                    <input id="vip_coin_type1" type="radio"
                                                                        name="vip_coin_type" value="1" class="my_radio"
                                                                        checked>
                                                                    <label for="vip_coin_type1">与普通用户购买送币相同</label>
                                                                </span>
                                                                <span class="radio_box">
                                                                    <input id="vip_coin_type2" type="radio"
                                                                        name="vip_coin_type" value="2" class="my_radio">
                                                                    <label for="vip_coin_type2">每消费一元获得</label>
                                                                    <input type="text" name="vip_givecoin"
                                                                        class="form-control"
                                                                        style="display: inline-block; width: 80px;"
                                                                        value="" />个币
                                                                </span>
                                                                <span class="radio_box">
                                                                    <input id="vip_coin_type3" type="radio"
                                                                        name="vip_coin_type" value="3" class="my_radio">
                                                                    <label for="vip_coin_type3">共获得</label>
                                                                    <input type="text" name="vip_givecoin1"
                                                                        class="form-control"
                                                                        style="display: inline-block; width: 80px;"
                                                                        value="" />个币
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group no36 is_show_hide">
                                                <label class="col-sm-2 control-label">参与大转盘:</label>
                                                <div class="col-sm-8">
                                                    <span class="radio_box r_on">
                                                        <input id="joinlottery1" type="radio" name="joinlottery"
                                                            value="0" class="my_radio" checked>
                                                        <label for="joinlottery1">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="joinlottery2" type="radio" name="joinlottery"
                                                            value="1" class="my_radio">
                                                        <label for="joinlottery2">开启</label>
                                                    </span><br>
                                                    <span class="joinlottery-label hide">选择活动</span>
                                                    <select name="lotterytype" id="joinlottery-select"
                                                        style="display:inline-block;width:200px;"
                                                        class="hide form-control">
                                                        <option value="">请指定大转盘活动</option>
                                                        <option value="1">活动1</option>
                                                        <option value="2">活动2</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group hide no36" id="joinlottery-y">
                                                <div class="col-sm-8 col-sm-offset-2">
                                                    <span class="radio_box">
                                                        <input type="radio" name="give_lottery_type" checked value="0"
                                                            class="my_radio">
                                                    </span>
                                                    <span>订单金额</span>
                                                    <select name="lottermoneytype" class="form-control"
                                                        style="display:inline-block;width:100px" id="">
                                                        <option value="1">满</option>
                                                        <option value="2">每满</option>
                                                    </select>
                                                    <input type="number" name="lottermoney" class="form-control"
                                                        style="display:inline-block;width:100px">
                                                    <span>元，获得</span>
                                                    <input type="number" name="lotternum" class="form-control"
                                                        style="display:inline-block;width:100px">
                                                    <span>次抽奖机会</span>
                                                    <br />
                                                    <span class="radio_box">
                                                        <input type="radio" name="give_lottery_type" value="1"
                                                            class="my_radio">
                                                    </span>
                                                    <span>每购买1个营位赠送</span>
                                                    <input type="number" name="lotternum" class="form-control" disabled
                                                        style="display:inline-block;width:100px; margin-top: 10px;">
                                                    <span>次抽奖机会</span>
                                                    <span class="hide">
                                                        <input style="vertical-align: -2px;" type="checkbox" disabled
                                                            id="give_lottery_only_child">仅支持儿童
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="base-title hidden-title hide-yanxue-only" id="nav-parenting">
                                        <h4>亲子营销</h4>
                                    </div>
                                    <div class="form-horizontal hide-yanxue-only" id="nav-parenting-box">
                                        <div class="form-group no37">
                                            <label class="col-sm-2 control-label">亲子优惠:</label>
                                            <div class="col-sm-9">
                                                <span class="radio_box">
                                                    <input id="n_parent_free" type="radio" name="qz_status" value="0"
                                                        class="my_radio" checked>
                                                    <label for="n_parent_free">关闭</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="y_parent_free" type="radio" name="qz_status" value="1"
                                                        class="my_radio">
                                                    <label for="y_parent_free">开启</label>
                                                </span><br>
                                                <span class="parent-free-box hide">
                                                    每满 <input type="number" style="display: inline-block;width: 80px;"
                                                        name="parent_num1" class="form-control"> 个成人和 <input
                                                        type="number" style="display: inline-block;width: 80px;"
                                                        name="parent_num2" class="form-control"> 个儿童，减 <input
                                                        type="number" style="display: inline-block;width: 80px;"
                                                        name="parent_price" class="form-control"> 元
                                                    <div class="tipIco" onclick="showTip('仅支持亲子营种')">?</div>
                                                    <span>
                                                        <select id="qz_show_status"
                                                            style="display: inline-block; width: 100px;"
                                                            class="form-control">
                                                            <option value="0" selected="">显示</option>
                                                            <option value="1">隐藏</option>
                                                        </select>
                                                    </span>
                                                </span>
                                            </div>
                                        </div>

                                        <!--亲子差价-->
                                        <div class="form-group no38">
                                            <label class="col-sm-2 control-label">亲子差价:</label>
                                            <div class="col-sm-9">
                                                <span class="radio_box r_on">
                                                    <input id="qz_gap_c" type="radio" name="qz_gap" value="0"
                                                        class="my_radio" checked>
                                                    <label for="qz_gap_c">关闭</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="qz_gap_o" type="radio" name="qz_gap" value="1"
                                                        class="my_radio">
                                                    <label for="qz_gap_o">开启</label>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="form-group no38 hide" id="child_gap">
                                            <div class="col-sm-8 col-sm-offset-2">
                                                <span>满1大1小后，每增加1个儿童</span>
                                                <select name="c_plus" class="form-control"
                                                    style="display:inline-block;width:100px" id="c_plus">
                                                    <option value="1">加</option>
                                                    <option value="2">减</option>
                                                </select>
                                                <input type="number" name="c_gap_price" class="form-control" min="0"
                                                    style="display:inline-block;width:100px">
                                                <span>元差价</span>
                                            </div>
                                        </div>
                                        <div class="form-group no38 hide" id="parent_gap">
                                            <div class="col-sm-8 col-sm-offset-2">
                                                <span>满1大1小后，每增加1个成人</span>
                                                <select name="p_plus" class="form-control"
                                                    style="display:inline-block;width:100px" id="p_plus">
                                                    <option value="1">加</option>
                                                    <option value="2">减</option>
                                                </select>
                                                <input type="number" name="p_gap_price" class="form-control" min="0"
                                                    style="display:inline-block;width:100px">
                                                <span>元差价</span>
                                            </div>
                                        </div>

                                        <!-- -------------------- -->

                                        <div class="form-group no39">
                                            <label class="col-sm-2 control-label">儿童拼床:</label>
                                            <div class="col-sm-9">
                                                <span class="radio_box">
                                                    <input id="n_is_bed" type="radio" name="is_bed" value="0"
                                                        class="my_radio" checked>
                                                    <label for="n_is_bed">关闭</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="y_is_bed" type="radio" name="is_bed" value="1"
                                                        class="my_radio">
                                                    <label for="y_is_bed">开启</label>
                                                </span><br>
                                                <span class="is-bed-box hide">
                                                    每个成人最多和 <input type="number"
                                                        style="display: inline-block;width: 80px;" name="is_bed_num"
                                                        class="form-control"> 名儿童拼床，不占床减 <input type="number"
                                                        style="display: inline-block;width: 80px;" name="is_bed_price"
                                                        class="form-control"> 元/床
                                                    <div class="tipIco" onclick="showTip('仅支持亲子营种')">?</div>
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="other-info hide-yanxue">
                                        <div class="base-title" id="nav-sales">
                                            <h4>销量配置</h4>
                                        </div>
                                        <div class="form-horizontal">
                                            <?php
                                                    if(in_array(C('yx_appid'),array('t2zxNHFUIdE','AxS3pLEa7uj','gB7q3EKxxBC','TAy1Q9KKsrF','fVcPWb4bFRw','wikjfduNUmq','3EEhRfZgCQk'))){
                                                    ?>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">不可购买:</label>
                                                <div class="col-sm-4">
                                                    <span class="radio_box">
                                                        <input id="nis_sale" type="radio" name="is_sale" value="1"
                                                            class="my_radio" checked>
                                                        <label for="nis_sale">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="yis_sale" type="radio" name="is_sale" value="2"
                                                            class="my_radio">
                                                        <label for="yis_sale">开启</label>
                                                    </span>
                                                </div>
                                            </div>
                                            <?php
                                                    }
                                                ?>

                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">销量:</label>
                                                <div class="col-sm-10">
                                                    <span class="radio_box">
                                                        <input id="nis_show_salenum" type="radio" name="is_show_salenum"
                                                            value="1" class="my_radio" checked>
                                                        <label for="nis_show_salenum">隐藏</label>
                                                    </span><br>
                                                    <span class="radio_box">
                                                        <input id="yis_show_salenum" type="radio" name="is_show_salenum"
                                                            value="3" class="my_radio">
                                                        <label for="yis_show_salenum">显示购买人</label>
                                                    </span>
                                                    <span class="checkbox-inline">
                                                        <input id="yis_show_realmoney" disabled type="checkbox" name=""
                                                            value="5">
                                                        <label for="yis_show_realmoney">显示实付金额</label>
                                                    </span>
                                                    <span class="checkbox-inline">
                                                        <input id="yis_show_period" disabled type="checkbox" name=""
                                                            value="0">
                                                        <label for="yis_show_period">按营期展示</label>
                                                    </span>
                                                    <span class="checkbox-inline" style="padding-top: 5px;">
                                                        <input id="yis_show_maxnum" disabled type="checkbox" name=""
                                                            value="0" style="position: relative;top: -3px;">最多显示
                                                        <input type="text" name="maxshownum"
                                                            class="form-control maxshownum" disabled
                                                            style="display: inline-block; width: 100px" /> 条购买数据
                                                        
                                                    </span>
                                                    <span style="display: inline-block; padding: 5px 0 0 10px; vertical-align: middle;">
                                                        初始数量 <input type="number" placeholder="初始数量" disabled id="initialSaleNum" style="display: inline-block; width: 100px" class="form-control">
                                                    </span>
                                                    <br>
                                                    <span class="radio_box">
                                                        <input id="all_show_cum" type="radio" name="is_show_salenum"
                                                            value="4" class="my_radio">
                                                        <label for="all_show_cum">显示并自定义</label>
                                                    </span>
                                                    <span>
                                                        <input type="number" id="show_salenum" placeholder="初始数量"
                                                            disabled name="show_salenum"
                                                            style="display: inline-block; width: 100px"
                                                            class="form-control">
                                                        <span>预览效果:已售<span id="sell_num">0</span></span>
                                                        <p class="hide" style="padding:10px 0 0 25px;color:#ccc;">
                                                            设为自定义销量后，将无法再切换到显示实际销售和显示购买人选项</p>
                                                    </span>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">库存扣除时间:</label>
                                                <div class="col-sm-8">
                                                    <span class="radio_box">
                                                        <input id="cancel_type1" type="radio" name="cancel_type"
                                                            value="0" class="my_radio" checked>
                                                        <label for="cancel_type1">下单后</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="cancel_type2" type="radio" name="cancel_type"
                                                            value="1" class="my_radio">
                                                        <label for="cancel_type2">支付成功后</label>
                                                    </span>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">排队报名:</label>
                                                <div class="col-sm-8">
                                                    <span class="radio_box">
                                                        <input id="line_up1" type="radio" name="line_up" value="0"
                                                            class="my_radio" checked>
                                                        <label for="line_up1">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="line_up2" type="radio" name="line_up" value="1"
                                                            class="my_radio">
                                                        <label for="line_up2">开启</label>
                                                    </span>
                                                    <div class="tipIco" style="cursor: pointer;"
                                                        onclick="showTip('开启后已经满营也可以继续报名，报名后会进入排队状态，有人退款并释放库存后会以公众号消息通知的方式提醒排队的人进行付款，如果在设置的时间内没有支付的话会自动结束排队并取消订单')">
                                                        ?</div>
                                                    <div class="line_up_min hide"><input type="text" name="line_up_min"
                                                            style="width: 60px;" />分钟未进行下单将会自动取消排队资格</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="base-title" id="nav-sign-up">
                                        <h4>报名配置</h4>
                                    </div>
                                    <div class="form-horizontal">
                                        <div class="form-group no40">
                                            <label class="col-sm-2 control-label">是否填写报名表:</label>
                                            <div class="col-sm-4">
                                                <span class="radio_box">
                                                    <input id="is_forbid_form2" type="radio" name="is_forbid_form"
                                                        value="0" class="my_radio" checked>
                                                    <label for="is_forbid_form2">是</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="is_forbid_form1" type="radio" name="is_forbid_form"
                                                        value="1" class="my_radio">
                                                    <label for="is_forbid_form1">否</label>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="form-group no41">
                                            <label class="col-sm-2 control-label">报名顺序:</label>
                                            <div class="col-sm-10">
                                                <span class="radio_box">
                                                    <input id="enroll_order2" type="radio" name="add_status" value="1"
                                                        class="my_radio" checked>
                                                    <label for="enroll_order2">下单时填写报名表</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="enroll_order1" type="radio" name="add_status" value="0"
                                                        class="my_radio">
                                                    <label for="enroll_order1">支付后填写报名表</label>
                                                </span>
                                                <div class="tipIco" onclick="showTip('小组营种不支持下单时填写报名表')">?</div>
                                            </div>
                                        </div>
                                        <div class="form-group hide-yanxue">
                                            <div class="row" style="margin-left: 0;">
                                                <label class="col-sm-2 control-label">报名预热:</label>
                                                <div class="col-sm-10" style="padding-right: 0">
                                                    <span class="radio_box">
                                                        <input type="radio" name="is_startsale" value="0"
                                                            class="my_radio" id="off_startsale" checked>
                                                        <label for="off_startsale">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="on_startsale" type="radio" name="is_startsale"
                                                            value="1" class="my_radio">
                                                        <label for="on_startsale">开启</label>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="row startsale_detail" style="display: none">
                                                <label class="col-sm-2 control-label"></label>
                                                <div class="col-sm-10">
                                                    <div class="row"
                                                        style="padding-left: 15px;margin-bottom: 5px;margin-left: 0;">
                                                        预热结束时间: <input type="text" name="startsale_time"
                                                            class="form-control" placeholder="请选择预热结束时间"
                                                            style="display: inline-block; width:15%">
                                                    </div>
                                                    <div class="row"
                                                        style="padding-left: 15px;margin-bottom: 5px;margin-left: 0;">
                                                        报名按钮文案: <input type="text" name="startsale_desc"
                                                            class="form-control" placeholder="请输入预热按钮文案"
                                                            style="display: inline-block; width:15%">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group no42 hide-yanxue">
                                            <label class="col-sm-2 control-label">卡券核销:</label>
                                            <div class="col-sm-10" style="padding-right: 0;">
                                                <span class="radio_box">
                                                    <input id="card_status1" type="radio" name="hx_status" value="0"
                                                        class="my_radio" checked>
                                                    <label for="card_status1">关闭</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="card_status2" type="radio" name="hx_status" value="1"
                                                        class="my_radio">
                                                    <label for="card_status2">开启</label>
                                                </span>
                                            </div>
                                            <div class="col-sm-offset-7 col-sm-offset-2 hx_num_box hide">
                                                &nbsp;核销次数 <input type="tel" style="width: 80px;display: inline-block;"
                                                    name="hx_num" value="1" class="form-control"> 次
                                                <div class="tipIco"
                                                    onclick="showTip('开启该功能后，报名成功将会获得电子核销码，到场核销后订单将会完成')">?</div>
                                            </div>
                                        </div>

                                        <!-- 添加自定义有效期   -->

                                        <div class="form-group" id="yxqbox" style="display: none;">
                                            <label class="control-label col-sm-2"></label>
                                            <div class="col-sm-8">
                                                <div class="control-label" style="text-align:left;display: none;"
                                                    id="self_box">
                                                    <div style="display: inline-block;" class="isValid_click">
                                                        <div class="hx_isValid">
                                                            <input type="checkbox" id="hx_isValid"
                                                                name="hx_is_defined" />
                                                            <label for="hx_isValid">自定义有效期</label>
                                                        </div>
                                                    </div>
                                                    <div class="tipIco"
                                                        onclick="showTip('如不开启，则营期时间等于卡券核销有效期，更改有效期仅对新付款订单有效')">?</div>
                                                </div>
                                                <div class="isValid_list" style="display: none;">
                                                    <div class="input_box self_input" style="margin-top: 10px">
                                                        <span class="radio_box">
                                                            <input type="radio" name="valid_start_type" value="1"
                                                                class="my_radio"> <label>付款完成卡券立即生效</label>
                                                        </span>
                                                    </div>
                                                    <div class="yxqhide yxqhide_one"
                                                        style="padding-left: 30px;display: none">
                                                        <div class="valid_end_type_wrap">
                                                            <span class="radio_box">
                                                                <label><input type="radio" name="valid_end_type"
                                                                        value="1" class="my_radio"> 生效时间起长期可用</label>
                                                            </span>
                                                        </div>
                                                        <div class="valid_end_type_wrap">
                                                            <span class="radio_box">
                                                                <label><input type="radio" name="valid_end_type"
                                                                        value="2" class="my_radio">
                                                                    生效时间起</label>
                                                            </span>
                                                            <input type="text"
                                                                style="display: inline-block;width: 120px"
                                                                name="valid_limit_end_day" disabled
                                                                class="form-control yxq-d"> 天内可用

                                                        </div>
                                                    </div>
                                                    <div class="input_box self_input" style="margin-top: 10px;">
                                                        <span class="radio_box">
                                                            <input type="radio" name="valid_start_type" value="2"
                                                                class="my_radio"> <label>付款完成后次日生效</label>
                                                        </span>
                                                    </div>
                                                    <div class="yxqhide yxqhide_two"
                                                        style="padding-left: 30px;display: none">
                                                        <div class="valid_end_type_wrap">
                                                            <span class="radio_box">
                                                                <label><input type="radio" name="valid_end_type"
                                                                        value="1" class="my_radio"> 生效时间起长期可用</label>
                                                            </span>
                                                        </div>
                                                        <div class="valid_end_type_wrap">
                                                            <span class="radio_box">
                                                                <label><input type="radio" name="valid_end_type"
                                                                        value="2" class="my_radio">
                                                                    生效时间起</label>
                                                            </span>
                                                            <input type="text" disabled
                                                                style="display: inline-block;width: 120px"
                                                                name="valid_limit_end_day" class="form-control yxq-d">
                                                            天内可用
                                                        </div>
                                                    </div>
                                                    <div class="input_box self_input" style="margin-top: 10px">
                                                        <span class="radio_box">
                                                            <input type="radio" name="valid_start_type" value="3"
                                                                class="my_radio"> <label>付款完成</label>
                                                        </span>
                                                        <label>
                                                            <input type="text" disabled
                                                                style="display: inline-block;width: 120px"
                                                                name="valid_limit_start_h" class="form-control"
                                                                id="yxq-h"> 小时后卡券生效
                                                        </label>
                                                    </div>
                                                    <div class="yxqhide yxqhide_three"
                                                        style="padding-left: 30px;display: none">
                                                        <div class="valid_end_type_wrap">
                                                            <span class="radio_box">
                                                                <label><input type="radio" name="valid_end_type"
                                                                        value="1" class="my_radio"> 生效时间起长期可用</label>
                                                            </span>
                                                        </div>
                                                        <div class="valid_end_type_wrap">
                                                            <span class="radio_box">
                                                                <label><input type="radio" name="valid_end_type"
                                                                        value="2" class="my_radio">
                                                                    生效时间起</label>
                                                            </span>
                                                            <input type="text" disabled
                                                                style="display: inline-block;width: 120px"
                                                                name="valid_limit_end_day" class="form-control yxq-d">
                                                            天内可用
                                                        </div>
                                                    </div>
                                                    <div class="input_box self_input" style="margin-top: 10px">
                                                        <span class="radio_box">
                                                            <input type="radio" name="valid_start_type" value="4"
                                                                class="my_radio"> <label>付款完成后固定时间</label>
                                                        </span>
                                                        <input type="text" disabled
                                                            style="display: inline-block;width: 180px"
                                                            name="valid_limit_start_date" autocomplete="off"
                                                            class="datepicker_one kaquanhexiao-picker-1 form-control"><span
                                                            class="control-label">-</span><input type="text" disabled
                                                            style="display: inline-block;width: 180px"
                                                            name="valid_limit_end_date" autocomplete="off"
                                                            class="datepicker_one kaquanhexiao-picker-2 form-control">
                                                        可用

                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group no43" style="clear: both;">
                                            <label class="col-sm-2 control-label">报名表修改时限:</label>
                                            <div class="col-sm-8" style="padding-right: 0;">
                                                <span class="radio_box" id="edit_form_close">
                                                    <input type="radio" name="edit_form_status" value="0"
                                                        class="my_radio" id="edit_status_one" checked>
                                                    <label for="edit_status_one">关闭</label>
                                                </span>
                                                <span class="radio_box" id="edit_form_open">
                                                    <input id="edit_status_two" type="radio" name="edit_form_status"
                                                        value="1" class="my_radio">
                                                    <label for="edit_status_two">开启</label>
                                                </span>
                                                <div class="tipIco" onclick="showTip('开启后 仅支持管理员和销售专员修改报名表')">?</div>
                                            </div>
                                            <div class="edit_form_date col-sm-offset-2 col-sm-8"
                                                style="display: none;clear: both;">
                                                开营前
                                                <input type="tel" style="width: 60px;display: inline-block;"
                                                    name="edit_form_day" class="form-control"> 小时不可修改报名表
                                            </div>
                                        </div>

                                        <div class="form-group no44">
                                            <label class="col-sm-2 control-label">报名成功广告:</label>
                                            <div class="col-sm-8" style="padding-right: 0;">
                                                <span class="radio_box">
                                                    <input type="radio" name="is_ad" value="0" class="my_radio"
                                                        id="off_adnotice" checked>
                                                    <label for="off_adnotice">关闭</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="ad_notice" type="radio" name="is_ad" value="1"
                                                        class="my_radio">
                                                    <label for="ad_notice">开启</label>
                                                </span>
                                                <div class="tipIco" onclick="showTip('开启后在报名成功页面将会弹出该图片广告')">?</div>
                                            </div>
                                        </div>
                                        <div class="form-group clearfix adPriceBox hide no44">
                                            <label class="float-left col-sm-offset-2"
                                                style="padding-left: 20px">　海报图:</label>
                                            <div class="col-sm-6" id="imgad">
                                                <span class="imgvi">
                                                    <label>
                                                        <img id="ImgPrad"
                                                            src="https://file.dev.xinduobang.cn/images/chrome-ext/1615368309226876.jpeg" />
                                                        <input type="file" id="uploadimgad" />
                                                        <input class="imgUrl" type="hidden" name="ad_file" value="">
                                                        <font class="hidden">&#10005;</font>
                                                    </label>
                                                </span>
                                                <div class="imgview" style="color:#cccccc;">建议尺寸600px*800px</div>
                                            </div>
                                        </div>
                                        <div class="form-group select-wrapper hide no44">
                                            <div class="row" style="margin-left: 0;">
                                                <label class="float-left col-sm-offset-2"
                                                    style="padding-left: 20px;line-height: 38px;">点击触发:</label>
                                                <div class="col-sm-9">
                                                    <span class="radio_box">
                                                        <input type="radio" name="poster_select_type" value="2"
                                                            class="my_radio" id="select-img" checked>
                                                        <label>查看大图</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="upload-page" type="radio" name="poster_select_type"
                                                            value="1" class="my_radio">
                                                        <label>跳转页面</label>
                                                    </span>
                                                    <div class="show-target" style="display: inline-block">
                                                        <span class="destine-type">
                                                            跳转到:
                                                        </span>
                                                        <span class="radio_box">
                                                            <input id="posters_path" type="text" name="posters_path"
                                                                value="" class="form-control"
                                                                style="display: inline;width: 280px;"
                                                                placeholder="请输入小程序路径">
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group no45 hide-yanxue">
                                            <label class="col-sm-2 control-label">起售数量:</label>
                                            <div class="col-sm-9">
                                                <span class="radio_box">
                                                    <input id="n_is_start" type="radio" name="is_start_num" value="0"
                                                        class="my_radio" checked>
                                                    <label for="n_is_start">关闭</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="y_is_start" type="radio" name="is_start_num" value="1"
                                                        class="my_radio">
                                                    <label for="y_is_start">开启</label>
                                                </span><br>
                                                <span class="is-start-box hide">
                                                    儿童 <input type="number" style="display: inline-block;width: 80px;"
                                                        name="start_small_num" class="form-control"> 人起售
                                                    <span class="is-start-big-box">
                                                        ，成人<input type="number"
                                                            style="display: inline-block;width: 80px;"
                                                            name="start_big_num" class="form-control"> 人起售
                                                    </span>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="form-group no46 hide-yanxue">
                                            <label class="col-sm-2 control-label">是否限购:</label>
                                            <div class="col-sm-5">
                                                <span class="radio_box isShowLimit" data-id="0">
                                                    <input id="isLimits" type="radio" name="is_limit" value="0"
                                                        class="my_radio" checked>
                                                    <label for="isLimits">关闭</label>
                                                </span>
                                                <span class="radio_box isShowLimit" data-id="1">
                                                    <input id="unLimits" type="radio" name="is_limit" value="1"
                                                        class="my_radio">
                                                    <label for="unLimits">开启</label>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="form-group hide hide-yanxue" id="xiangou_box_danfei">
                                            <label class="float-left col-sm-offset-2"
                                                style="padding-left: 20px;line-height: 33px;">限购:</label>
                                            <div class="col-sm-8">
                                                <div class="input-group" style="float: left; width: 300px;">
                                                    <span class="input-group-addon">每位会员限购此营种</span>
                                                    <input type="text" name="limits" placeholder="填写"
                                                        class="form-control">
                                                    <span class="input-group-addon">个营位</span>
                                                </div>
                                                <span class="checkbox-inline" style="float: left; margin-left: 10px;">
                                                    <input type="checkbox" name="limit_sale_type" id="limitSaleTypeOne">
                                                    <label>设为单次限购</label>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="form-group hide hide-yanxue" id="xiangou_box_qinzi">
                                            <label class="float-left col-sm-offset-2"
                                                style="padding-left: 20px;line-height: 33px;">限购:</label>
                                            <div class="col-sm-8">
                                                <div class="input-group" style="float: left; width: 445px;">
                                                    <span class="input-group-addon">每位会员限购此营种</span>
                                                    <input type="text" name="limits_perio_parent" placeholder="填写"
                                                        class="form-control" style="border-right: none;">
                                                    <span class="input-group-addon">个成人</span>
                                                    <input type="text" name="limits_perio_child" placeholder="填写"
                                                        class="form-control" style="border-left: none;">
                                                    <span class="input-group-addon">个孩子</span>
                                                </div>
                                                <span class="checkbox-inline" style="float: left; margin-left: 10px;">
                                                    <input type="checkbox" name="limit_sale_type" value="2" id="limitSaleTypeMultiple">
                                                    <label>设为单次限购</label>
                                                </span>

                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="control-label col-sm-2">自助换营:</label>
                                            <div class="col-sm-4">
                                                <span class="radio_box">
                                                    <input id="exchange_status_follow" type="radio"
                                                        name="new_exchange_status" checked value="0"
                                                        data-control-extra="addClass"
                                                        class="my_radio input-has-hide-extra">
                                                    <label for="exchange_status_follow">跟随全局配置</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="exchange_status_close" type="radio"
                                                        name="new_exchange_status" value="1"
                                                        data-control-extra="addClass"
                                                        class="my_radio input-has-hide-extra">
                                                    <label for="exchange_status_close">关闭</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="exchange_status_open" type="radio"
                                                        name="new_exchange_status" value="2"
                                                        data-control-extra="removeClass"
                                                        class="my_radio input-has-hide-extra">
                                                    <label for="exchange_status_open">开启</label>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="form-group new_exchange_status-extra hide">
                                            <div class="col-sm-6 col-sm-offset-2">
                                                <select class="form-control" name="new_exchange_time_type"
                                                    style="width:75px;display: inline-block;">
                                                    <option value="0">开营</option>
                                                    <option value="1">结营</option>
                                                </select>
                                                <span>前</span>
                                                <input type="number" name="new_exchange_day" class="form-control"
                                                    style="width:62px; display: inline-block;" /> 天用户不可发起
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-sm-2">自助退营:</label>
                                            <div class="col-sm-4">
                                                <span class="radio_box">
                                                    <input id="new_refund_follow" type="radio" name="new_refund_status"
                                                        checked value="0" data-control-extra="addClass"
                                                        class="my_radio input-has-hide-extra">
                                                    <label for="new_refund_follow"> 跟随全局配置</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="new_refund_close" type="radio" name="new_refund_status"
                                                        value="1" data-control-extra="addClass"
                                                        class="my_radio input-has-hide-extra">
                                                    <label for="new_refund_close"> 关闭</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="new_refund_open" type="radio" name="new_refund_status"
                                                        value="2" data-control-extra="removeClass"
                                                        class="my_radio input-has-hide-extra">
                                                    <label for="new_refund_open"> 开启</label>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="form-group new_refund_status-extra hide">
                                            <div class="col-sm-6 col-sm-offset-2">
                                                <select class="form-control" name="new_refund_time_type"
                                                    style="width:75px;display: inline-block;">
                                                    <option value="0">开营</option>
                                                    <option value="1">结营</option>
                                                </select>
                                                <span>前</span>
                                                <input type="number" name="new_refund_day" class="form-control"
                                                    style="width:62px; display: inline-block;" /> 天用户不可发起
                                            </div>
                                        </div>
                                        <div class="form-group new_refund_status-extra hide">
                                            <div class="col-sm-6 col-sm-offset-2">
                                                <span class="radio_box isRefundBox" data-id="0">
                                                    <input id="isRefund" type="radio" name="new_refund_service_charge" value="0"
                                                        class="my_radio" checked>
                                                    <label for="isRefund">用户发起退款时不展示扣除手续费</label>
                                                </span>
                                                <span class="radio_box isRefundBox" data-id="1">
                                                    <input id="unRefund" type="radio" name="new_refund_service_charge" value="1"
                                                        class="my_radio">
                                                    <label for="unRefund">用户发起退款时展示扣除手续费</label>
                                                </span>
                                                <div class="tipIco" onclick="showTip('如展示扣除手续费，需同时开启退款模板功能，否则不生效。操作路径：资金-退款模板管理')">?</div>
                                            </div>
                                        </div>

                                        <div class="form-group no47 hide">
                                            <label class="control-label col-sm-2">花呗分期:</label>
                                            <div class="col-sm-8">
                                                <span class="radio_box">
                                                    <input id="is_spend_bai_off" type="radio" name="is_spend_bai"
                                                        value="0" class="my_radio" checked>
                                                    <label for="is_spend_bai_off"> 跟随全局配置</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="is_spend_bai_on" type="radio" name="is_spend_bai"
                                                        value="1" class="my_radio">
                                                    <label for="is_spend_bai_on"> 单独配置</label>
                                                </span>
                                                <div class="tipIco" style="cursor: pointer;"
                                                    onclick="showTip(`开启后，符合金额的订单，在支付时将显示我要分期按钮。<br>鉴于微信的审核机制，避免小程序被封，不可露出支付宝相关字样，即点击我要分期后，会提示联系客服索取分期码，请客服人员获取并私下发给客户。<br>获取方式请<a href='https://shimo.im/docs/JWtVRkV3H9hktDTg/'>点此查看教程</a>。`)">
                                                    ?</div>
                                                <div class="form-group is_spend_bai_box hide">
                                                    <p>
                                                        <input id="is_course_list" type="checkbox" value="1">
                                                        <label for="is_course_list"> 小程序营种列表显示“支持分期”字样</label>
                                                    </p>
                                                    <p>
                                                        <input id="is_course_details" type="checkbox" value="1">
                                                        <label for="is_course_details"> 小程序营种详情显示“支持分期”字样</label>
                                                    </p>
                                                    <p>
                                                        <input id="spend_bai_money" placeholder="需大于等于100" type="number"
                                                            name="spend_bai_money" value="1000">
                                                        元以上的订单可分期
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="base-title hide-yanxue" id="nav-share" style="clear: both;">
                                        <h4>分享配置</h4>
                                    </div>
                                    <div class="form-horizontal hide-yanxue">
                                        <!-- 营种分享文案 -->
                                        <div class="form-group no48">
                                            <label class="col-sm-2 control-label">营种分享文案:</label>
                                            <div class="col-sm-10" style="padding-right: 0;">
                                                <span class="radio_box r_on">
                                                    <input id="singlecshare_close" type="radio"
                                                        name="singlecshare_txtstatus" value="1" class="my_radio"
                                                        checked>
                                                    <label for="singlecshare_close">默认跟随全局配置</label>
                                                </span>
                                                <span class="radio_box ">
                                                    <input id="singlecshare_open" type="radio"
                                                        name="singlecshare_txtstatus" value="2" class="my_radio">
                                                    <label for="singlecshare_open">自定义文案</label>
                                                </span><br>
                                                <span class="singlecshare hide"
                                                    style="display: flex;align-items: center;">
                                                    <span>编辑文案：</span><input type="text"
                                                        style="display: inline-block;width: 200px;"
                                                        name="singlecshare_txt" value="" class="form-control" />
                                                </span>
                                            </div>
                                        </div>
                                        <div class="form-group no49">
                                            <label class="col-sm-2 control-label">营种分享卡片背景图:</label>
                                            <div class="col-sm-10" style="padding-right: 0;">
                                                <span class="radio_box r_on">
                                                    <input id="singlecshare_close1" type="radio"
                                                        name="singlecshare_imgstatus" value="1" class="my_radio"
                                                        checked>
                                                    <label for="singlecshare_close1">默认跟随全局配置</label>
                                                </span>
                                                <span class="radio_box ">
                                                    <input id="singlecshare_open1" type="radio"
                                                        name="singlecshare_imgstatus" value="2" class="my_radio">
                                                    <label for="singlecshare_open1">自定义背景图</label>
                                                </span>
                                                <span class="imgvi cshareimgbox hide"
                                                    style="display:block;float: initial;">
                                                    <label>
                                                        <img id="cshareimgsrc"
                                                            src="https://file.dev.xinduobang.cn/images/chrome-ext/1615368309226876.jpeg" />
                                                        <input type="file" id="cshareimg" />
                                                        <input type="hidden" class="imgUrl" name="singlecshare_img" />
                                                        <!--<font class="hidden">&#10005;</font>-->
                                                    </label>
                                                </span>
                                                <div class="cshareimgbox hide"
                                                    style="color: red;display: inline-block;">建议尺寸500*400</div>
                                            </div>
                                        </div>
                                        <div class="form-group no50">
                                            <label class="col-sm-2 control-label">分享海报模板:</label>
                                            <div class="col-sm-10" style="padding-right: 0;">
                                                <span class="radio_box r_on">
                                                    <input id="fx_close" type="radio" name="share_type" value="1"
                                                        class="my_radio" checked>
                                                    <label for="fx_close">默认海报</label>
                                                </span>
                                                <span class="radio_box ">
                                                    <input id="fx_open" type="radio" name="share_type" value="2"
                                                        class="my_radio">
                                                    <label for="fx_open">自定义海报</label>
                                                </span>
                                                <span class="hide">
                                                    <input id="is_hyaline" type="checkbox" name="is_hyaline" value="1">
                                                    <label for="is_hyaline">透明小程序码</label>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="form-group fx-config hide no50">
                                            <label class="col-sm-2 control-label"></label>
                                            <div class="col-sm-10">
                                                <div class="imgvis">
                                                    <input type="file" id="uploadimgfx" />
                                                    <label class="imglabel"
                                                        style="width: 100%;height:100%;margin-right: 0;margin-bottom: 0;position: relative;">
                                                        <img id="ImgPrfx"
                                                            src="https://file.dev.xinduobang.cn/images/chrome-ext/1615368309226876.jpeg" />
                                                        <!-- <input type="file" id="uploadimg2" />-->
                                                        <input class="imgUrl" type="hidden" name="bgsharepic" value="">
                                                        <font class="dn">&#10005;</font>
                                                        <div class="qode">
                                                            <div class="coor"></div>
                                                        </div>
                                                    </label>
                                                </div>
                                                <div class="gray">点击底图上传海报图，拖动小程序码将改变位置，建议底图尺寸750*1334px</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="base-title hide-yanxue" id="nav-bar">
                                        <h4>营中配置</h4>
                                    </div>
                                    <div class="form-horizontal hide-yanxue">
                                        <div class="form-group no51">
                                            <label class="col-sm-2 control-label">会员可互相评论动态:</label>
                                            <div class="col-sm-8">
                                                <span class="radio_box">
                                                    <input id="yhpl_auto" type="radio" name="is_to_comment" value="0"
                                                        class="my_radio" checked>
                                                    <label for="yhpl_auto">跟随全局配置</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="yhpl_open" type="radio" name="is_to_comment" value="1"
                                                        class="my_radio">
                                                    <label for="yhpl_open">开</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="yhpl_close" type="radio" name="is_to_comment" value="2"
                                                        class="my_radio">
                                                    <label for="yhpl_close">关</label>
                                                </span>
                                                <div class="tipIco" style="cursor: pointer;"
                                                    onclick="showTip(`开启则会员可在播报下评论其他会员的评论。关闭则不可。<br>（只要营前会员评论，那么此营期播报相关的员工都可见。）`)">
                                                    ?</div>
                                            </div>
                                        </div>
                                        <div class="form-group no52">
                                            <label class="col-sm-2 control-label">会员评论动态可见:</label>
                                            <div class="col-sm-8">
                                                <span class="radio_box">
                                                    <input id="plkj_auto" type="radio" name="is_look" value="0"
                                                        class="my_radio" checked>
                                                    <label for="plkj_auto">跟随全局配置</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="plkj_open" type="radio" name="is_look" value="1"
                                                        class="my_radio">
                                                    <label for="plkj_open">所有人</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="plkj_close" type="radio" name="is_look" value="2"
                                                        class="my_radio">
                                                    <label for="plkj_close">仅自己（除员工）</label>
                                                </span>
                                                <div class="tipIco" style="cursor: pointer;"
                                                    onclick="showTip(`所有人:此营期会员营种播报的评论其他会员都可见。<br> 仅自己:此营期会员营种播报的评论其他会员不可见。<br>(只要营前会员评论，那么此营期播报相关的员工都可见。)`)">
                                                    ?</div>
                                            </div>
                                        </div>
                                        <div class="form-group no53">
                                            <label class="col-sm-2 control-label">签到签出设置:</label>
                                            <div class="col-sm-6" style="padding-right: 0;">
                                                <span class="radio_box">
                                                    <input id="signin_way_close" type="radio" name="signin_way"
                                                        value="1" checked class="my_radio">
                                                    <label for="signin_way_close">营期</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="signin_way_open" type="radio" name="signin_way" value="2"
                                                        class="my_radio">
                                                    <label for="signin_way_open">每日</label>
                                                </span>
                                                <div class="tipIco" style="cursor: pointer;"
                                                    onclick="showTip(`营期:营期开始签到一次，营期结束签到一次。<br>每日:营期开始-营期结束    每日都需签到一次`)">
                                                    ?</div>
                                            </div>
                                        </div>
                                        <div class="form-group no54">
                                            <label class="col-sm-2 control-label">勋章自动发放:</label>
                                            <div class="col-sm-10" style="padding-right: 0;">
                                                <span class="radio_box r_on">
                                                    <input id="xz_close" type="radio" name="is_medal" value="0"
                                                        class="my_radio" checked>
                                                    <label for="xz_close">关闭</label>
                                                </span>
                                                <span class="radio_box ">
                                                    <input id="xz_open" type="radio" name="is_medal" value="1"
                                                        class="my_radio">
                                                    <label for="xz_open">开启</label>
                                                </span>
                                                <div class="tipIco" style="cursor: pointer;"
                                                    onclick="showTip('开启后将会在营种结营后自动对该营期下的所有营员进行勋章发放')">?</div>
                                            </div>
                                        </div>
                                        <div class="form-group no54 medal_list hide">
                                            <label class="col-sm-2 control-label"></label>
                                            <div class="col-sm-10" style="padding-right: 0;display: flex;">
                                                <label class="control-label col-sm-1"
                                                    style="text-align: left;">选择勋章:</label>
                                                <div class="col-sm-7">
                                                    <select multiple="" class="medalbox form-control"
                                                        style="display: inline-block;width: 200px"></select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group no55 is_show_hide">
                                            <label class="col-sm-2 control-label">营员虚拟币排行榜:</label>
                                            <div class="col-sm-9">
                                                <span class="radio_box">
                                                    <input id="n_is_coinrank" type="radio" name="is_coinrank" value="1"
                                                        class="my_radio" checked>
                                                    <label for="n_is_coinrank">关闭</label>
                                                </span>
                                                <span class="radio_box">
                                                    <input id="y_is_coinrank" type="radio" name="is_coinrank" value="2"
                                                        class="my_radio">
                                                    <label for="y_is_coinrank">开启</label>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="form-group" id="integral-control">
                                            <label class="col-sm-2 control-label">参营获得营员积分: </label>
                                            <div class="col-sm-10" style="padding-right: 0;">
                                                    <span class="radio_box r_on">
                                                        <input id="integral_close" type="radio" name="is_gain_integral"
                                                               value="0" class="my_radio">
                                                        <label for="integral_close">关闭</label>
                                                    </span>
                                                <span class="radio_box ">
                                                        <input id="integral_open" type="radio" name="is_gain_integral"
                                                               value="1" class="my_radio">
                                                        <label for="integral_open">开启</label>
                                                    </span>
                                            </div>
                                        </div>
                                        <div class="form-group hide" id="gain_integral_condition">
                                            <label class="col-sm-2 control-label"></label>
                                            <div class="col-sm-10"
                                                 style="padding-right: 0;display: flex; line-height: 33px;">
                                                结营后将获得&nbsp;&nbsp;
                                                <input type="number" style="width: 200px;" id="gain-integral-num"
                                                       class="form-control">
                                                &nbsp;&nbsp;营员积分
                                            </div>
                                        </div>
                                        <!--<div class="form-group no56">
                                                <label class="col-sm-2 control-label">往期回顾:</label>
                                                <div class="col-sm-8" style="padding-right: 0;">
                                                    <span class="radio_box">
                                                        <input id="lookback_close" type="radio" name="lookback" value="0" class="my_radio">
                                                        <label for="lookback_close">关闭</label>
                                                    </span>
                                                    <span class="radio_box">
                                                        <input id="lookback_open" type="radio" name="lookback" value="1" class="my_radio">
                                                        <label for="lookback_open">开启</label>
                                                    </span>
                                                    <div class="tipIco" onclick="showTip('开启该功能后，小程序营种详情页将会显示往期回顾入口')">?</div>
                                                </div>
                                            </div>-->
                                    </div>

                                    <div style="height: 74px"></div>
                                    <div class="right-nav right-nav-2 hide-yanxue">
                                        <a class="right-nav-link right-nav-act" href="#nav-sale"
                                            onclick="actNav(event)">● 价格配置</a>
                                        <a class="right-nav-link" href="#nav-receive-discount" onclick="actNav(event)">●
                                            购买享优惠</a>
                                        <a class="right-nav-link" href="#nav-send-discount" onclick="actNav(event)">●
                                            购买送优惠</a>
                                        <div class="nav-parent">
                                            <a class="right-nav-link" href="#nav-parenting" onclick="actNav(event)">●
                                                亲子营销</a>
                                        </div>
                                        <a class="right-nav-link" href="#nav-sales" onclick="actNav(event)">● 销量配置</a>
                                        <a class="right-nav-link" href="#nav-sign-up" onclick="actNav(event)">● 报名配置</a>
                                        <a class="right-nav-link" href="#nav-share" onclick="actNav(event)">● 分享配置</a>
                                        <a class="right-nav-link" href="#nav-bar" onclick="actNav(event)">● 营中配置</a>
                                    </div>
                                    <div class="addBox btn-box">
                                        <?php
                                                if($platform_status){
                                                ?>
                                        <button type="button"
                                            class="btn btn-large btn-default prev-btn mr15">上一步</button>
                                        <?php
                                            }else{
                                            ?>
                                        <button type="button"
                                            class="btn btn-large btn-default step3-prev-btn mr15">上一步</button>

                                        <?php
                                                }
                                            ?>
                                        <button type="button"
                                            class="btn btn-large btn-primary save-btn mr15">保存</button>
                                        <!-- <button type="button" class="btn btn-large btn-success save-up-btn hide">保存并上架</button> -->
                                        <button type="button"
                                            class="btn btn-large btn-success save-up-btn1 form-horizontal hide-yanxue">保存并公开售卖</button>
                                        <button type="button"
                                            class="btn btn-large btn-success save-up-btn2 form-horizontal hide-yanxue">保存并非公开售卖</button>
                                        <button type="button"
                                            class="btn btn-large btn-success save-up-btn3 form-horizontal hide-yanxue">保存并预览</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="tablestore hide"></div>

<div class="modal fade" id="givecardTipDialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">购买送券说明</h4>
            </div>
            <div class="modal-body myCommentContent">
                <div class="form-horizontal">
                    <div class="form-group">
                        <label class="control-label col-sm-9">此处可选的只能是发放类型为【购买送券】的优惠券</label>
                    </div>
                </div>
            </div>
            <div class="modal-footer myCommentFooter">
                <button type="button" class="btn btn-info" data-dismiss="modal" id="trueBtn">确定</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="qrcodeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="myNoticeModalLabel">链接</h4>
            </div>
            <div class="modal-body myNoticeContent" style="text-align:center;">
                <div class="extensionUrl"></div>
                <div id="bigqr"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>

<!-- 保存并预览二维码-->
<div class="modal fade" id="codeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="code_link">链接</h4>
            </div>
            <div class="modal-body myNoticeContent" style="text-align:center;">
                <div class="codeUrl"></div>
                <div id="codeImg"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>

<!-- 集合地 -->
<div class="modal fade bs-example-modal-lg" id="gatherDialog" tabindex="-1" role="dialog"
     aria-labelledby="myLargeModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">添加<span id="not_gather">启程</span>集合地点与时间</h4>
            </div>
            <div class="modal-body myCommentContent">
                <div class="form-horizontal">
                    <div class="form-group">
                        <label class="col-sm-2 control-label"><span class="must">*</span> 集合地点:</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" placeholder="请输入集合地点" id="searchMapInput">
                            <div id="completeBox"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label"></label>
                        <div class="col-sm-10">
                            <div id="tencentMap"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">集合时间:</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="gatherTime" placeholder="请选择集合时间">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label"> 补充地址:</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="getaddress" placeholder="请输入补充地址">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label"> 接送方式:</label>
                        <div class="col-sm-10">
                            <select class="form-control" id="pick_up_way">
                                <option value="0">无</option>
                                <option value="1" id="jsfs">家长送</option>
                                <option value="2">无成人陪伴</option>
                                <option value="3">老师带队</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label"> 家长备注:</label>
                        <div class="col-sm-8">
                                <span class="radio_box r_on">
                                    <input id="parent_remark_close" type="radio" name="gather_premark" value="0"
                                           class="my_radio" checked>
                                    <label for="parent_remark_close">关闭</label>
                                </span>
                            <span class="radio_box">
                                    <input id="parent_remark_open" type="radio" name="gather_premark" value="1"
                                           class="my_radio">
                                    <label for="parent_remark_open">开启</label>
                                </span>
                            <span style="color: #ccc;">家长选择集合地点与时间的时候可以填写备注信息</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer myCommentFooter">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="gatherTrueBtn">确定</button>
            </div>
        </div>
    </div>
</div>

<!-- 批量添加营期 -->
<div class="modal fade" id="batchPeriodModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">批量添加营期</h4>
            </div>
            <div class="modal-body">
                <div class="form-horizontal">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">
                            <span class="must">*</span> 期次开始时间:</label>
                        <div class="col-sm-10" id="calendar-box">

                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">
                            期次名称:</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control bp-period-name">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">
                            <span class="must">*</span> 出营天数:</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control bp-days">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">
                            <span class="must">*</span> 报名截止时间:</label>
                        <div class="col-sm-9">
                            开营前 <input style="width:50px;display:inline-block" placeholder="" type="tel"
                                       class="form-control time-ipt"> 天<input type="tel"
                                                                              style="width:50px;display:inline-block" class="form-control time-ipt1">小时<input
                                style="width:50px;display:inline-block" type="tel"
                                class="form-control time-ipt2">分，结束报名

                            <div style="font-size: 12px;margin-top: 10px;">天数填0默认为营期开始当天</div>
                        </div>

                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">
                            <span class="must">*</span> 批量设置库存:</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control bp-stock">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">批量设置销量:</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control salenum">
                        </div>
                        <div class="col-sm-2" style="padding: 0;">
                            <div class="tipIco" style="cursor: pointer;"
                                 onclick="showTip('填写此项后不会影响真正的库存，只会在用户端显示该销量')">?</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">批量设置剩余库存:</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control leaftnum">
                        </div>
                        <div class="col-sm-2" style="padding: 0;">
                            <div class="tipIco" style="cursor: pointer;"
                                 onclick="showTip('填写此项后不会影响真正的库存，只会在用户端显示该剩余库存')">?</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="batchPeriodBtn">生成</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>

<!-- 隐藏营期 -->
<div class="modal fade" id="hidePeriodList" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">隐藏营期</h4>
            </div>
            <div class="modal-body" id="hidelist">
                <p>勾选后对应的营期将不会在营前用户端显示</p>
            </div>
            <div class="modal-footer">
                <button type="button" style="width: 68px;" class="btn btn-primary" id="check-period">全选</button>
                <button type="button" class="btn btn-primary" id="sub-hide-period">保存</button>
                <button type="button" class="btn btn-default" onclick="qxhide()" data-dismiss="modal">取消</button>
            </div>
        </div>
    </div>
</div>


<!--批量删除营期-->
<div class="modal fade" id="delperiodDialog" tabindex="-1" role="dialog" aria-labelledby="sale">
    <div class="modal-dialog " role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">批量删除营期</h4>
            </div>
            <div class="modal-body clearfix" id="delperiodlist">

            </div>
            <div class="modal-footer myCommentFooter">
                <button type="button" class="btn btn-primary" id="selpidall">全选</button>
                <button type="button" class="btn btn-primary" id="delpid">批量删除</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            </div>
        </div>
    </div>
</div>


<!--购买送券选择-->
<div class="modal fade bs-example-modal-lg" id="cardlistmode" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">选择优惠券:</h4>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    优惠券名称：<input type="text" name="cardnames" class="form-control"
                                 style="display: inline-block;width: 200px;" />
                    <a href="javascript:;" class="btn btn-primary addBtn searchcardlist">搜索</a>
                </div>
                <table class="table table-bordered table-hover">
                    <thead>
                    <th></th>
                    <th>优惠券名称</th>
                    <th>优惠金额</th>
                    <th>使用限制</th>
                    <th>有效期限</th>
                    <th>创建时间</th>
                    </thead>
                    <tbody id="tbody-cardlist">

                    </tbody>
                </table>
                <div id="pageicon" class="clearfix" style="display: flex;justify-content: center;"></div>
            </div>
            <div class="modal-footer" style="text-align: center;">
                <button type="button" class="btn btn-primary" id="editCard">确定</button>
            </div>
        </div>
    </div>
</div>

<script type="template" id="saleTplcard">
    {{if list.length }}
    {{ each list as value index }}
    <tr>
        <td class="tdcon"><input type="checkbox" data-id="{{value.card_id}}" data-name="{{value.name}}" /></td>
        <td class="tdcon">{{value.name}}</td>
        <td class="tdcon">{{value.money}}</td>
        <td class="tdcon">{{value.is_use_limit}}-{{value.is_all_goods}}</td>
        <td class="tdcon">{{value.start_end}}</td>
        <td class="tdcon">{{value.addtime}}</td>
    </tr>
    {{ /each }}
    {{else}}
    <tr>
        <td colspan="6" align="center">
            暂无数据
        </td>
    </tr>
    {{/if}}
</script>
<script src="__PUBLIC__/js/uploadPreview.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/js/bootstrap.min.js"></script>
<script src="__PUBLIC__/laydate/laydate.js?v=3" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/js/selectize.js?v={$static_version}"></script>
<script src="__PUBLIC__/js/sku-stock-course.js?v=1226"></script>
<script src="__PUBLIC__/js/template.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/js/mricode.pagination.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdn.staticfile.org/moment.js/2.29.1/moment.min.js"></script>
<script charset="utf-8" src="https://map.qq.com/api/js?v=2.exp&key=FK3BZ-V35RK-BCPJS-AGPC6-LG4LF-4EFKW"></script>
<script src="__PUBLIC__/laydate/laydate.js" type="text/javascript" charset="utf-8"></script>
<include file="./Application/Admin/View/Index/init_wangeditor.html" />
<include file="./Application/Admin/View/Index/init_colorpicker.html" />
<script>
    const isYanxue = getId('is_yanxue') == 1 ? true : false;
    const isXiaShan = /xiashan/.test(location.toString()) || /dev.xinduobang.cn/.test(location.toString());
    let integralName = '营员积分'; // 营员积分名称
    let hasGetInfo = false;
    let courseSkuData = null; // 保存过的营期sku库存信息 Admin/Course/course_sku
    let courseSkuPriceData = null; // 保存过的sku定价信息 Admin/Goods/courseGoodsSku

    var default_contract_id = 0

    if (window.location.href.indexOf("guyuyanxue.co") != -1) {
        $("input[name=add_status][value=1]").prop("checked", true)
    }

    if (isXiaShan === false) {
        $('#integral-control').hide();
    }

    // 获取营员积分名称
    function getIntegralName() {
        let loading = null;
        $.ajax({
            url: '__APP__/Admin/Points/getIntegralList',
            data: {},
            method: 'post',
            beforeSend() {
                loading = layer.load(1, {
                    shade: [0.3, '#000']
                });
            }
        }).done(function (res) {
            layer.close(loading);
            if (res.code != 0) return layer.msg(res.msg);
            integralName = res.integral_name || integralName;

            let reg = /营员积分/g

            let htmlStr1 = $('#integral-control').html()
            htmlStr1 = htmlStr1.replace(reg, function (match) {
                return integralName;
            })

            reg.lastIndex = 0;

            $('#integral-control').html(htmlStr1);

            let htmlStr2 = $('#gain_integral_condition').html();
            htmlStr2 = htmlStr2.replace(reg, function (match) {
                return integralName;
            })
            $('#gain_integral_condition').html(htmlStr2);

            $('input[name="is_gain_integral"]').on('change', function () {
                $(this).val() == 1 && $('#gain_integral_condition').removeClass('hide');
                $(this).val() == 0 && $('#gain_integral_condition').addClass('hide');
            })
        })
    }
    getIntegralName();

    $('.fa-refresh').on('click', function (event) {
        event.preventDefault();
        getSelectInfo()
    });
    // 购买送券
    var selectedcards = [], removeid = [], sell_num = 0, typestr = '';
    $(".addbuy").click(function () {
        removeid = []
        $("#tbody-cardlist").html("")
        $("#cardlistmode input[name=cardnames]").val("")
        $("#cardlistmode").modal()
        for (var i = 0; i < $("#selbucard tr").length; i++) {
            var id = $($("#selbucard tr")[i]).find(".movecard").data("id")
            removeid.push(id)
        }
        goodsCardLists()
    })
    $("#editCard").click(function () {
        selectedcards = []
        var list = $("#tbody-cardlist tr")
        for (var i = 0; i < list.length; i++) {
            var obj = {}
            if ($(list[i]).find("input[type=checkbox]").prop("checked")) {
                obj.cardid = $(list[i]).find("input[type=checkbox]").data("id")
                obj.name = $(list[i]).find("input[type=checkbox]").data("name")
                selectedcards.push(obj)
            }
        }
        $("#cardlistmode").modal("hide")

        var htmls = ""
        for (var i = 0; i < selectedcards.length; i++) {
            htmls += `
                        <tr>
                            <td>${selectedcards[i].name}</td>
                            <td><input type="number" style="width: 90px;" min="1" value="1" /></td>
                            <td><a href="javascript:;" class="movecard" data-id="${selectedcards[i].cardid}">移除</a></td>
                        </tr>
                    `
        }
        $("#selbucard").append(htmls)
        $("#cardlistchecked").removeClass("hide")
        var checknum = 0
        for (var i = 0; i < $("#selbucard tr").length; i++) {
            checknum += Number($($("#selbucard tr")[i]).find("input[type='number']").val())

        }
        if ($("#selbucard tr").length == 0) {
            $("#cardlistchecked").addClass("hide")
        }
        $(".checkednum").html(`已选择${checknum}张`)

    })

    //	购买送券搜索
    $(".searchcardlist").click(function () {
        goodsCardLists()
    })
    //	监听购买送券数字框
    $("#selbucard").on("change", "input[type=number]", function () {
        var checknum = 0
        for (var i = 0; i < $("#selbucard tr").length; i++) {
            checknum += Number($($("#selbucard tr")[i]).find("input[type='number']").val())

        }
        $(".checkednum").html(`已选择${checknum}张`)
    })
    //	购买送券移除
    $("#selbucard").on("click", ".movecard", function () {
        $(this).parents("tr").remove()

        if ($("#selbucard tr").length == 0) {
            $("#cardlistchecked").addClass("hide")
        }
        var checknum = 0
        for (var i = 0; i < $("#selbucard tr").length; i++) {
            checknum += Number($($("#selbucard tr")[i]).find("input[type='number']").val())
        }
        $(".checkednum").html(`已选择${checknum}张`)
    })

    //	标签限制字符
    $('input[name=remind_subtit]').bind('input propertychange', function () {
        console.log("正在输入...");
    });

    function goodsCardLists() {
        var loading = layer.load(2, {
            shade: [0.3, '#000']
        });
        if ($("#pageicon").pagination()) {
            $("#pageicon").pagination('destroy');
        }
        $("#pageicon").pagination({
            pageSize: 10,
            pageBtnCount: 7,
            remote: {
                url: '/Admin/Goods/getCardList',
                pageParams: function (data) {
                    pageNum = data.pageIndex + 1;
                    return {
                        pageNum: pageNum,
                        pageSize: data.pageSize,
                        name: $('#cardlistmode').find("input[name=cardnames]").val(),
                        card_id: removeid.join(",")
                    }
                },
                success: function (res) {
                    layer.close(loading);
                    if (res.code != 0) {
                        layer.msg(res.msg);
                        return;
                    }
                    var htmlStr = template(`saleTplcard`, res);
                    $(`#tbody-cardlist`).html(htmlStr);


                },
                totalName: 'totalnum'
            }
        });
    }
    //	购买送券结束

    if ($("#is_show_hide").val() == 1) {
        $(".is_show_hide").hide()
    }
    var product_type_patch = 0;
    var navigitecolorset = { bgcolor: '#f33620', fontcolor: '#fff', bgcolor1: '#fed9e2', fontcolor1: '#ff0052', fontcolor2: '#fff' };
    var signBg = '#e94f4f';	// 报名按钮背景颜色
    var signText = '#fff';	// 报名按钮文字颜色

    // 获取内部备注表单
    !isYanxue && getmarkform();

    $(function () {

        window.location.href.indexOf("https://meiban.co.xinduobang.cn/") != -1 && $(".weixins").html("微信咨询")

        //营种分享文案
        $("input[name=singlecshare_txtstatus]").on("change", function () {
            $('.singlecshare')[$(this).val() == 1 ? 'addClass' : 'removeClass']('hide')
        })
        //营种分享图片
        $("input[name=singlecshare_imgstatus]").on("change", function () {
            $('.cshareimgbox')[$(this).val() == 1 ? 'addClass' : 'removeClass']('hide')
        })

        // 获取勋章
        !isYanxue && getmedalajax();

        // 这个方法写在top_new.html里
        !isYanxue && fnSetDingjin();

        // $('#yxqbox').find('label').removeClass('r_on')
        //          添加自定义有效期隐藏显示
        $('[name=hx_status]').on('change', function (event) {
            $('#self_box').css("display", $(this).val() == 1 ? "block" : "none")
            $('#yxqbox').css("display", $(this).val() == 1 ? "block" : "none")
            $('.hx_num_box')[$(this).val() == 1 ? 'removeClass' : 'addClass']('hide');
            $(this).val() != 1 && $('#hx_isValid').prop("checked", false) && $(".isValid_list").css("display", "none")
        });
        $("input[name=line_up]").on("change", function () {
            $('.line_up_min')[$(this).val() == 1 ? 'removeClass' : 'addClass']('hide')
        })
        $('input[name=line_up_min]').on("change", function () {
            let reg = /^[1-9]\d*$/;
            if (!reg.test($(this).val())) {
                $(this).val('')
            }
        })
        $("#hx_isValid").on("change", function () {
            $(".isValid_list").css("display", $(this).is(':checked') ? "block" : "none")
        })
        // 报名时限
        $('input[name=edit_form_status]').on("change", function () {
            $('.edit_form_date').css("display", $('#edit_status_one').prop("checked") ? "none" : "block")
        })
        // 提醒公告
        $('input[name=on_off_notice]').on("change", function () {
            $('.notice_detail_box').css("display", $('#off_notice').prop("checked") ? "none" : "block")
        })
        // 报名预热
        $('input[name=is_startsale]').on("change", function () {
            $('.startsale_detail').css("display", $('#off_startsale').prop("checked") ? "none" : "block")
        })
        // 报名成功广告
        $('input[name=poster_select_type]').on("change", function () {
            $('.show-target').css("display", $('#select-img').prop("checked") ? "none" : "inline-block")
        })
        // 花呗分期开关
        $('input[name=is_spend_bai]').on('change', function () {
            const isOwn = $(this).val() == 1;
            $('.is_spend_bai_box')[isOwn ? 'removeClass' : 'addClass']('hide')
            $('#is_course_list').prop('checked', isOwn ? true : false)
            $('#is_course_details').prop('checked', isOwn ? true : false)
            $('[name=spend_bai_money]').val(isOwn ? 1000 : '')
        })
        // 待客下单欢迎图
        $('input[name=is_dk_welcome]').on("change", function () {
            $('.welcomeimg-box')[$(this).val() == 1 ? 'removeClass' : 'addClass']('hide')
        })
        laydate.render({
            elem: 'input[name=startsale_time]',
            trigger: 'click',
            type: 'datetime'
        });

    })

    // 配置限期优惠颜色
    $('#bgcolor').spectrum(makeSpectrumOption('#f33620', 'navigitecolorset.bgcolor'))
    $('#fontcolor').spectrum(makeSpectrumOption('#fff', 'navigitecolorset.fontcolor'))
    $('#bgcolor1').spectrum(makeSpectrumOption('#fed9e2', 'navigitecolorset.bgcolor1'))
    $('#fontcolor1').spectrum(makeSpectrumOption('#ff0052', 'navigitecolorset.fontcolor1'))
    $('#fontcolor2').spectrum(makeSpectrumOption('#fff', 'navigitecolorset.fontcolor2'))
    // 标签文字颜色
    let remindText = ''
    $('#remindText').val('#fff').spectrum(makeSpectrumOption('#fff', 'remindText'))
    // 标签背景颜色
    let remindBg = ''
    $('#remindBg').val('#51d572').spectrum(makeSpectrumOption('#51d572', 'remindBg'))
    // 文字颜色
    $('#signText').spectrum(makeSpectrumOption('#fff', 'signText'))
    // 背景颜色
    $('#signBg').spectrum(makeSpectrumOption('#e94f4f', 'signBg'))

    var editorFeature = new Editor('textarea1', ['head', 'bold', 'fontSize', 'italic', 'underline', 'strikeThrough', 'foreColor', 'backColor', 'list', 'justify', 'screenshot', 'image', 'table', 'video', 'undo', 'redo'])
    var editorNotice = new Editor('textarea2')

    var addSkuBtn = $('.addSku'),  // 添加规格项目按钮
        addPeriodBtn = $('.addPeriod'),
        hidePeriodBtn = $('.hidePeriod'),
        periodConBox = $('.period-con'),
        specStockBox = $('.spec-stock-box'),
        skuStockConBox = $('.sku-stock-box'),
        periodItem = $('.period-item'),
        delPeriodBtn = $('.del-period'),
        skuCon = $('.skuCon'),
        periodIndex = 1
    skuFlag = true,
        cid = getId('cid'),
        pid = getId('pid'),
        starttime = '',
        endtime = '',
        bendtime = '',
        his = '',
        priceType = $('.price-type'),
        isChecked = $('input[id=is_check_age]'),
        isChildChecked = $('input[name="is_check_age"]'),
        isCheckAge = 0;
    var openGather = $('#openGather'),
        closeGather = $('#closeGather'),
        gatherBox = $('#gatherBox'),
        gatherList = gatherBox.find('.gather-list');
    var e_openGather = $('#e_openGather'),
        e_closeGather = $('#e_closeGather'),
        e_gatherBox = $('#e_gatherBox'),
        e_gatherList = e_gatherBox.find('.e_gather-list');

    var hasSetDestine = false; // 编辑商品时 获取商品详情里有没有渲染预订价格(根据营期设置的数据)  没有就用获取营期里的营期渲染
    var bindSchoolId = ''; // 研学产品绑定的学校id
    var productUpdateStatus = 2; // 研学产品默认下架状态

    //集合地点 S
    !isYanxue && loadmap();

    function loadmap() {
        var addGather = $('#addGather'),
            e_addGather = $('#e_addGather'),
            gatherDialog = $('#gatherDialog'),
            gatherTime = $('#gatherTime'),
            getaddress = $('#getaddress'),
            pick_up_way = $('#pick_up_way'),
            searchMapInput = $('#searchMapInput'),
            completeBox = $('#completeBox'),
            gatherTrueBtn = $('#gatherTrueBtn'),
            tencentBack = null;
        searchTimer = null,
            gatherCheckIndex = 0,
            map = null,
            mapMarker = null,
            lat = 0,
            lng = 0,
            editGatherIndex = 0,
            editGatherFlag = false;

        laydate.render({
            elem: '#gatherTime',
            range: true,
            trigger: 'click',
            type: 'time',

            format: 'HH:mm'
        });

        //删除集合地
        gatherBox.on('click', '.delete-gather', function () {
            $(this).parent().remove();
        });
        e_gatherBox.on('click', '.delete-gather', function () {
            $(this).parent().remove();
        });
        //编辑集合地
        gatherBox.on('click', '.edit-gather', function () {
            var btn = $(this);
            $('#gatherDialog #not_gather').html('启程')
            $('#gatherDialog #jsfs').html('家长送')
            editGatherFlag = true;
            editGatherIndex = Number(btn.parent().index());

            lat = Number(btn.attr('lat'));
            lng = Number(btn.attr('lng'));
            searchMapInput.val(btn.siblings('.gather-li-address').val());
            gatherTime.val(btn.siblings('.gather-li-time').val());
            getaddress.val(btn.siblings('.gather-li-getaddress').val());
            pick_up_way.val(btn.siblings('.gather-li-pick').val());
            if (btn.siblings('.gather-parent-remark').val() == 1) {
                $('#parent_remark_close').prop("checked", false).parent().removeClass('r_on');
                $('#parent_remark_open').prop("checked", true).parent().addClass('r_on');
            } else {
                $('#parent_remark_close').prop("checked", true).parent().addClass('r_on');
                $('#parent_remark_open').prop("checked", false).parent().removeClass('r_on');
            }
            gatherDialog.modal('toggle');

            map.panTo(new qq.maps.LatLng(lat, lng));
            map.zoomTo(17);
            if (mapMarker) {
                mapMarker.setMap(null);
            }
            mapMarker = new qq.maps.Marker({
                position: new qq.maps.LatLng(lat, lng),
                map: map
            });
        });
        e_gatherBox.on('click', '.edit-gather', function () {
            var btn = $(this);
            $('#gatherDialog #not_gather').html('返程')
            $('#gatherDialog #jsfs').html('家长接')
            editGatherFlag = true;
            editGatherIndex = Number(btn.parent().index());

            lat = Number(btn.attr('lat'));
            lng = Number(btn.attr('lng'));
            searchMapInput.val(btn.siblings('.gather-li-address').val());
            gatherTime.val(btn.siblings('.gather-li-time').val());
            getaddress.val(btn.siblings('.gather-li-getaddress').val());
            pick_up_way.val(btn.siblings('.gather-li-pick').val());
            if (btn.siblings('.gather-parent-remark').val() == 1) {
                $('#parent_remark_close').prop("checked", false).parent().removeClass('r_on');
                $('#parent_remark_open').prop("checked", true).parent().addClass('r_on');
            } else {
                $('#parent_remark_close').prop("checked", true).parent().addClass('r_on');
                $('#parent_remark_open').prop("checked", false).parent().removeClass('r_on');
            }
            gatherDialog.modal('toggle');

            map.panTo(new qq.maps.LatLng(lat, lng));
            map.zoomTo(17);
            if (mapMarker) {
                mapMarker.setMap(null);
            }
            mapMarker = new qq.maps.Marker({
                position: new qq.maps.LatLng(lat, lng),
                map: map
            });
        });
        // 添加集合地点
        addGather.on('click', function () {
            searchMapInput.val('');
            gatherTime.val('');
            getaddress.val('');
            $('#parent_remark_close').prop("checked", true).parent().addClass('r_on');
            $('#parent_remark_open').prop("checked", false).parent().removeClass('r_on');
            pick_up_way.val(0);
            $('#gatherDialog #not_gather').html('启程')
            $('#gatherDialog #jsfs').html('家长送')
            gatherDialog.modal('toggle');
        });
        e_addGather.on('click', function () {
            searchMapInput.val('');
            gatherTime.val('');
            getaddress.val('');
            $('#parent_remark_close').prop("checked", true).parent().addClass('r_on');
            $('#parent_remark_open').prop("checked", false).parent().removeClass('r_on');
            pick_up_way.val(0);
            $('#gatherDialog #not_gather').html('返程')
            $('#gatherDialog #jsfs').html('家长接')
            gatherDialog.modal('toggle');
        });
        //隐藏集合地模态框
        gatherDialog.on('hidden.bs.modal', function (e) {
            editGatherFlag = false;
        });
        //开启
        openGather.on('click', function () {
            gatherBox.removeClass('hide');
            $("#gathersel").removeClass('hide');
        });
        e_openGather.on('click', function () {
            e_gatherBox.removeClass('hide');
            $("#e_gathersel").removeClass('hide');
        });
        //关闭
        closeGather.on('click', function () {
            gatherBox.addClass('hide');
            $("#gathersel").addClass('hide');
        });
        e_closeGather.on('click', function () {
            e_gatherBox.addClass('hide');
            $("#e_gathersel").addClass('hide');
        });
        $("#gather_typeprv").on('click', function () {
            $("#is_sms_gather").addClass('hide');
        });
        $("#e_gather_typeprv").on('click', function () {
            $("#e_is_sms_gather").addClass('hide');
        });
        $("#gather_typenext").on('click', function () {
            $("#is_sms_gather").removeClass('hide');
        });
        $("#e_gather_typenext").on('click', function () {
            $("#e_is_sms_gather").removeClass('hide');
        });
        //选择地图返回地点
        completeBox.on('click', 'p', function () {
            searchMapInput.val($(this).text());
            gatherCheckIndex = Number($(this).attr('i'));
            completeBox.hide();
            var loc = tencentBack[gatherCheckIndex].location;
            var latlng = new qq.maps.LatLng(loc.lat, loc.lng);
            lat = loc.lat;
            lng = loc.lng;
            map.panTo(latlng);
            map.zoomTo(17);
            if (mapMarker) {
                mapMarker.setMap(null);
            }
            mapMarker = new qq.maps.Marker({
                position: latlng,
                map: map
            });
        });

        gatherTrueBtn.on('click', function () {
            let not_gather = $('#not_gather').html()
            var v = searchMapInput.val(),
                t = gatherTime.val(),
                g = getaddress.val(),
                p = $('#pick_up_way option:selected').html(),
                pv = pick_up_way.val(),
                remark = $('input[name=gather_premark]:checked').val(),
                remarkval = remark == 1 ? '已开启家长备注' : '已关闭家长备注',
                tmp = '';
            if (lat == 0 || lng == 0 || !v) {
                layer.msg('请输入集合地点');
                return;
            }
            if (not_gather == '启程') {
                tmp = `集合地点 <input readonly class="form-control gather-li-address w300" type="text" value="` + v + `" name="gatheraddr[]" />
                        集合时间 <input readonly class="form-control gather-li-time w300" type="text" value="` + t + `" name="gathertime[]" />
                        补充地址 <input readonly class="form-control gather-li-getaddress w300" type="text" value="` + g + `" name="getaddress[]" />
                        接送方式 <input readonly class="form-control w300" type="text" value="` + p + `" />
                        ${remarkval}
                        <input type="hidden" class="gather-li-pick" value="` + pv + `" name="pick_up_way[]" />
                        <input type="hidden" class="gather-parent-remark" value="` + remark + `" name="gather_premark[]" />
                        <a class="glyphicon glyphicon-trash delete-gather" href="javascript:;"></a>
                        <a class="glyphicon glyphicon-pencil edit-gather" href="javascript:;" lat="` + lat + `" lng="` + lng + `"></a>
                        <input type="hidden" name="latlng[]" value="` + lat + `,` + lng + `" />`;
            } else {
                tmp = `集合地点 <input readonly class="form-control gather-li-address w300" type="text" value="` + v + `" name="e_gatheraddr[]" />
                        集合时间 <input readonly class="form-control gather-li-time w300" type="text" value="` + t + `" name="e_gathertime[]" />
                        补充地址 <input readonly class="form-control gather-li-getaddress w300" type="text" value="` + g + `" name="e_getaddress[]" />
                        接送方式 <input readonly class="form-control w300" type="text" value="` + p + `" />
                        ${remarkval}
                        <input type="hidden" class="gather-li-pick" value="` + pv + `" name="e_pick_up_way[]" />
                        <input type="hidden" class="gather-parent-remark" value="` + remark + `" name="e_gather_premark[]" />
                        <a class="glyphicon glyphicon-trash delete-gather" href="javascript:;"></a>
                        <a class="glyphicon glyphicon-pencil edit-gather" href="javascript:;" lat="` + lat + `" lng="` + lng + `"></a>
                        <input type="hidden" name="e_latlng[]" value="` + lat + `,` + lng + `" />`;
            }
            if (not_gather == '启程' && editGatherFlag) {
                $('#gatherBox .gather-li').eq(editGatherIndex).html(tmp);
            } else if (not_gather == '启程' && !editGatherFlag) {
                gatherList.append(`<div class="gather-li">` + tmp + `</div>`);
            } else if (not_gather == '返程' && editGatherFlag) {
                $('#e_gatherBox .gather-li').eq(editGatherIndex).html(tmp);
            } else if (not_gather == '返程' && !editGatherFlag) {
                e_gatherList.append(`<div class="gather-li">` + tmp + `</div>`);
            }
            gatherDialog.modal('toggle');

        });

        var citylocation = null,
            center = new qq.maps.LatLng(39.916527, 116.397128),
            region = '';

        map = new qq.maps.Map(document.getElementById('tencentMap'), {
            center: center,
            zoom: 11
        });

        citylocation = new qq.maps.CityService();
        //请求成功回调函数
        citylocation.setComplete(function (result) {
            map.setCenter(result.detail.latLng);
            region = 'region(' + result.detail.name + ',1)';
        });
        //请求失败回调函数
        citylocation.setError(function () {
            console.log("出错了，请输入正确的经纬度！！！");
        });
        citylocation.searchLocalCity();

        //点击地图
        qq.maps.event.addListener(map, 'click', function (e) {
            if (mapMarker) {
                mapMarker.setMap(null);
            }
            mapMarker = new qq.maps.Marker({
                position: e.latLng,
                map: map
            });

            $.ajax({
                url: 'https://apis.map.qq.com/ws/geocoder/v1/',
                type: 'GET',
                dataType: 'jsonp',
                data: {
                    location: e.latLng.lat + ',' + e.latLng.lng,
                    key: 'FK3BZ-V35RK-BCPJS-AGPC6-LG4LF-4EFKW',
                    output: 'jsonp'
                },
                success: function (data) {
                    searchMapInput.val(data.result.formatted_addresses.recommend);
                    lat = data.result.location.lat;
                    lng = data.result.location.lng;
                }
            })
        });

        searchMapInput.on('input', function () {
            var v = searchMapInput.val();
            if (v == '') {
                return;
            }
            clearTimeout(searchTimer);
            searchTimer = setTimeout(function () {
                $.ajax({
                    url: 'https://apis.map.qq.com/ws/place/v1/search',
                    type: 'GET',
                    dataType: 'jsonp',
                    data: {
                        keyword: v,
                        boundary: region,
                        key: 'FK3BZ-V35RK-BCPJS-AGPC6-LG4LF-4EFKW',
                        output: 'jsonp'
                    },
                    success: function (data) {
                        if (data.status == 0) {
                            // console.log(data);
                            var tmp = '',
                                i = 0,
                                len = data.data.length,
                                v = '';
                            for (i; i < len; i++) {
                                if (data.data[i].title) {
                                    v = data.data[i].title;
                                } else if (data.data[i].address) {
                                    v = data.data[i].address;
                                }
                                if (v) {
                                    tmp += `<p i="` + i + `">` + v + `</p>`;
                                }
                            }
                            completeBox.html(tmp).show();
                            tencentBack = data.data;
                        } else {

                        }
                    }
                })
            }, 500);
        });

    }
    //集合地 E

    // 新虚拟币 控制
    $('input[name="is_virtual"]').on('click', function () {
        $('.virtual-box')[$(this).val() == 0 ? 'addClass' : 'removeClass']('hide');
    })
    $('input[name=backperio]').on('change', function () {
        $('.backperio_open')[$(this).val() == 1 ? 'removeClass' : 'addClass']('hide')
        $(this).val() != 1 && $('input[name=backperio_num]').val('') && $('input[name=backperio_day]').val('')
    })
    // sku-break 切换
    $('.sku-break-box-all input').on('click', function () {
        $('.sku-break-box')[$(this).is(':checked') ? 'addClass' : 'removeClass']('hide');
    })

    // 规格切换
    $('.spec-info .my_radio').click(function () {
        if ($(this).val() == 0) {
            addSkuBtn.addClass('hidden');
            $('.spec-stock-box').removeClass('hidden');
            $('.sku-stock-box').addClass('hidden');
            skuCon.addClass('hidden');

            // step3
            priceType.html('统一定价:');
            priceType.data('type', 1);
            $('.hasSpec-table').addClass('hide');
            $('.noSpec-box').removeClass('hide');
            $('.batch-price').addClass('hide');

            $('.sku-break-box-all').addClass('hide');
            $('.is_total').addClass('hide')
            $('.istotal').prop('checked', false)
            $('.totalnum').prop('disabled', true)
        } else {
            addSkuBtn.removeClass('hidden');
            $('.is_total').removeClass('hide')
            $('.spec-stock-box').addClass('hidden');
            $('.sku-stock-box').removeClass('hidden');
            skuCon.removeClass('hidden');

            // step3
            priceType.html('规格定价:');
            priceType.data('type', 2);
            $('.hasSpec-table').removeClass('hide');
            $('.noSpec-box').addClass('hide');
            $('.batch-price').removeClass('hide');

            $('.sku-break-box-all').removeClass('hide');
        }
    })
    // 添加营期
    addPeriodBtn.on('click', function () {
        var tableHtml = '';
        var skuStock = 0;
        // 无规格
        if (periodConBox.find('input[name="sTime[]"]').val() == '' || periodConBox.find('input[name="bTime[]"]').val() == '') {
            layer.msg('请输入完整营期信息');
            return;
        }
        periodIndex++;
        updateTime(1);
        tableHtml = $('.createTable').html();
        // 清除有规格的已售数量
        $('.tablestore').html(tableHtml);
        $('.tablestore .skuStockIptChild').children("span").html(0)
        $('.tablestore .skuStockIptbig').children("span").html(0)

        tableHtml = $('.tablestore').html();
        if (!cid) {
            tableHtml = tableHtml.replace(/<span\s*[^>]*>(.*?)<\/span>/g, " ");
        } else {
            tableHtml = tableHtml.replace(/<td class="ddd"\s*[^>]*>(.*?)<\/td>/g, '<td class="ddd">0</td>');

        }
        if ($('#hasSpec').prop('checked')) {
            skuFlag = true;
            skuStock = $('.createTable .allStockNum').html()
        } else {
            skuFlag = false;
        }
        var html = renderPeriod(periodIndex, tableHtml, skuFlag, '', skuStock, '', '', '', $('.createTable').find('.is_max').val(), $('.product_type:checked').val(), 0, '', 0);

        periodConBox.prepend(html);
        var rangeTimeLen = $('.datepicker').length;
        uselaydate(periodIndex);
        if ($('#hasSpec').prop('checked')) {
            $('.is_total').removeClass('hide')
        }

        setYanxueStyle();
        if (!isYanxue) {
            // 预定价格 控制
            var ret = renderDestinePrice(periodIndex, starttime, endtime);
            // 营期差价
            var diffRet = renderPriceDiff(periodIndex, starttime, endtime);
            $('.destine-table table tbody').prepend(ret);
            $('.priceDiff-box table tbody').prepend(diffRet);
            initDestineData();
        }
    })

    // 隐藏营期
    hidePeriodBtn.on('click', function () {
        $('#hidePeriodList').modal()
    })
    // 删除营期
    periodConBox.on('click', '.del-period', function () {
        var _this = this;
        if ($('.period-item').length == 1) {
            layer.msg('最后一个营期不可删除');
            return;
        }
        if ($(this).data('nodel') == 1 && location.host != 'qq.co.xinduobang.cn') {
            layer.alert('当前营期已有人报名，不可删除。如不需要此营期，请使用隐藏营期功能', { title: '删除提醒' });
            return;
        }
        layer.confirm('确定要删除此营期吗', {
            title: '删除营期'
        }, function (index) {
            periodIndex--;
            $(_this).parent().remove();
            var num = $(_this).data('id');
            $('.destineTR' + num).remove();
            $('.priceDiffTR' + num).remove();
            layer.close(index);
        })
    })

    // 删除按钮控制
    periodConBox.on('mouseover', '.period-item', function () {
        $(this).find('.del-period').removeClass('hidden');
    })
    periodConBox.on('mouseout', '.period-item', function () {
        $(this).find('.del-period').addClass('hidden');
    })

    var skuNum = 0;
    // 退款模板
    $.ajax({
        url: '__APP__/Admin/Capital/getRefundTemplateList',
        type: "post",
        traditional: true,
        async: true,
        dataType: 'json',
        data: { pid: pid },
        success: function (data) {
            $('#tkmb').removeClass('hide')
            console.log("^^^^^^^^^^^^^^^^^^^^^^^^")
            console.log(data)
            console.log("^^^^^^^^^^^^^^^^^^^^^^^^")
            let ty_list = data.data;
            if (data.sale_refund_status == 1) {
                $('#zztkmx').prop('checked', 'checked')
            }
            // $('#zztkmx').prop('checked')
            ty_list.map(res => {
                if (res.is_select == 1) {
                $('#contract_tkmb').append(`<option selected value="` + res.id + `">` + res.name + `</option>`)
            } else {
                $('#contract_tkmb').append(`<option value="` + res.id + `">` + res.name + `</option>`);
            }
        })
        },
    })
    // 退款模板End
    // 获取营期
    $.ajax({
        url: '__APP__/Admin/Course/course_sku',
        type: 'post',
        data: {
            cid: cid,
            pid: pid
        },
        dataType: 'json',
        success: function (data) {

            if (data.code != 0) {
                layer.msg(data.msg);
                return;
            }
            courseSkuData = data.data;
            data = data.data;
            product_type_patch = data.product_type;
            $('.addSku').on('click', function () {
                skuNum++;
                $('.skuInfo').append(renderSku(data.sku_type, skuNum));
                initSelectiza(skuNum);
                showSkuDel();
            })
            if (!cid) {
                // 添加营种商品
                if (!isYanxue) {
                    var skuHtml = renderSku(data.sku_type, skuNum);
                    $('.skuInfo').append(skuHtml);
                    initSelectiza(skuNum);
                    showSkuDel();
                }
            } else {
                $(`input[name="is_sku"][value="${data.is_sku}"]`).trigger('click');

                // 编辑营种商品 有sku
                if (data.is_sku == 1 && !isYanxue) {
                    var retHtml = '';
                    skuNum = data.sku_select_type.length - 1;

                    // 多规格列表
                    for (var i = 0; i < data.sku_select_type.length; i++) {
                        var optionStr = '';
                        // 下拉选项
                        for (var j = 0; j < data.sku_type.length; j++) {
                            var selectStr = '';
                            if (data.sku_type[j].id == data.sku_select_type[i].id) {
                                selectStr = 'selected';
                            }
                            optionStr += '<option ' + selectStr + ' value="' + data.sku_type[j].id + '">' + data.sku_type[j].name + '</option>'
                        }
                        retHtml += '<div>\
                                                <div class="skuInfoSelect">\
                                                <select class="form-control skuSelect">' + optionStr + '</select>\
                                                <button type="button" class="btn btn-danger btn-xs deleteSku">删除</button>\
                                                </div>\
                                                <div class="skuInfoTagIpt">\
                                                <div class="skuValue dn">' + data.sku_select_type[i].data + '</div>\
                                                <input type="text" id="input-tags' + i + '" class="form-control input-tags" value="' + data.sku_select_type[i].data + '">\
                                                </div>\
                                            </div>';
                    }

                    $('.skuInfo').append(retHtml);
                    for (var i = 0; i < data.sku_select_type.length; i++) {
                        initSelectiza(i);
                        // data.status == 1 && lockSelectiza(i); // 已卖商品sku也可以编辑 所以注释
                    }
                    showSkuDel();
                    if (data.status == 1) {
                        $('.edit-tips').removeClass('hidden');
                        $('.addSku').prop('disabled', true);
                        $('.skuSelect').prop('disabled', true);
                        $('.deleteSku').prop('disabled', true);
                        $('#noSpec').prop('disabled', true);
                    }

                    periodConBox.html('');
                    var noSkuHtml = '';
                    // for (var i = data.list.length - 1; i >= 0; i--) {
                    if (data.product_type == 1) {
                        data.sku_first_title.pop();
                        data.sku_first_title.pop();
                        data.sku_first_title.push({
                            id: -2,
                            name: '儿童库存'
                        })
                        data.sku_first_title.push({
                            id: -1,
                            name: '成人库存'
                        })
                        data.sku_first_title.push({
                            id: '',
                            name: '亲子总库存'
                        })
                    }
                    for (var i = 0; i < data.list.length; i++) {
                        var element = data.list[i];
                        starttime = element.start_time;
                        endtime = element.end_time;
                        bendtime = element.bend_time;

                        var is_max_ck = '';
                        var is_max_dis = 'readonly';
                        if (element.is_max == 1) {
                            is_max_dis = '';
                            is_max_ck = 'checked'
                        }
                        var tableHtml = '<table class="table table-bordered table-hover" border="1" cellpadding="1" cellspacing="0" style="width:100%;padding:5px;"><thead><tr>'
                        if (data.product_type == 1) {
                            // 亲子出营

                            for (var m = 0; m < data.sku_first_title.length; m++) {
                                if (m == data.sku_first_title.length - 1) {
                                    // 总库存上限
                                    tableHtml += '<th class="sku-limit" style="width: 150px;" data-id="' + data.sku_first_title[m].id + '"> <input type="checkbox" ' + is_max_ck + ' name="" class="is_max" value="' + element.is_max + '">亲子总库存 <div class="tipIco help" style="cursor: pointer;">?</div></th>'
                                } else if (m == data.sku_first_title.length - 2) {
                                    // 成人库存
                                    tableHtml += '<th class="sku-parent" style="width: 150px;" data-id="' + data.sku_first_title[m].id + '">成人库存:' + element.big_overplus + '</th>'
                                } else if (m == data.sku_first_title.length - 3) {
                                    // 儿童库存
                                    tableHtml += '<th class="sku-child" style="width: 150px;" data-id="' + data.sku_first_title[m].id + '">儿童库存:' + element.overplus + '</th>'
                                } else {
                                    tableHtml += '<th data-id="' + data.sku_first_title[m].id + '">' + data.sku_first_title[m].name + '</th>'
                                }
                            }

                            tableHtml += '</tr></thead><tbody>';
                            // 拼装 数据
                            var newArr = [];
                            element.big_sku_data_list.forEach(function (v, i) {
                                var obj = {
                                    sale: v[v.length - 2],
                                    all: v[v.length - 1]
                                }
                                v.pop();
                                v.pop();
                                v.push(obj);
                                v.splice(0, v.length - 1);
                            })
                            element.limit_sku_data_list.forEach(function (v, i) {
                                var obj = {
                                    sale: v[v.length - 2],
                                    all: v[v.length - 1]
                                }
                                v.pop();
                                v.pop();
                                v.push(obj);
                                v.splice(0, v.length - 1);
                            })
                            element.sku_data_list.forEach(function (v, i) {
                                var obj = {
                                    sale: v[v.length - 2],
                                    all: v[v.length - 1]
                                }
                                v.pop();
                                v.pop();
                                v.push(obj);
                                newArr.push(v.concat(element.big_sku_data_list[i], element.limit_sku_data_list[i]));
                            })
                            // console.log(newArr);
                            for (var k = 0; k < newArr.length; k++) {
                                tableHtml += '<tr>';
                                for (var j = 0; j < newArr[k].length; j++) {
                                    if (j == newArr[k].length - 1) {
                                        tableHtml += '<td class="skuStockIptLimit"><span class="hide">' + newArr[k][j].sale + '</span><input class="l-text form-control input-sm" ' + is_max_dis + ' value="' + newArr[k][j].all + '"></td>'
                                    } else if (j == newArr[k].length - 2) {
                                        tableHtml += '<td class="skuStockIptbig"> <span>' + newArr[k][j].sale + '</span> / <input style="width: 60%;display: inline-block;" class="l-text form-control input-sm" value="' + newArr[k][j].all + '"></td>'
                                    } else if (j == newArr[k].length - 3) {
                                        tableHtml += '<td class="skuStockIptChild"><span>' + newArr[k][j].sale + '</span> / <input style="width: 60%;display: inline-block;" class="l-text form-control input-sm" value="' + newArr[k][j].all + '"></td>'
                                    } else {
                                        tableHtml += '<td>' + newArr[k][j] + '</td>'
                                    }
                                }
                                tableHtml += '</tr>'
                            }
                        } else {
                            for (var m = 0; m < data.sku_first_title.length; m++) {
                                if (m == data.sku_first_title.length - 1) {
                                    tableHtml += '<th class="sku-stock" data-id="' + data.sku_first_title[m].id + '">总库存: <span class="allStockNum">' + element.overplus + '</span></th>'
                                } else if (m == data.sku_first_title.length - 2) {
                                    tableHtml += '<th class="sku-sale" data-id="' + data.sku_first_title[m].id + '">' + data.sku_first_title[m].name + '</th>'
                                } else {
                                    tableHtml += '<th data-id="' + data.sku_first_title[m].id + '">' + data.sku_first_title[m].name + '</th>'
                                }
                            }

                            tableHtml += '</tr></thead><tbody>';
                            for (var k = 0; k < element.sku_data_list.length; k++) {
                                tableHtml += '<tr>';
                                for (var j = 0; j < element.sku_data_list[k].length; j++) {
                                    if (j == element.sku_data_list[k].length - 1) {
                                        tableHtml += `<td class="skuStockIpt"><input class="l-text form-control input-sm" value="${element.sku_data_list[k][j]}"></td>`
                                    } else if (j == element.sku_data_list[k].length - 2) {
                                        tableHtml += '<td class="ddd">' + element.sku_data_list[k][j] + '</td>'
                                    } else {
                                        tableHtml += '<td>' + element.sku_data_list[k][j] + '</td>'
                                    }

                                }
                                tableHtml += '</tr>'
                            }
                        }
                        tableHtml += '</tbody></table>';
                        $('#hidelist').append(`<label style="width:50%;" class="checkedes">
                                    <input type="checkbox" ${element.is_hide == 1 ? 'checked' : ''} value="${element.id}" />${element.name}
                                </label>`)

                        noSkuHtml += renderPeriod((i + 1), tableHtml, true, element.id, element.overplus, element.pername, element.big_overplus, element.limit_overplus, element.is_max, data.product_type, element.used_count, element.big_used_count, element.payendtime, element.is_total, element.totalnum, element.sale_num, element.leaft_num, element.power, element.is_hide);
                    }

                    periodConBox.prepend(noSkuHtml);

                    for (var i = 1; i <= data.list.length; i++) {
                        uselaydate(i);
                    }
                    if (data.list.length > 10) {
                        if ($('.period-item').length > 10) {
                            $('.period-con').css({
                                'height': '540px',
                                'overflow': 'hidden'
                            })
                            $('.period-con-mask,.period-con-btn').show()
                        } else {
                            $('.period-con').css({
                                'height': 'auto',
                                'overflow': 'inherit'
                            })
                            $('.period-con-mask,.period-con-btn').hide()
                        }
                    }
                    $('.is_total').removeClass('hide')
                } else { // 编辑 没有sku
                    if (data.status == 1) {
                        $('#hasSpec').prop('disabled', true);
                        $('.edit-tips').removeClass('hidden');
                    }
                    // 生成 sku选择
                    var skuHtml = renderSku(data.sku_type, skuNum);
                    $('.skuInfo').append(skuHtml);
                    initSelectiza(skuNum);
                    showSkuDel();

                    //生成营期数据
                    periodConBox.html('');
                    var noSkuHtml = '';
                    var destineTemplate = ''; // 获取营种详情 预定价格之前没设置过 就用现有营期渲染占位
                    // for (var i = data.list.length - 1; i >= 0; i--) {
                    for (var i = 0; i < data.list.length; i++) {
                        var element = data.list[i];
                        starttime = element.start_time;
                        endtime = element.end_time;
                        bendtime = element.bend_time;
                        payendtime = element.payendtime;
                        $('#hidelist').append(`<label style="width:50%;" class="checkedes">
                                    <input type="checkbox" ${element.is_hide == 1 ? 'checked' : ''} value="${element.id}" />${element.name}
                                </label>`)
                        noSkuHtml += renderPeriod((i + 1), '', false, element.id, element.overplus, element.pername, element.big_overplus, element.limit_overplus, element.is_max, data.product_type, element.used_count, element.big_used_count, payendtime, element.is_total, element.totalnum, element.sale_num, element.leaft_num, element.power, element.is_hide);
                        destineTemplate += renderDestinePrice(i + 1, element.start_time, element.end_time);
                    }
                    periodConBox.prepend(noSkuHtml);
                    setYanxueStyle();
                    !isYanxue && !hasSetDestine && $('.destine-table tbody').html(destineTemplate); // 详情里没有返回(hasSetDestine为false) 才用这里的渲染
                    for (var i = 1; i <= data.list.length; i++) {
                        uselaydate(i);
                    }
                    if (data.list.length > 10) {
                        if ($('.period-item').length > 10) {
                            $('.period-con').css({
                                'height': '540px',
                                'overflow': 'hidden'
                            })
                            $('.period-con-mask,.period-con-btn').show()
                        } else {
                            $('.period-con').css({
                                'height': 'auto',
                                'overflow': 'inherit'
                            })
                            $('.period-con-mask,.period-con-btn').hide()
                        }
                    }
                }
            }
        }
    })

    // 渲染 item  sku
    function renderSku(typeArr, num) {
        var str = '<option value="">请选择规格</option>';
        for (var i = 0; i < typeArr.length; i++) {
            str += '<option value="' + typeArr[i].id + '">' + typeArr[i].name + '</option>'
        }
        return '<div>\
                            <div class="skuInfoSelect">\
                                <select class="form-control skuSelect">' + str + '</select>\
                                <button type="button" class="btn btn-danger btn-xs deleteSku">删除</button>\
                            </div>\
                            <div class="skuInfoTagIpt">\
                                <div class="skuValue dn"></div>\
                                <input type="text" id="input-tags' + num + '" class="form-control input-tags">\
                            </div>\
                        </div>'
    }

    // 多规格改变sku 如果定价原来有值 再还原
    function setSkuPrice() {
        const { sku_data_list, big_sku_data_list, product_type } = courseSkuPriceData;
        const productType = $('input[name="product_type"]:checked').val();

        $('.createTablePrice tr').each(function () {
            const tr = $(this);
            const priceValueIndex = findSkuValueIndex(sku_data_list, tr.attr('sku'), courseSkuData.sku_select_type);
            if (priceValueIndex == -1) {
                return;
            }
            const v = sku_data_list[priceValueIndex];
            if (productType == '0') {
                tr.find('.skuPariceIpt input').val(v[v.length - 2]);
            }
            if (productType == '1') {
                const b = big_sku_data_list[priceValueIndex];
                tr.find('.skuPariceIpt:eq(0) input').val(v[v.length - 2] || 0);
                tr.find('.skuPariceIpt:eq(1) input').val(b ? b[b.length - 1] || 0 : 0);
            }
        });
    }

    // 多规格改变sku 如果库存原来有值 再还原
    function setSkuStock() {
        const { list, product_type, sku_select_type } = courseSkuData;
        const productType = $('input[name="product_type"]:checked').val();
        // productType != product_type 更改出营类型也直接返回
        if (list.length == 0 || productType != product_type) {
            return;
        }

        $('.createTable').each(function (index) {
            if (!list[index]) {
                return;
            }
            $(this).find('tbody tr').each(function (trIndex) {
                const tr = $(this);
                const skuValueIndex = findSkuValueIndex(list[index]['sku_data_list'], tr.attr('sku'), sku_select_type);
                if (skuValueIndex == -1) {
                    return;
                }
                const { big_sku_data_list, limit_sku_data_list, sku_data_list } = list[index];
                // 单飞
                if (productType == '0') {
                    const v = sku_data_list[skuValueIndex];
                    tr.find('.skuStockIpt input').val(v[v.length - 1]);
                    tr.find('.skuSale').text(v[v.length - 2]);
                }
                // 亲子
                if (productType == '1') {
                    const b = big_sku_data_list[skuValueIndex][0];
                    const v = sku_data_list[skuValueIndex][sku_data_list[skuValueIndex]['length'] - 1];
                    const l = limit_sku_data_list[skuValueIndex][0];
                    tr.find('.skuStockIptLimit input').val(l.all);
                    tr.find('.skuStockIptbig input').val(b.all).siblings('span').text(b.sale);
                    tr.find('.skuStockIptChild input').val(v.all).siblings('span').text(v.sale);
                }
            });
        });
    }

    function findSkuValueIndex(sku_data_list, sku, sku_select_type) {
        let index = -1;
        sku_data_list && sku_data_list.forEach((item, i) => {
            if (item.slice(0, sku_select_type.length).join('') == sku) {
            index = i;
        }
    });
        return index;
    }

    // 初始化selectize
    function initSelectiza(num) {
        $('#input-tags' + num + '').selectize({
            plugins: ['remove_button'],
            persist: false,
            createOnBlur: true,
            create: true,
            onChange: function (name) {
                var _this = this.$control_input;
                _this.parent().parent().prev().prev().html(name);
                step.Creat_Table(1);
                step.Creat_Table(2, $('.virtual-checkbox').prop('checked'));
                setSkuStock();
                setSkuPrice();
            }
        })
    }
    // lock
    function lockSelectiza(num) {
        // console.log(num);
        $('#input-tags' + num + '')[0].selectize.disable();
    }
    // 删除 sku item
    $('.skuCon').on('click', '.deleteSku', function () {
        $(this).parent().parent().remove();
        showSkuDel();
        step.Creat_Table(1);
        step.Creat_Table(2, $('.virtual-checkbox').prop('checked'));
    })

    // 删除按钮控制
    function showSkuDel() {
        if ($('.skuInfo .deleteSku').length == 1) {
            $('.deleteSku').first().hide();
        }
        if ($('.skuInfo .deleteSku').length > 1) {
            $('.deleteSku').first().show();
        }
    }
    // 禁止选择相同型号
    $('.skuCon').on('change', '.skuSelect', function () {
        step.Creat_Table(1);
        step.Creat_Table(2, $('.virtual-checkbox').prop('checked'));
        if ($(this).val() == '') {
            layer.msg('请选择规格');
            return;
        }
        if ($('.skuSelect').find('option:selected').length == 1) {
            return;
        }
        var arrVal = [];
        $('.skuSelect').find('option:selected').each(function (i, v) {
            arrVal.push($(v).html());
        })
        var newArr = [];
        for (var i = 0; i < arrVal.length; i++) {
            var allFlag = true;
            for (var j = 0; j < newArr.length; j++) {
                if (arrVal[i] == newArr[j]) {
                    allFlag = false;
                }
            }
            if (allFlag) {
                newArr.push(arrVal[i]);
            }
        }
        if (newArr.length != arrVal.length) {
            layer.msg('请勿选择同一规格');
            $(this).find('option[value=""]').prop('selected', true);
            return;
        }
    })
    // sku 总库存计算
    $('.period-con').on('input', '.skuStockIpt input', function () {
        var allStockNum = 0,
            _this = this;
        // console.log($(this).parent().parent().parent().find('input'));
        $(this).parent().parent().parent().find('input').each(function (i, v) {
            var ret = /^[0-9]+([.]{1}[0-9]+){0,1}$/.test($(v).val() - 0);
            if (!ret) {
                layer.msg('请输入数字');
                return;
            }
            allStockNum += $(v).val() - 0;
            $(_this).parent().parent().parent().parent().find('.sku-stock').html('总库存: <span class="allStockNum">' + allStockNum + '</span>');
            $(_this).parents('.sku-stock-box').prev().find('input[name="stock[]"]').val(allStockNum);
        });
    })
    $('.period-con').on('input', '.skuStockIptChild input', function () {
        var allStockNum = 0,
            _this = this;
        // console.log($(this).parent().parent().parent().find('input'));
        $(this).parent().parent().parent().find('input').each(function (i, v) {
            if ($(v).parent().hasClass('skuStockIptChild')) {
                var ret = /^[0-9]+([.]{1}[0-9]+){0,1}$/.test($(v).val() - 0);
                if (!ret) {
                    layer.msg('请输入数字');
                    return;
                }
                allStockNum += $(v).val() - 0;
                $(_this).parent().parent().parent().parent().find('.sku-child').html('儿童库存: <span class="allStockNum">' + allStockNum + '</span>');
                $(_this).parents('.sku-stock-box').prev().find('input[name="stock[]"]').val(allStockNum);
            }
        });
    })
    $('.period-con').on('input', '.skuStockIptbig input', function () {
        var allStockNum = 0,
            _this = this;
        // console.log($(this).parent().parent().parent().find('input'));
        $(this).parent().parent().parent().find('input').each(function (i, v) {
            if ($(v).parent().hasClass('skuStockIptbig')) {
                var ret = /^[0-9]+([.]{1}[0-9]+){0,1}$/.test($(v).val() - 0);
                if (!ret) {
                    layer.msg('请输入数字');
                    return;
                }
                allStockNum += $(v).val() - 0;
                $(_this).parent().parent().parent().parent().find('.sku-parent').html('成人库存: <span class="allStockNum">' + allStockNum + '</span>');
                $(_this).parents('.sku-stock-box').prev().find('input[name="big_overplus[]"]').val(allStockNum);
            }
        });
    })
    $('.period-con').on('input', '.skuStockIptLimit input', function () {
        var allStockNum = 0,
            _this = this;
        // console.log($(this).parent().parent().parent().find('input'));
        $(this).parent().parent().parent().find('input').each(function (i, v) {
            if ($(v).parent().hasClass('skuStockIptLimit')) {
                var ret = /^[0-9]+([.]{1}[0-9]+){0,1}$/.test($(v).val() - 0);
                if (!ret) {
                    layer.msg('请输入数字');
                    return;
                }
                allStockNum += $(v).val() - 0;
                // $(_this).parent().parent().parent().parent().find('.sku-parent').html('成人库存: <span class="allStockNum">' + allStockNum + '</span>');
                $(_this).parents('.sku-stock-box').prev().find('input[name="limit_overplus[]"]').val(allStockNum);
            }
        });
    })
    $('#step1-btn').on('click', function () {
        history.pushState({}, '', changeURLArg(window.location.href, 'tab', 1));
        $('#step1-btn').tab('show');
    })
    $('#step2-btn').on('click', function () {
        history.pushState({}, '', changeURLArg(window.location.href, 'tab', 2));
        $('#step2-btn').tab('show');
    })
    $('#step3-btn').on('click', function () {
        history.pushState({}, '', changeURLArg(window.location.href, 'tab', 3));
        $('#step3-btn').tab('show');
    })
    // step1 下一步
    $('.next-btn').on('click', function () {
        history.pushState({}, '', changeURLArg(window.location.href, 'tab', 2));
        $('#step2-btn').tab('show');
    })
    // step2 上一步
    $('.prev-btn').on('click', function () {
        history.pushState({}, '', changeURLArg(window.location.href, 'tab', 1));
        $('#step1-btn').tab('show');
    })

    // step2 下一步 step2-next-btn
    $('.step2-next-btn').on('click', function () {
        history.pushState({}, '', changeURLArg(window.location.href, 'tab', 3));
        $('#step3-btn').tab('show');
    })

    // step3 上一步 step2-next-btn
    $('.step3-prev-btn').on('click', function () {
        history.pushState({}, '', changeURLArg(window.location.href, 'tab', 2));
        $('#step2-btn').tab('show');
    })

    // 渲染营期部分
    function renderPeriod(i, tableHtml, skuFlag, stockId, stockNum, yingQiName, stockNumBig, stockNumLimit, is_max, product_type, used_count, big_used_count, payendtime, is_total, totalnum, sale_num, leaft_num, power, is_hide) {

        var used_count_num = used_count || 0;
        var big_used_count_num = big_used_count || 0;
        var tmpStr = '';
        var stock_name = '库存';
        var stock_name_hide = 'hide';
        var is_max_dis = 'readonly';
        var is_max_ck = '';
        var payendtime = payendtime ? payendtime : ''
        if (product_type == 1) {
            stock_name = '儿童库存';
            stock_name_hide = '';
        }
        stockNum = stockNum ? stockNum : 0;
        stockNumBig = stockNumBig ? stockNumBig : 0;
        stockNumLimit = stockNumLimit ? stockNumLimit : 0;
        is_max = is_max ? is_max : 0;
        sale_num = sale_num ? sale_num : 0;
        leaft_num = leaft_num ? leaft_num : 0;
        power = power ? power : 0;

        if (is_max == 1) {
            is_max_dis = '';
            is_max_ck = 'checked'
        }
        stockId = stockId ? stockId : '';
        yingQiName = yingQiName ? yingQiName : '';
        if (skuFlag) {
            tmpStr = '<div class="form-group">\
                                <label class="col-sm-2 control-label"> 支付截止时间:</label>\
                                <div class="col-sm-10">\
                                <input type="text" class="form-control dataBox payendtime' + i + '" name="payendtime[]"\
                                id="" value="' + payendtime + '" />\
                                </div>\
                                </div>\
                                <div class="form-group spec-stock-box hidden">\
                                <label class="col-sm-2 control-label"><span class="must">*</span> 库存:</label>\
                                <div class="col-sm-2">\
                                <input type="text" class="form-control overplus_patch" name="stock[]" value="' + stockNum + '">\
                                </div>\
                                <span class="big_overplus_box ' + stock_name_hide + '">\
                                <label class="col-sm-2 control-label"><span class="must">*</span> 成人库存:</label>\
                                <div class="col-sm-2">\
                                <input type="text" class="form-control big_overplus_patch" name="big_overplus[]" value="' + stockNumBig + '">\
                                </div>\
                                <label class="col-sm-2 control-label" style="width: 12%;"> \
                                <input type="checkbox" name="" ' + is_max_ck + ' class="is_max" value="' + is_max + '">\
                                <input type="hidden" name="is_max[]" value="' + is_max + '">\
                                亲子总库存:<div class="tipIco help" style="cursor: pointer;">?</div></label>\
                                <div class="col-sm-2">\
                                <input type="text" ' + is_max_dis + ' class="form-control asdad" name="limit_overplus[]" value="' + stockNumLimit + '">\
                                </div>\
                                </span>\
                                </div>\
                                <div class="form-group sku-stock-box">\
                                <label class="col-sm-2 control-label"><span class="must">*</span> 库存:</label>\
                                <div class="col-sm-7">\
                                <div>\
                                <div class="createTable"> ' + tableHtml + ' </div >\
                                </div>\
                                </div>\
                                </div>\
                                <div class="form-group hide is_total">\
                                <label class="col-sm-1 col-sm-offset-1 control-label"> <input type="checkbox" class="istotal" ' + (is_total == 1 ? 'checked' : '') + '/> 规格总库存:</label>\
                                <div class="col-sm-2">\
                                <input type="text" ' + (is_total == 1 ? '' : 'disabled') + ' class="form-control totalnum"  value="' + (totalnum || '') + '">\
                                </div>\
                                </div>\
                                <div class="form-group">\
                                    <label class="col-sm-2 control-label">销量:</label>\
                                    <div class="col-sm-10">\
                                        <input type="text"class="form-control" value="' + sale_num + '" name="sale_num[]" style="width: 20%;display: inline-block;">&nbsp;&nbsp;<div class="tipIco" style="cursor: pointer;" onclick="showTip(`填写此项后不会影响真正的库存，只会在用户端显示该销量`)">?</div>\
                                        &nbsp;&nbsp;剩余库存:&nbsp;&nbsp;<input type="text"class="form-control" value="' + leaft_num + '" name="leaft_num[]" style="width: 20%;display: inline-block;">&nbsp;&nbsp;<div class="tipIco" style="cursor: pointer;" onclick="showTip(`填写此项后不会影响真正的库存，只会在用户端显示该剩余库存`)">?</div>\
                                        &nbsp;&nbsp;权重:&nbsp;&nbsp;<input type="text"class="form-control" value="' + power + '" name="power[]" style="width: 20%;display: inline-block;">&nbsp;&nbsp;<div class="tipIco" style="cursor: pointer;" onclick="showTip(`数字越大排名越靠前`)">?</div>\
                                    </div>\
                                </div>'

        } else {
            tmpStr = '<div class="form-group">\
                                <label class="col-sm-2 control-label hide-yanxue"> 支付截止时间:</label>\
                                <div class="col-sm-10 hide-yanxue">\
                                <input type="text" class="form-control dataBox payendtime' + i + '" name="payendtime[]"\
                                id="" value="' + payendtime + '" />\
                                </div>\
                                </div>\
                                <div class="form-group spec-stock-box">\
                                <label class="col-sm-2 control-label"><span class="must">*</span> <span class="stock-name">' + stock_name + '</span>:</label>\
                                <div class="col-sm-2">\
                                ' + used_count_num + '/<input type="text" class="form-control" name="stock[]" value="' + stockNum + '">\
                                </div>\
                                <span class="big_overplus_box ' + stock_name_hide + '">\
                                <label class="col-sm-2 control-label"><span class="must">*</span> 成人库存:</label>\
                                <div class="col-sm-2">\
                                ' + big_used_count_num + '/<input type="text" class="form-control" name="big_overplus[]" value="' + stockNumBig + '">\
                                </div>\
                                <label class="col-sm-2 control-label" style="width: 12%;"> \
                                <input type="checkbox" name="" ' + is_max_ck + ' class="is_max" value="' + is_max + '">\
                                <input type="hidden" name="is_max[]" value="' + is_max + '">\
                                亲子总库存:<div class="tipIco help" style="cursor: pointer;">?</div></label>\
                                <div class="col-sm-2">\
                                <input type="text" ' + is_max_dis + ' class="form-control" name="limit_overplus[]" value="' + stockNumLimit + '">\
                                </div>\
                                </span>\
                                </div>\
                                <div class="form-group sku-stock-box hidden">\
                                <label class="col-sm-2 control-label"><span class="must">*</span> 库存:</label>\
                                <div class="col-sm-7">\
                                <div>\
                                <div class="createTable"> ' + tableHtml + ' </div >\
                                </div>\
                                </div>\
                                </div>\
                                <div class="form-group">\
                                    <label class="col-sm-2 control-label yanxue-is-power">销量:</label>\
                                    <div class="col-sm-10">\
                                        <input type="text"class="form-control hide-yanxue hide-yanxue-inline-block" value="' + sale_num + '" name="sale_num[]" style="width: 20%;display: inline-block;">\
                                        <div class="tipIco hide-yanxue hide-yanxue-inline-block" style="cursor: pointer;" onclick="showTip(`填写此项后不会影响真正的库存，只会在用户端显示该销量`)">?</div>\
                                        <label class="hide-yanxue hide-yanxue-inline-block">&nbsp;&nbsp;剩余库存: </label>\
                                        <input type="text"class="form-control hide-yanxue hide-yanxue-inline-block" value="' + leaft_num + '" name="leaft_num[]" style="width: 20%;display: inline-block;">\
                                        <div class="tipIco hide-yanxue hide-yanxue-inline-block" style="cursor: pointer;" onclick="showTip(`填写此项后不会影响真正的库存，只会在用户端显示该剩余库存`)">?</div>\
                                        <label class="hide-yanxue hide-yanxue-inline-block">&nbsp;&nbsp;权重: </label>\
                                        <input type="text"class="form-control" value="' + power + '" name="power[]" style="width: 20%;display: inline-block;">\
                                        <div class="tipIco" style="cursor: pointer;" onclick="showTip(`数字越大排名越靠前`)">?</div>\
                                    </div>\
                                </div>'
        }

        return '<div class="period-item form-horizontal ">\
                            <span class="status-period" data-id="' + i + '">' + (is_hide == 1 ? '已隐藏' : '未隐藏') + '</span>\
                            <span class="del-period hidden" data-nodel="' + (used_count_num > 0 || big_used_count_num > 0 ? 1 : 0) + '" data-id="' + i + '">&#10005;</span>\
                            <div class="form-group" >\
                            <label class="col-sm-2 control-label"><span class="must">*</span> 营种期次:</label>\
                            <div class="col-sm-10">\
                            <input type="hidden" class="form-control" name="id[]" value="' + stockId + '">\
                            <input type="text" class="datepicker datepicker3 form-control dataBox range-time' + i + '" name="sTime[]" s="' + starttime + '" e="' + endtime + '" value="' + starttime + ' - ' + endtime + '" />&nbsp;&nbsp;期次名称:&nbsp;&nbsp;<input style="width: 20%;" type="text" class="form-control dataBox" name="pername[]" value="' + yingQiName + '" />&nbsp;&nbsp;<span class="must">*</span> 报名截止时间:&nbsp;&nbsp;<input type="text" class="form-control dataBox enroll-time' + i + '" name="bTime[]" value="' + bendtime + '" />\
                            </div>\
                            </div>' + tmpStr + '</div>'
    }

    // 时间计算
    function updateTime(a) {
        var basisTimeDom = periodConBox.find('input[name="sTime[]"]');

        starttime = basisTimeDom.attr('s');
        endtime = basisTimeDom.attr('e');

        if (his == '') {
            his = $('.period-item').first().find('input[name="bTime[]"]:first').val().split(' ')[1];
            his = his ? his : '00:00:00'; //时分秒
        }

        var start = new Date(starttime);
        var end = new Date(endtime);

        var weektime = 7 * 24 * 3600 * 1000;
        if (a > 0) {
            var newstart = parseInt(start.getTime()) + weektime;
            var newend = parseInt(end.getTime()) + weektime;
        } else {
            var newstart = parseInt(start.getTime()) - weektime;
            var newend = parseInt(end.getTime()) - weektime;
        }
        var sty, stm, std, ety, etm, etd;
        sty = new Date(newstart).getFullYear();
        stm = parseInt(new Date(newstart).getMonth()) + 1 >= 10 ? parseInt(new Date(newstart).getMonth()) + 1 : "0" + (parseInt(new Date(newstart).getMonth()) + 1);
        std = new Date(newstart).getDate() >= 10 ? new Date(newstart).getDate() : "0" + new Date(newstart).getDate();
        ety = new Date(newend).getFullYear();
        etm = parseInt(new Date(newend).getMonth()) + 1 >= 10 ? parseInt(new Date(newend).getMonth()) + 1 : "0" + (parseInt(new Date(newend).getMonth()) + 1);
        etd = new Date(newend).getDate() >= 10 ? new Date(newend).getDate() : "0" + new Date(newend).getDate();
        starttime = sty + "-" + stm + "-" + std;
        endtime = ety + "-" + etm + "-" + etd;
        bendtime = sty + "-" + stm + "-" + std + ' ' + his;
    }
    // 获取url id
    function getId(pname) {
        var pathname = location.search;
        pathname = pathname.slice(1);
        var obj = {};
        if (pathname) {
            var arr = pathname.split('&');
            for (var i = 0; i < arr.length; i++) {
                var kv = arr[i].split('=');
                obj[kv[0]] = kv[1];
            }
        }
        return obj[pname];
    }
    // 渲染 订金部分
    function renderDestinePrice(i, stime, etime) {
        var html = '';
        html += '<tr class="destineTR' + i + '">\
                            <td>' + stime + ' - ' + etime + '</td>\
                            <td>\
                            <input type="text" name="deposit[]" class="form-control destine-price-ipt input-sm" value="">\
                            </td>\
                            <td>\
                            <input type="text" name="deposit_time[]" class="form-control destine-time input-sm" value="">\
                            </td>\
                            <td>\
                            <input type="text" name="retainage_time[]" class="form-control destine-time input-sm" value="">\
                            </td>\
                        </tr>'

        return html;
    }
    // 初始化订金laydata
    function initDestineData() {
        var dataDom = document.querySelectorAll('.destine-table .destine-time');
        for (var i = 0; i < dataDom.length; i++) {
            var element = dataDom[i];
            laydate.render({
                elem: element,
                trigger: 'click',
                type: 'datetime'
            });
        }
    }
    // 初始化第一个
    !isYanxue && initDestineData();

    // 渲染 营期差价
    function renderPriceDiff(i, stime, etime) {
        var html = '';
        html += '<tr class="priceDiffTR' + i + '">\
                    <td>' + stime + ' - ' + etime + '</td>\
                    <td>\
                    <span class="radio_box r_on">\
                    <input  type="radio" value="0" name="priceDiffRd' + i + '" value="0" class="my_radio priceDiff-type" checked>\
                    <label> - </label>\
                    </span>\
                    <span class="radio_box">\
                    <input type="radio" value="1" name="priceDiffRd' + i + '" value="1" class="my_radio priceDiff-type">\
                    <label> + </label>\
                    </span>\
                    </td>\
                    <td>\
                    <input type="text" class="form-control priceDiff-ipt input-sm" value="">\
                    </td>\
                    </tr>'

        return html;
    }

    // 營期差價 控制
    $('#c-priceDiff').on('click', function () {
        $('.priceDiff-box').addClass('hide');
    })
    $('#priceDiff').on('click', function () {
        $('.priceDiff-box').removeClass('hide');
    })

    // 订金控制
    $('#nodestine').on('click', function () {
        $('.batch-destine').addClass('hide');
        $('.destine-table').addClass('hide');
    })
    $('#hasdestine').on('click', function () {
        $('.batch-destine').removeClass('hide');
        $('.destine-table').removeClass('hide');
    })

    // 批量设置订金金额
    $('.batch-destine').on('click', function () {
        layer.prompt({
            formType: 0,
            value: 0,
            title: '批量设置' + dingjintext + '金额'
        }, function (value, index, elem) {
            if (!/^[0-9]+([.]{1}[0-9]+){0,1}$/.test(value)) {
                layer.msg('请输入正确金额')
                return
            }
            $('.destine-price-ipt').val(value);
            layer.close(index);
        })
    })

    // 批量设置 sku价格
    $('.batch-price').on('click', function () {
        layer.prompt({
            formType: 0,
            value: 0,
            title: '批量设置价格'
        }, function (value, index, elem) {
            if (!/^[0-9]+([.]{1}[0-9]+){0,1}$/.test(value)) {
                layer.msg('请输入正确金额')
                return
            }
            $('.skuPariceIpt input').val(value);
            layer.close(index);
        })
    })

    // 限期优惠
    $('#qxyes').on('click', function () {
        $(".yhcon").removeClass('hide')
        $('.nicknames').removeClass('hide')
        if ($('#hasSpec').prop('checked')) {
            $(".sku-break-box-all").removeClass('hide')
            $(".sku-break-box").removeClass('hide')
        }
    })
    $('#qxno').on('click', function () {

        $(".yhcon").addClass('hide')
        $('.nicknames').addClass('hide')
        $(".sku-break-box-all").addClass('hide')
        $(".sku-break-box").addClass('hide')
    })
    laydate.render({
        elem: '#breakTime',
        trigger: 'click',
        type: 'datetime',
        range: '~'
    });

    // VIP折扣
    $('input[name="is_vipcard"]').on('click', function () {
        $('.vipPriceBox')[$(this).val() == 1 ? 'removeClass' : 'addClass']('hide');
    })

    // 报名成功广告
    $('input[name="is_ad"]').on('click', function () {
        $('.adPriceBox')[$(this).val() == 1 ? 'removeClass' : 'addClass']('hide');
        $('.select-wrapper')[$(this).val() == 1 ? 'removeClass' : 'addClass']('hide');
    })

    //增加限期优惠
    var yhlicount = 0;
    $('.addyhli').on('click', function () {
        var len = $('.yhli').length;
        yhlicount = len + 1;
        var v = `<div class="yhli">
                            <input type="text" class="datepicker datepicker4 form-control dataBox" id="breakTime` + yhlicount + `" style="border-radius:2px;width:330px" name="break_time[]" value=""> 之间购买减
                            <input class="form-control dataBox" style="width: 100px;" maxlength="10" type="text" name="break_price[]" value=""> 元
                            <input class="form-control dataBox" name="break_ynicknames[]" placeholder="请输入昵称" style="width: 120px;" />
                            <button type="button" class="btn btn-danger btn-xs deleteyhli">删除</button></div>`;
        $('.yhlist').append(v);
        laydate.render({
            elem: '#breakTime' + yhlicount,
            trigger: 'click',
            type: 'datetime',
            range: '~'
        });
        $('.deleteyhli').removeClass('hide');
        yhlicount++;
    });
    //删除限期优惠
    $('.yhlist').on('click', '.deleteyhli', function () {
        $(this).parent().remove();
        $('.yhli').length == 1 && $('.deleteyhli').addClass('hide');
    });

    // 多人满减
    var fullCutNum = 2;

    $('#fullCut,#fullCut2').on('click', function () {
        $('.fullCutCon').removeClass('hide');
        $('.is_hide_full').removeClass('hide');
        $('.fullCutInfo').html('')
        hideFullCutDel();
    })
    $('#noFullCut').on('click', function () {
        $('.fullCutCon').addClass('hide');
        $('.is_hide_full').addClass('hide');
    })
    // 添加
    $('.addFullCut').on('click', function () {
        fullCutNum = $('.fullCutItem').last().find('.peopleNum').val() || 1;
        fullCutNum++;
        var _type = $('input[name=is_fullCut]:checked').val()
        // console.log($('input[name=is_fullCut]:checked').val());
        var retHtml = renderFullCat(fullCutNum, _type);
        $('.fullCutInfo').append(retHtml);
        showFullCutDel();
    })
    // 删除
    $('.fullCutCon').on('click', '.deleteFullCut', function () {
        fullCutNum--;
        $(this).parent().remove();
        hideFullCutDel();
    })

    function renderFullCat(num, _type) {
        var type = _type == 2 ? '总共' : '每人'
        var fullCutHtml = '<div class="fullCutItem">\
            满 <input type="text" value="' + num + '" class="form-control fullCatIpt peopleNum"> 人，' + type + '减 <input type="text" class="form-control fullCatIpt fullCutPrice"> 元 <button type="button" class="btn btn-danger btn-xs deleteFullCut">删除</button>\
            </div>';
        return fullCutHtml;
    }

    function hideFullCutDel() {
        if ($('.fullCutInfo .fullCutItem').length == 1) {
            $('.deleteFullCut').first().addClass('hide');
        }
    }

    function showFullCutDel() {
        if ($('.fullCutInfo .fullCutItem').length > 1) {
            $('.deleteFullCut').first().removeClass('hide');
        }
    }

    var cardSelectArr = '', //用户选择的购买送券
        cardSelect = $('#cardSelect'), //送券dom
        givecard = $('#givecard'), //购买送券开启按钮
        nogivecard = $('#nogivecard');

    //点击问号提示
    $('#questionIco').on('click', function () {
        $('#givecardTipDialog').modal();
    });
    //点击关闭购买送券
    $('#nogivecard').on('click', function () {
        $('.cardSelectBox').addClass('hide');
        $('#cardlistchecked').addClass('hide');

        $("#parenting_config_card").addClass('dn');
    });
    //点击购买送券
    givecard.on('click', function () {
        if (givecard.parent().hasClass('r_on')) {
            return;
        }
        $('.cardSelectBox').removeClass('hide');
        if ($("#selbucard tr").length != 0) {
            $('#cardlistchecked').removeClass('hide');
        }

        if ($("input[name=product_type]:checked").val() == 1) {
            $("#parenting_config_card").removeClass('dn');
        }
    });
    //打折只能输数字
    $('#vipPrice').keypress(function (event) {
        e = event || window.event;
        var ntype = window.event ? e.keyCode : e.which;
        if (ntype == 110 || ntype >= 48 && ntype <= 57 || ntype == 8 || ntype == 46) { } else {
            return false;
        }
    });

    // 图片
    $('.infoImgs').on('change', '.imgvi input[type="file"]', function () {
        upLoadsImg(this, true);
    })
    $('#uploadimg6').on('change', function () {
        upLoadsImg(this);
    })
    $('#uploadimg7').on('change', function () {
        upLoadsImg(this);
    })
    $('#uploadimg8').on('change', function () {
        upLoadsImg(this);
    })
    $('#uploadimgad').on('change', function () {
        upLoadsImg(this);
    })
    $('#cshareimg').on('change', function () {
        upLoadsImg(this);
    })
    $('#upload_remind').on('change', function () {
        upLoadsImg(this);
    })
    $('#dkWelomeimg').on('change', function () {
        upLoadsImg(this);
    })
    function upLoadsImg(_this, isSwiper) {
        var reader = new FileReader();
        reader.readAsDataURL(_this.files[0]);
        reader.onload = function (e) {
            var url = e.target.result;
            var sortIndex = null;
            $.ajax({
                type: "post",
                url: "__APP__/home/camp/upLoadImg",
                data: "base64=" + url + "&url=1",
                dataType: "json",
                beforeSend: function () {
                    sortIndex = layer.load(1, {
                        shade: [0.3, '#000']
                    });
                },
                success: function (data) {
                    layer.close(sortIndex);
                    if (data.status) {
                        layer.msg('上传成功');
                        $(_this).prev().attr('src', data.url + '?imageView2/2/w/750');
                        var addflag = true;
                        if ($(_this).next().val()) {
                            addflag = false;
                        }
                        $(_this).next().val(data.url);
                        $(_this).siblings("font").removeClass("hidden");
                        if (isSwiper) {
                            // imgArr.push(data.url);
                            if ($('.pic-box span').length > 4) {
                                $('#swiperNo').html(5)
                                layer.msg('最多只能上传五张图片');
                                return;
                            }
                            if (addflag) {
                                renderImg();
                            }
                        }
                    } else {
                        layer.msg('上传失败，请重试');
                        return;
                    };
                },
                error: function () {
                    layer.msg('上传失败，请重试');
                }
            });
        };
    }

    var startTimeDemo = $('#text1');
    var rangeTimeLen = $('.datepicker').length;
    for (var i = 1; i <= rangeTimeLen; i++) {
        uselaydate(i)
    }

    function uselaydate(b) {
        if (!b) {
            b = '';
        }
        //报名日期
        laydate.render({
            elem: '.enroll-time' + b,
            trigger: 'click',
            type: 'datetime',
            ready: function (date) {
                this.dateTime.hours = 23;
                this.dateTime.minutes = 59;
                this.dateTime.seconds = 59;
            }
        });
        //营期
        laydate.render({
            elem: '.range-time' + b,
            trigger: 'click',
            range: true,
            done: function (value, date, endDate) {
                $('.range-time' + b).attr('s', date.year + '-' + date.month + '-' + date.date);
                $('.range-time' + b).attr('e', endDate.year + '-' + endDate.month + '-' + endDate.date);
                var selector = this.elem.selector;
                var id = $(selector).parents('.period-item').find('.del-period').data('id');
                $('.destineTR' + id).find('td:first').html(value);
                $('.priceDiffTR' + id).find('td:first').html(value);
                if (!$('.enroll-time' + b).val()) {
                    var date = date.year + '-' + date.month + '-' + date.date;
                    $('.enroll-time' + b).val(date + ' 00:00:00');
                }
            },

        });
        //支付截止日期
        // payendtime
        laydate.render({
            elem: '.payendtime' + b,
            trigger: 'click',
            type: 'datetime',
            ready: function (date) {
                this.dateTime.hours = 23;
                this.dateTime.minutes = 59;
                this.dateTime.seconds = 59;
            }
        });
    }

    // 获取下拉信息
    var contractTmp = '' // 合同数据
    var form_list = ''; // 儿童表列表
    var big_form_list = ''; // 成人表列表
    var cTitle = ''; // 营种一级类型
    getSelectInfo()
    function getSelectInfo() {
        $.ajax({
            url: '__APP__/Admin/CourseGoods/getSelectInfo',
            type: 'post',
            data: {
                cid: cid,
                pid: pid,
                is_yanxue: isYanxue ? 1 : 0
            },
            dataType: 'json',
            success: function (data) {
                if (data.code != 0) {
                    layer.msg(data.msg);
                    return
                }

                // 花呗分期
                if (data.data.is_show_ali == 0) {
                    $('#is_spend_bai_on').attr('disabled', 'disabled')
                    $('#is_spend_bai_on').parent().on('click', function () {
                        layer.open({
                            title: '提示',
                            type: 1,
                            content: '<div style="padding:20px;">请先联系您的专属客服授权支付宝小程序</div>',
                            btn: 0,
                            area: ['400px', 'auto']
                        })
                    })
                }

                var type_list = data.data.type_list;
                var form_listHtml = '';
                var type_listHtml = '';
                var v = data.data.contruct_list,
                    t = '',
                    t1 = '';

                default_contract_id = data.data.default_id;
                form_list = data.data.form_list;
                big_form_list = data.data.big_form_list;

                if (data.data.must_contract == 2) {
                    for (var i = 0; i < v.length; i++) {

                        if (v[i].is_select == 1) {
                            t += `<div class="contract-li clearfix">
                                <select class="form-control contract-select">`;
                            for (var z = 0; z < v.length; z++) {
                                if (z == i) {
                                    t += `<option selected value="` + v[z].contract_id + `">` + v[z].name + `</option>`;
                                } else {
                                    t += `<option value="` + v[z].contract_id + `">` + v[z].name + `</option>`;
                                }
                            }
                            t += `</select>
                                <div class="col-sm-1 add-contract-box">
                                    <a href="javascript:;" class="myicon delete-contract">-</a>
                                    <a href="javascript:;" class="myicon add-contract">+</a>
                                </div>
                                <label class="contract_mustread">`
                            for (var j = 0; j < v.length; j++) {
                                if (j == i) {
                                    if (v[j].is_checked == 1) {
                                        t += `<input type="checkbox" name="" checked> 强制阅读 `
                                    } else {
                                        t += `<input type="checkbox" name=""> 强制阅读 `
                                    }
                                }

                            }
                            t += `</label>
                                </div>`;
                        }
                    }
                } else {
                    for (var i = 0; i < v.length; i++) {
                        if (v[i].is_select == 1) {
                            t += `<div class="contract-li clearfix">
                                <select class="form-control contract-select">`;
                            for (var z = 0; z < v.length; z++) {
                                if (z == i) {
                                    t += `<option selected value="` + v[z].contract_id + `">` + v[z].name + `</option>`;
                                } else {
                                    t += `<option value="` + v[z].contract_id + `">` + v[z].name + `</option>`;
                                }
                            }
                            t += `</select>
                                <div class="col-sm-1 add-contract-box">
                                    <a href="javascript:;" class="myicon delete-contract">-</a>
                                    <a href="javascript:;" class="myicon add-contract">+</a>
                                </div>
                                </div>`;
                        }
                    }
                }

                if (data.data.ty_open == 1) {
                    $('#tyht').addClass('hide')
                } else {
                    $('#tyht').removeClass('hide')
                    let ty_list = data.data.contruct_list2;
                    ty_list.map(res => {
                        if (res.is_select == 1) {
                        $('#contract_id2').append(`<option selected value="` + res.contract_id + `">` + res.name + `</option>`)
                    } else {
                        $('#contract_id2').append(`<option value="` + res.contract_id + `">` + res.name + `</option>`);
                    }
                })
                }

                if (data.data.hy_open == 1) {
                    $('#hyht').addClass('hide')
                } else {
                    $('#hyht').removeClass('hide')
                    let hy_list = data.data.contruct_list3;
                    hy_list.map(res => {
                        if (res.is_select == 1) {
                        $('#contract_id3').append(`<option selected value="` + res.contract_id + `">` + res.name + `</option>`)
                    } else {
                        $('#contract_id3').append(`<option value="` + res.contract_id + `">` + res.name + `</option>`);
                    }
                })
                }

                for (var i = 0; i < v.length; i++) {
                    t1 += `<option value="` + v[i].contract_id + `">` + v[i].name + `</option>`;
                }

                if (big_form_list) {
                    // 双亲
                    var _html = '';
                    _html += '<label class="col-sm-2 control-label"><span class="must">*</span> 选择报名表:</label><div class="col-sm-4">儿童: <select style="display: inline-block; width: 60%;" class="form-control" name="form_id">';
                    for (var i = 0; i < form_list.length; i++) {
                        var ele = form_list[i];
                        if (ele.is_select == 1) {
                            _html += '<option selected value="' + ele.form_id + '">' + ele.name + '</option>';
                        } else {
                            _html += '<option value="' + ele.form_id + '">' + ele.name + '</option>';
                        }
                    }
                    _html += '</select><br><br>成人: <select style="display: inline-block; width: 60%;" class="form-control" name="big_form_id">';
                    for (var j = 0; j < big_form_list.length; j++) {
                        var ele = big_form_list[j];
                        if (ele.is_select == 1) {
                            _html += '<option selected value="' + ele.form_id + '">' + ele.name + '</option>';
                        } else {
                            _html += '<option value="' + ele.form_id + '">' + ele.name + '</option>';
                        }
                    }
                    _html += '</select><a href="/Admin/Set/studentTpl" target="_blank">去设置</a></div>';
                    $('.form_id_box').html(_html);

                } else {
                    // 单人
                    for (var j = 0; j < form_list.length; j++) {
                        var ele = form_list[j];
                        if (ele.is_select == 1) {
                            form_listHtml += '<option selected value="' + ele.form_id + '">' + ele.name + '</option>';
                        } else {
                            form_listHtml += '<option value="' + ele.form_id + '">' + ele.name + '</option>';
                        }
                    }
                    $('#form_id').html(form_listHtml);
                }

                //              营种分类
                var getctitles = []
                var postctypes = ''
                $.each(type_list, function () {
                    if (this.is_select == 1) {
                        getctitles.push(this.ctid);
                        type_listHtml += '<option value="' + this.ctid + '" selected="selected">' + this.name + '</option>';
                    } else {
                        type_listHtml += '<option value="' + this.ctid + '">' + this.name + '</option>';
                    }
                })
                $('#ctype').html(type_listHtml);
                if (getctitles.length > 0) {
                    cTitle = getctitles.join(',');

                }
                $('#ctype').selectize({
                    plugins: ['remove_button'],
                    onChange: function (name) {
                        cTitle = name ? name.join(',') : '';
                    }
                });

                if (data.data.must_contract == 2) {
                    contractTmp = `<div class="contract-li clearfix">
                            <select class="form-control contract-select">` + t1 + `</select>
                            <div class="col-sm-1 add-contract-box">
                            <a href="javascript:;" class="myicon delete-contract">-</a>
                            <a href="javascript:;" class="myicon add-contract">+</a>
                            </div>
                            <label class="contract_mustread"><input type="checkbox" name="" > 强制阅读</label>
                            </div>`;
                } else {
                    contractTmp = `<div class="contract-li clearfix">
                            <select class="form-control contract-select">` + t1 + `</select>
                            <div class="col-sm-1 add-contract-box">
                            <a href="javascript:;" class="myicon delete-contract">-</a>
                            <a href="javascript:;" class="myicon add-contract">+</a>
                            </div>
                            </div>`;
                }

                // $('#contractBox .contract-select').selectize()[0].selectize.destroy()

                $('#contractBox').html(t); //渲染合同
                var numSelect = $('#contractBox select').length;
                for (var i = 0; i < numSelect; i++) {
                    $('#contractBox select').eq(i).selectize({
                        // plugins: ['remove_button'],
                        onChange: function (name) {
                            name = name || [];
                            $('#contractBox select').eq(i).find(`option[value=${name[0]}]`).prop('selected', 'selected');
                        }
                    });

                }
                if ($('.contract-li').size() == 1) {
                    $('#contractBox').find('.add-contract').removeClass('hidden');
                }
                if ($("#contractBox").find(".contract-li").length == 1) {
                    $('#contractBox').find('.delete-contract').eq(0).addClass('hidden');
                }
                //	$('#contractBox').find('.add-contract').last().removeClass('hidden');
            }
        });
    }

    //增加报名合同
    $('#contractBox').on('click', ".add-contract", function () {
        $('#contractBox').append(contractTmp);
        var numSelect = $('#contractBox select').length;
        $('#contractBox select').eq(numSelect - 1).selectize({
            // plugins: ['remove_button'],
            onChange: function (name) {
                name = name || [];
                $('#contractBox select').eq(numSelect - 1).find(`option[value=${name[0]}]`).prop('selected', 'selected');
            }
        });
        $('#contractBox select').eq(numSelect - 1).selectize()[0].selectize.setValue(default_contract_id.split(","))
        var len = $("#contractBox").find(".contract-li").length
        if (len == 2) {
            console.log($("#contractBox .contract-li").eq(0))
            $("#contractBox").find(".delete-contract").removeClass('hidden');
        }
    })

    function addDel(that) {
        var len = that.parents("#contractBox").find(".contract-li").length
        if (len <= 2) {
            that.parents("#contractBox").find(".contract-li").find('.delete-contract').addClass('hidden');
        }
    }

    //删除报名合同
    $('#contractBox').on('click', '.delete-contract', function () {
        var p = $(this).parent().parent();
        var prev = p.eq(0).prev();
        var next = p.eq(0).next();
        addDel($(this))
        p.remove();
    });

    //获取tag列表 S
    var tagSelect = $('#tagSelect'),
        postTagArr = '';

    getTag();

    function getTag() {
        if (isYanxue) {
            return;
        }
        $.ajax({
            url: '/Admin/Goods/gettagajax',
            type: 'POST',
            dataType: 'json',
            data: {
                pid: pid
            },
            success: function (data) {
                if (data.code != 0) {
                    layer.msg(data.msg);
                }
                var gettagArr = [];
                if (data.data.length != 0) {
                    var tmp = '';
                    $.each(data.data, function () {
                        if (this.is_select == 1) {
                            gettagArr.push(this.tagname);
                            tmp += '<option value="' + this.tagname + '" selected="selected">' + this.tagname + '</option>';
                        } else {
                            tmp += '<option value="' + this.tagname + '">' + this.tagname + '</option>';
                        }
                    })
                }
                tagSelect.html(tmp);
                if (gettagArr.length > 0) {
                    postTagArr = gettagArr.join(',');
                }
                tagSelect.selectize({
                    plugins: ['remove_button'],
                    persist: true,
                    createOnBlur: true,
                    create: true,
                    onChange: function (name) {
                        if (name) {
                            postTagArr = name.join(',');
                        } else {
                            postTagArr = '';
                        }
                    }
                });

            }
        });
    }
    //获取tag列表 E

    // 获取全部营长
    var selectMajor, optionMajor;

    !isYanxue && getAllMajor();

    function getAllMajor() {
        $.ajax({
            url: '__APP__/Admin/Major/AllMajor',
            type: 'post',
            data: {
                cid: cid
            },
            dataType: 'json',
            success: function (data) {
                if (data.code != 0) {
                    layer.msg(data.msg);
                    return
                }
                data = data.data;
                var str = '';
                for (var i = 0; i < data.length; i++) {
                    if (data[i].is_select == 1) {
                        str += '<option value="' + data[i].id + '" selected>' + data[i].name + '</option>'
                    } else {
                        str += '<option value="' + data[i].id + '">' + data[i].name + '</option>'
                    }
                }
                $('#major-body').html(str);
                selectMajor = $('#major-body').selectize({
                    plugins: ['remove_button']
                })
                optionMajor = selectMajor[0].selectize;
            }
        })
    }

    // 获取增值服务分类
    function getExtraService() {
        $.ajax({
            url: '__APP__/Admin/Ownpay/getAlltype',
            success: function (data) {
                if (data.code == 0) {
                    var str = '<option value="0">请选择</option>';
                    data.data.filter((item) => {
                        str += `<option value='${item.id}'>${item.name}</option>`
                })
                    $('.types').html(str)
                    typestr = $('#addserviceitem').html()
                } else {
                    layer.msg(data.msg);
                }
            }
        })
    }

    // 获取 common信息
    var commonLayerIndex = null;
    var is_on = ""
    pid ? getInfo() : getExtraService();

    function getInfo() {
        $.ajax({
            url: '__APP__/Admin/CourseGoods/getCourseInfo',
            type: 'post',
            data: {
                pid: pid,
                cid: cid
            },
            dataType: 'json',
            beforeSend: function () {
                commonLayerIndex = layer.load(1, {
                    shade: [0.3, '#000']
                });
            },
            success: function (data) {
                layer.close(commonLayerIndex);
                if (data.code != 0) {
                    layer.msg(data.msg);
                    return
                }
                if (data.is_start == 0) {
                    $('#editCode').addClass('hide')
                }
                data = data.data;
                bindSchoolId = data.school_id; // 研学产品绑定的学校id
                productUpdateStatus = data.status || 2; // 添加研学时状态是2 编辑时返回几保存时就是几
                $('input[name="cName"]').val(data.cName);
                $('input[name="desc"]').val(data.desc);
                $(`[name=is_seal][value=${data.is_seal}]`).trigger('click'); // 电子签章
                data.cover_pic && $('#ImgPr6').attr('src', data.cover_pic + '?imageView2/2/w/750').next().next().val(data.cover_pic); // 封面图

                // 营员积分 START
                $('#gain-integral-num').val(data.gain_integral_num || '');
                $(`input[type=radio][name=is_gain_integral]`)
                    .prop('checked', false)
                    .parents('.radio_box')
                    .removeClass('r_on');
                $(`input[type=radio][name=is_gain_integral][value=${data.is_gain_integral}]`)
                    .prop('checked', true)
                    .parents('.radio_box')
                    .addClass('r_on')
                    .end()
                    .trigger('change');
                // 营员积分 END

                // 轮播图 START
                var arr = [data.photo1, data.photo2, data.photo3, data.photo4, data.photo5];
                arr = arr.filter(function (s) {
                    return s && s.trim();
                });
                $('.pic-box').html('');
                for (var i = 0; i < arr.length; i++) {
                    renderImg(arr[i]);
                }
                if (arr.length < 5) {
                    renderImg();
                }
                // 轮播图 END

                // 增值服务渲染 START
                $('.types').html('<option value="0">请选择</option>' + $.map(data.take_type_list, function (item, index) {
                    return `<option value='${item.id}'>${item.name}</option>`;
                }).join(''))
                typestr = $('#addserviceitem').html();
                if (data.is_take == 1) {
                    $('#on_service').trigger('click');
                    $('#addserviceitem').html('')
                    if (data.take_json.length < 1) {
                        $('#addserviceitem').append(typestr)
                    }
                    data.take_json.filter((item, index) => {
                        $('#addserviceitem').append(typestr)
                    $('.types')[index].value = item.type_id
                    $('.typesname')[index].value = item.other_name
                })
                }
                // 增值服务渲染 END
                $('input[name="weight"]').val(data.weight); // 排序
                $(`[name=on_off_notice][value=${data.on_off_notice}]`).trigger('click'); // 提醒公告栏渲染
                $('input[name=notice_content]').val(data.notice_content); // 提醒公告内容
                // 立即报名按钮 START
                if (data.is_sign == 1) {
                    $('#custom_sign').trigger('click');
                    signBg = data.sign_bg || '';
                    signText = data.sign_text || '';
                    $('#signBg').spectrum("set", signBg);
                    $('#signText').spectrum("set", signText);
                    $('input[name=btn-text]').val(data.sign_btn_text);
                }
                // 立即报名按钮 END

                $('.noSpec-box-price>input').val(data.price); // 统一定价
                $(`[name=is_show_use][value=${data.is_show_use}]`).trigger('click'); // 使用说明开关
                $(`[name=is_show_detail][value=${data.is_show_detail}]`).trigger('click'); // 产品详情开关
                // 显示价格
                if (data.price_show_type == 1) {
                    $('#myprice').trigger('click');
                    $('input[name="show_price"]').val(data.show_price);
                }
                $(`[name=is_forbid_form][value=${data.is_forbid_form}]`).trigger('click'); // 是否填写报名表
                $(`[name=add_status][value=${data.add_status}]`).trigger('click'); // 报名顺序
                // 报名时限渲染
                if (data.edit_form_status == 1) {
                    $('#edit_status_two').trigger('click');
                    $('input[name=edit_form_day]').val(data.edit_form_day);
                }
                // 报名成功广告渲染
                $(`[name=is_ad][value=${data.is_ad}]`).trigger('click');
                data.ad_file && $('#ImgPrad').attr('src', data.ad_file || '');
                $(`[name=poster_select_type][value=${data.poster_select_type}]`).trigger('click');
                data.poster_select_type != 1 && $('.show-target').css("display", "none");
                $('input[name="posters_path"]').val(data.posters_path);

                $(`input[name="new_refund_status"][value="${data.new_refund_status}"]`).trigger('click'); //  设置 自助退营开关
                $(`select[name="new_refund_time_type"]`).val(data.new_refund_time_type); //  设置 自助退营 开营 || 结营
                $(`input[name="new_refund_day"]`).val(data.new_refund_day || 0); //  设置 自助退营 多少天
                $(`input[name="new_exchange_status"][value="${data.new_exchange_status}"]`).trigger('click'); //  设置 自助换营开关
                $(`select[name="new_exchange_time_type"]`).val(data.new_exchange_time_type); //  设置 自助换营 开营 || 结营
                $(`input[name="new_exchange_day"]`).val(data.new_exchange_day || 0); //  设置 自助换营 多少天

                $('.imgvi').each(function (k, v) {
                    $(this).find('.imgUrl').val() && $(this).find('font').removeClass('hidden');
                });

                is_on = data.is_on;

                // 研学用不到后面的
                if (isYanxue) {
                    return;
                }

                // 出营类型
                $(`[name=product_type][value=${data.product_type}]`).trigger('click')
                data.is_buy == 1 && $('.product_type').prop('disabled', true);
                $('input[name=is_check]').eq(data.is_check).trigger('click')
                console.log(data.new_refund_service_charge)
                if (parseInt(data.new_refund_service_charge) == 0) {
                    console.log(1111);
                    $("#isRefund").parent(".isRefundBox").addClass("r_on")
                    $("#unRefund").parent(".isRefundBox").removeClass("r_on")
                    $("#isRefund").prop('checked', true)
                    $("#unRefund").removeAttr('checked')
                } else if (parseInt(data.new_refund_service_charge) == 1) {
                    $("#unRefund").parent(".isRefundBox").addClass("r_on")
                    $("#isRefund").parent(".isRefundBox").removeClass("r_on")
                    $("#isRefund").removeAttr('checked')
                    $("#unRefund").prop('checked', true)
                }

                hasGetInfo = true;

                $('input[name="other_price"]').val(data.other_price);
                $('input[name="line_price"]').val(data.line_price);
                $('input[name="prime_cost"]').val(data.prime_cost);
                $('input[name="address"]').val(data.address);
                $('input[name="khdh"]').val(data.khdh);
                $('input[name="khdhname"]').val(data.khdhname);
                $('input[name="sage"]').val(data.sage);
                $('input[name="eage"]').val(data.eage);

                data.material_info && $('#ImgPr7').attr('src', data.material_info).next().next().val(data.material_info);
                data.wechat_code && $('#ImgPr8').attr('src', data.wechat_code).next().next().val(data.wechat_code);
                $('input[name="days"]').val(data.days);
                $('input[name="night"]').val(data.night);

                // 渲染自定义有效期内容
                var valid_start_type = $('input[name=valid_start_type]')
                var valid_end_type = $('input[name=valid_end_type]')
                var valid_limit_end_day = $('input[name=valid_limit_end_day]')
                var valid_limit_start_date = $('input[name=valid_limit_start_date]')
                var valid_limit_end_date = $('input[name=valid_limit_end_date]')
                var valid_limit_start_h = $('input[name=valid_limit_start_h]')


                // 卡券核销
                $(`input[name=hx_status][value=${data.hx_status}]`).trigger('click')
                $('.hx_num_box input').val(data.hx_num);
                $(`input[name=valid_start_type][value=${data.valid_start_type}]`).trigger('click');

                const yxqhideIndex = { '1': 'one', '2': 'two', '3': 'three' };

                if (data.hx_is_defined == 1 && data.hx_status == 1) {
                    $("#hx_isValid").prop("checked", true)
                    $(".isValid_list").css("display", "block")
                }

                if (['1', '2', '3'].includes(data.valid_start_type)) {
                    $(`.yxqhide_${yxqhideIndex[data.valid_start_type]} input[name=valid_end_type][value=${data.valid_end_type}]`).trigger('click');
                    $(`.yxqhide_${yxqhideIndex[data.valid_start_type]} input[name=valid_limit_end_day]`).val(data.valid_limit_end_day || '');
                }

                if (data.valid_start_type == 4) {
                    $('input[name=valid_limit_start_date]').val(data.valid_limit_start_date).prop('disabled', false)
                    $('input[name=valid_limit_end_date]').val(data.valid_limit_end_date).prop('disabled', false)
                }

                // 预热报名渲染
                $(`[name=is_startsale][value=${data.is_startsale}]`).trigger('click')
                $('input[name=startsale_time]').val(data.startsale_time)
                $('input[name=startsale_desc]').val(data.startsale_desc)

                $(`[name=is_limit][value=${data.is_limit}]`).trigger('click')
                $('input[name=limits]').val(data.limits)
                $('input[name=limits_perio_parent]').val(data.limits_perio_parent)
                $('input[name=limits_perio_child]').val(data.limits_perio_child)

                // 是否限购 -> 设为单次限购
                if (data.product_type == '1') {
                    $('#limitSaleTypeMultiple').prop('checked', data.limit_sale_type == 1 ? true : false);
                } else {
                    $('#limitSaleTypeOne').prop('checked', data.limit_sale_type == 1 ? true : false);
                }


                //渲染图片之后判断显示 删除按钮
                $('.imgvi').each(function (k, v) {
                    $(this).find('.imgUrl').val() && $(this).find('font').removeClass('hidden')
                })

                // 是否使用日历
                data.is_calendar == 2 && $('.calendar-flag').prop('checked', true);
                // 是否开启 不与其他优惠同享
                // open-vip-type
                data.vip_type == 1 && $('#open-vip-type').prop('checked', true);

                // vip折扣 vip专享
                data.is_only_vip == 1 && $('#is_only_vip').prop('checked', true);

                // 封面图片
                $('#video_url input').val(data.video_url || '');

                // 活动时间
                $('input[name="time_str"]').val(data.time_str);
                // 其他配置
                $(`[name=is_sale][value=${data.is_sale}]`).trigger('click')

                //其他配置 销量
                $(`[name=is_show_salenum][value=${data.is_show_salenum}]`).trigger('click')
                $('#yis_show_realmoney').attr('disabled', data.is_show_salenum == 3 || data.is_show_salenum == 5 ? false : true)
                $('#yis_show_period').attr('disabled', data.is_show_salenum == 3 || data.is_show_salenum == 5 ? false : true)
                $('#yis_show_maxnum').attr('disabled', data.is_show_salenum == 3 || data.is_show_salenum == 5 ? false : true)
                $('.maxshownum').attr('disabled', data.is_show_salenum == 3 || data.is_show_salenum == 5 ? false : true)
                data.is_show_salenum == 3 && $('#initialSaleNum').val(data.show_salenum);
                if (data.is_show_salenum == 4) {
                    $('#sell_num').html(data.sell_num);
                    $('#show_salenum').val(data.show_salenum).attr('disabled', false).next().removeClass('hide')
                }
                if (data.is_show_salenum == 5) {
                    $('#yis_show_salenum').trigger('click')
                    $('#yis_show_realmoney').prop('checked', true)
                }

                data.is_show_period == 1 && $('#yis_show_period').prop('checked', true).attr('disabled', false)
                if (data.is_show_maxnum == 1) {
                    $('#yis_show_maxnum').prop('checked', true).attr('disabled', false)
                    $('.maxshownum').attr('disabled', false)
                    $('.maxshownum').val(data.maxshownum)
                }

                sell_num = data.actualnum
                // 库存扣除时间
                $(`[name=cancel_type][value=${data.cancel_type}]`).trigger('click')
                $(`[name=line_up][value=${data.line_up}]`).trigger('click')
                $('input[name=line_up_min]').val(data.line_up_min)
                // 库存扣除时间
                // 内部备注表单:
                $('#mark_form_id').val(data.mark_form_id);


                //              往期回顾
                $(`[name=lookback][value=${data.lookback}]`).trigger('click')
                //              会员可互相评论:
                $('input[name=is_to_comment][value=' + data.is_to_comment + ']').trigger('click')
                //              会员评论可见:
                $('input[name=is_look][value=' + data.is_look + ']').trigger('click')
                // 签到签出
                $(`[name=signin_way][value=${data.signin_way}]`).trigger('click')
                // 购买送币
                $(`[name=is_give_coin][value=${data.is_give_coin > 1 ? 1 : data.is_give_coin}]`).trigger('click')
                $(`[name=is_give_coin_type][value=${data.is_give_coin == '0' ? '1' : data.is_give_coin}]`).trigger('click')
                $('input[name="give_coin_type1"]').val(data.give_coin);
                $('input[name="give_coin_type2"]').val(data.give_coin);
                $(`[name=vip_tq_type][value=${data.vip_tq_type}]`).trigger('click')
                $(`[name=vip_coin_type][value=${data.vip_coin_type}]`).trigger('click')
                $('input[name="vip_givecoin"]').val(data.vip_givecoin);
                $('input[name="vip_givecoin1"]').val(data.vip_givecoin1);
                //大转盘 编辑信息 保存用joinlottery 返回用is_lottery
                $(`[name=joinlottery][value=${data.is_lottery}]`).trigger('click')
                $('select[name=lottermoneytype]').val(data.lottery_type)
                $('input[name=lottermoney]').val(data.lottery_money)
                $(`input[name=lotternum]:eq(${data.give_lottery_type || 0})`).val(data.lottery_num); // 有两个input[name=lotternum] 正好对应 满多少元送多少次(下标0) 每购买1个营位送多少次(下标1)
                $(`input[name="give_lottery_type"][value="${data.give_lottery_type || '0'}"]`).trigger('click'); // 参与大转盘赠送类型
                $('#give_lottery_only_child').prop('checked', data.give_lottery_only_child == 1 ? true : false); // 亲子 是否仅限亲子
                // 老营员优惠
                $(`[name=old_status][value=${data.old_status}]`).trigger('click')
                $('input[name="old_money"]').val(data.old_money);
                // 亲子优惠
                $(`[name=qz_status][value=${data.qz_status}]`).trigger('click')
                $('input[name="parent_num1"]').val(data.qz_json.big_num);
                $('input[name="parent_num2"]').val(data.qz_json.small_num);
                $('input[name="parent_price"]').val(data.qz_json.money);
                $('#qz_show_status').val(data.qz_json.qz_show_status || 0);
                //              渲染亲子差价
                $(`[name=qz_gap][value=${data.qz_gap}]`).trigger('click')
                $('select[name=c_plus]').val(data.c_plus)
                $('select[name=p_plus]').val(data.p_plus)
                $('input[name=p_gap_price]').val(data.p_gap_price)
                $('input[name=c_gap_price]').val(data.c_gap_price)
                //              渲染年卡
                $('#isYearCardUserUse').prop('checked', data.is_must_year == 1 ? true : false); // 年卡优惠 -> 年卡用户专享
                $('[name=is_over_give_coin]').prop('checked', data.is_over_give_coin == 1 ? true : false); // 购买送币 -> 结营后赠送虚拟币
                $('input[name=yearcard_desc]').val(data.yearcard_desc)
                $(`input[name=is_yearcard][value=${data.is_yearcard}]`).trigger('click')
                $(`input[name=is_medal][value=${data.is_medal}]`).trigger('click')
                $(`input[name=share_type][value=${data.share_type}]`).trigger('click')
                if (data.share_type == 2) {
                    $('#ImgPrfx').attr('src', data.bgsharepic)
                    $('input[name="bgsharepic"]').val(data.bgsharepic)
                    imgnew(data.bgsharepic).then(res => {
                        let imginfo = res.width / 375
                        $('.qode').css('height', data.ewm_height / imginfo + 'px')
                    $('.qode').css('width', data.ewm_width / imginfo + 'px')
                    $('.qode').css('top', data.ewm_y / imginfo + 'px')
                    $('.qode').css('left', data.ewm_x / imginfo + 'px')
                })
                }

                // 儿童拼床
                $(`input[name=is_bed][value=${data.is_bed}]`).trigger('click')
                $('input[name="is_bed_num"]').val(data.qz_json.is_bed_num);
                $('input[name="is_bed_price"]').val(data.qz_json.is_bed_price);

                // 起售数量
                $(`input[name=is_start_num][value=${data.is_start_num}]`).trigger('click')
                $('input[name="start_small_num"]').val(data.start_small_num);
                $('input[name="start_big_num"]').val(data.start_big_num);

                // 虚拟币排行榜
                $(`input[name=is_coinrank][value=${data.is_coinrank}]`).trigger('click')

                // 花呗分期
                $(`input[name=is_spend_bai][value=${data.is_spend_bai}]`).trigger('click')
                $('#is_course_list').prop('checked', (data.is_course_list == 1 ? true : false))
                $('#is_course_details').prop('checked', (data.is_course_details == 1 ? true : false))
                $('input[name=spend_bai_money]').val(data.spend_bai_money)

                //集合点
                if (data.gatherstr.length > 0) {
                    let gatherTmp = '';
                    for (var i = 0; i < data.gatherstr.length; i++) {
                        var latlng = data.gatherstr[i].latlng.split(',');
                        let pname = data.gatherstr[i].pick_up_way || 0
                        let remarkval = data.gatherstr[i].gather_premark
                        gatherTmp += `<div class="gather-li">
                                                集合地点 <input readonly class="form-control gather-li-address w300" type="text" value="` + data.gatherstr[i].gatheraddr + `" name="gatheraddr[]" />&nbsp;&nbsp;
                                                集合时间 <input readonly class="form-control gather-li-time w300" type="text" value="` + data.gatherstr[i].gathertime + `" name="gathertime[]" />
                                                补充地址 <input readonly class="form-control gather-li-getaddress w300" type="text" value="` + (data.gatherstr[i].getaddress || '') + `" name="getaddress[]" />
                                                接送方式 <input readonly class="form-control w300" type="text" value="` + (pname == 0 ? '无' : pname == 1 ? '家长送' : pname == 2 ? '无成人陪伴' : pname == 3 ? '老师带队' : '') + `" />
                                                ${remarkval == 1 ? "已开启家长备注" : "已关闭家长备注"}
                                                <input type="hidden" class="gather-li-pick" value="` + data.gatherstr[i].pick_up_way + `" name="pick_up_way[]" />
                                                <input type="hidden" class="gather-parent-remark" value="` + data.gatherstr[i].gather_premark + `" name="gather_premark[]" />
                                                <a class="glyphicon glyphicon-trash delete-gather" href="javascript:;"></a>
                                                <a class="glyphicon glyphicon-pencil edit-gather" href="javascript:;" lat="` + latlng[0] + `" lng="` + latlng[1] + `"></a>
                                                <input type="hidden" name="latlng[]" value="` + latlng[0] + `,` + latlng[1] + `" /></div>`;
                    }
                    gatherList.html(gatherTmp);
                    gatherBox.removeClass('hide');
                    $("#gathersel").removeClass('hide');
                    openGather.prop('checked', true).parent().addClass('r_on');
                    closeGather.prop('checked', false).parent().removeClass('r_on');
                    if (data.gather_type == 1) {
                        $("#gather_typeprv").prop('checked', true).parent().addClass('r_on');
                        $("#gather_typenext").prop('checked', false).parent().removeClass('r_on');
                    } else {
                        $("#gather_typeprv").prop('checked', false).parent().removeClass('r_on');
                        $("#gather_typenext").prop('checked', true).parent().addClass('r_on');
                        $("#is_sms_gather").removeClass("hide")
                        data.is_sms_gather == 1 ? $("#is_sms_gather input").prop('checked', true) : $("#is_sms_gather input").prop('checked', false)
                    }
                }
                if (data.e_gatherstr.length > 0) {
                    let gatherTmp = '';
                    for (var i = 0; i < data.e_gatherstr.length; i++) {
                        var latlng = data.e_gatherstr[i].e_latlng.split(',');
                        let pname = data.e_gatherstr[i].e_pick_up_way || 0
                        let remarkval = data.e_gatherstr[i].e_gather_premark
                        gatherTmp += `<div class="gather-li">
                                                集合地点 <input readonly class="form-control gather-li-address w300" type="text" value="` + data.e_gatherstr[i].e_gatheraddr + `" name="e_gatheraddr[]" />&nbsp;&nbsp;
                                                集合时间 <input readonly class="form-control gather-li-time w300" type="text" value="` + data.e_gatherstr[i].e_gathertime + `" name="e_gathertime[]" />
                                                补充地址 <input readonly class="form-control gather-li-getaddress w300" type="text" value="` + (data.e_gatherstr[i].e_getaddress || '') + `" name="e_getaddress[]" />
                                                接送方式 <input readonly class="form-control w300" type="text" value="` + (pname == 0 ? '无' : pname == 1 ? '家长接' : pname == 2 ? '无成人陪伴' : pname == 3 ? '老师带队' : '') + `" />
                                                ${remarkval == 1 ? "已开启家长备注" : "已关闭家长备注"}
                                                <input type="hidden" class="gather-li-pick" value="` + data.e_gatherstr[i].e_pick_up_way + `" name="e_pick_up_way[]" />
                                                <input type="hidden" class="gather-parent-remark" value="` + data.e_gatherstr[i].e_gather_premark + `" name="e_gather_premark[]" />
                                                <a class="glyphicon glyphicon-trash delete-gather" href="javascript:;"></a>
                                                <a class="glyphicon glyphicon-pencil edit-gather" href="javascript:;" lat="` + latlng[0] + `" lng="` + latlng[1] + `"></a>
                                                <input type="hidden" name="e_latlng[]" value="` + latlng[0] + `,` + latlng[1] + `" /></div>`;
                    }
                    e_gatherList.html(gatherTmp);
                    e_gatherBox.removeClass('hide');
                    $("#e_gathersel").removeClass('hide');
                    e_openGather.prop('checked', true).parent().addClass('r_on');
                    e_closeGather.prop('checked', false).parent().removeClass('r_on');
                    if (data.e_gather_type == 1) {
                        $("#e_gather_typeprv").prop('checked', true).parent().addClass('r_on');
                        $("#e_gather_typenext").prop('checked', false).parent().removeClass('r_on');
                    } else {
                        $("#e_gather_typeprv").prop('checked', false).parent().removeClass('r_on');
                        $("#e_gather_typenext").prop('checked', true).parent().addClass('r_on');
                        $("#e_is_sms_gather").removeClass("hide")
                        data.e_is_sms_gather == 1 ? $("#e_is_sms_gather input").prop('checked', true) : $("#e_is_sms_gather input").prop('checked', false)
                    }
                }

                // 简版行程
                $("table[class=subtable]").append($.map(data.journey, function (item, index) {
                    return `<tr class="trcon">\
                                    <td class="tdcon" > 第${index + 1}天</td >\
                                    <td class="tdcon"><textarea class="veri" type="text" name="morn[]">${item.morn}</textarea></td>\
                                    <td class="tdcon"><textarea class="veri" type="text" name="morning[]">${item.morning}</textarea></td>\
                                    <td class="tdcon"><textarea class="veri" type="text" name="afternoon[]">${item.afternoon}</textarea></td>\
                                    <td class="tdcon"><textarea class="veri" type="text" name="evening[]">${item.evening}</textarea></td>\
                                    <input class="veri" type="hidden" name="few_days[]" value="${item.few_days}"></tr>`;
                }).join(''))

                // 价格
                if (data.is_virtual >= 1) {
                    $('#yesvirtual').trigger('click');
                    $(`input[name="deduct"][value="${data.is_virtual - 1}"]`).trigger('click'); // 设置的是部分还是全额抵扣 不是开启关闭 所以减一
                    $('.virtual-box').removeClass('hide');
                    $('input[name="coin"]').val(data.coin);
                    $('input[name="coin_1"]').val(data.coin_1);
                    $('[name="coin_level"]').val(data.coin_level);
                }

                //仅支持全额虚拟币折扣
                //data.onlyinvented == 1 ? $('#onlyinvented').prop('checked', true) : $('#onlyinvented').prop('checked', false) // 不知道有用没用

                $('input[name="big_price"]').val(data.big_price); // 亲子营 大人价格

                if (data.is_sku == 1) {
                    $(`input[name="is_sku"][value="${data.is_sku}"]`).trigger('click');
                    getSkuFnc(cid, pid, 0, data.is_break_sku);
                }

                if (data.is_break_sku == 0) {
                    $('.sku-break-box-all input').prop('checked', false);
                    $('.sku-break-box').removeClass('hide');
                    var tmpSkuHtml = '';
                    for (var h = 0; h < data.sku_break_list.length; h++) {
                        var ele = data.sku_break_list[h];
                        var ck = '';
                        if (ele.is_select == 0) {
                            ck = ''
                        } else {
                            ck = 'checked'
                        }
                        tmpSkuHtml += '<span class="sku-break-box-item"><input type="checkbox" ' + ck + '> <span>' + ele.name + '</span></span>'
                    }
                    $('.sku-break-box').html(tmpSkuHtml);

                } else {
                    $('.sku-break-box-all input').prop('checked', true);
                }

                // 预定价格 deposit_list
                if (data.is_pre_order == 1) {
                    $('#hasdestine').trigger('click');
                }

                if (data.deposit_list.length) {
                    let depositHtml = '';
                    for (let i = 0; i < data.deposit_list.length; i++) {
                        var element = data.deposit_list[i];
                        depositHtml += '<tr class="destineTR' + (i + 1) + '">\
                                                    <td>' + element.name + '</td>\
                                                    <td>\
                                                    <input type="text" name="deposit[' + element.pid + ']" class="form-control destine-price-ipt input-sm" value="' + element.deposit + '">\
                                                    </td>\
                                                    <td>\
                                                    <input type="text" name="deposit_time[' + element.pid + ']" class="form-control destine-time input-sm" value="' + element.deposit_time + '">\
                                                    </td>\
                                                    <td>\
                                                    <input type="text" name="retainage_time[' + element.pid + ']" class="form-control destine-time input-sm" value="' + element.retainage_time + '">\
                                                    </td>\
                                                </tr>';
                    }
                    $('.destine-table table tbody').html(depositHtml);
                    hasSetDestine = true; // 之前保存过就用这里的渲染，获取营期接口里就不渲染了
                    initDestineData();
                }


                periodIndex = data.price_diff_list.length;

                // 营期差价
                if (data.is_price_diff == 1) {
                    $('#priceDiff').trigger('click');
                }
                var priceDiffHtml = '';
                for (var i = 0; i < data.price_diff_list.length; i++) {
                    var elem = data.price_diff_list[i];
                    var ckFlag1 = '';
                    var ckFlag2 = '';
                    if (elem.type == 0) {
                        ckFlag1 = 'checked';
                        ckFlag2 = '';
                    } else {
                        ckFlag1 = '';
                        ckFlag2 = 'checked';
                    }

                    priceDiffHtml += '<tr class="priceDiffTR' + (i + 1) + '">\
                                                <td>' + elem.name + '</td>\
                                                <td>\
                                                <span class="radio_box">\
                                                <input  type="radio" value="0" name="priceDiffRd' + i + '" value="0" class="my_radio priceDiff-type" ' + ckFlag1 + '>\
                                                <label> - </label>\
                                                </span>\
                                                <span class="radio_box">\
                                                <input type="radio" value="1" name="priceDiffRd' + i + '" value="1" class="my_radio priceDiff-type" ' + ckFlag2 + '>\
                                                <label> + </label>\
                                                </span>\
                                                </td>\
                                                <td>\
                                                <input type="text" class="form-control priceDiff-ipt input-sm" value="' + elem.value + '">\
                                                </td>\
                                            </tr>'

                }
                $('.priceDiff-box table tbody').html(priceDiffHtml);

                // 营销模块
                // vip折扣
                if (data.is_vipcard == 1) {
                    $('#yesvip').trigger('click');
                    $('input[name=agio]').val(data.agio);
                    $('input[name=big_agio').val(data.big_agio);
                }

                // 限期优惠 == 1开启 2是关闭
                if (data.is_timepay == 1) {
                    $('#qxyes').trigger('click');
                    //自定义昵称
                    if (data.is_custom_nicknames == 1) {
                        $('#custom_nicknames').prop('checked', true)
                        $('input[name=custom_nicknames]').val(data.custom_nicknames)
                    }
                    if (data.timepaystyle_json.bgcolor) {
                        navigitecolorset = data.timepaystyle_json;
                    }
                    $('#bgcolor').spectrum("set", navigitecolorset.bgcolor);
                    $('#fontcolor').spectrum("set", navigitecolorset.fontcolor);
                    $('#bgcolor1').spectrum("set", navigitecolorset.bgcolor1);
                    $('#fontcolor1').spectrum("set", navigitecolorset.fontcolor1);
                    $('#fontcolor2').spectrum("set", navigitecolorset.fontcolor2);

                    // 按时间段优惠
                    if (data.is_timepay_type == 0) {
                        $(`input[name=is_timepay_type][value=${data.is_timepay_type}]`).trigger('click');
                        if (data.ymoneys.length == 0) {
                            $('#breakTime').val(data.break_time);
                            $('#break_price').val(data.break_price);
                        } else {
                            var yhhtml = '';
                            for (var yy = 0, yylen = data.ymoneys.length; yy < yylen; yy++) {
                                yhhtml += `<div class="yhli">
                                                    <input type="text" class="datepicker datepicker5 form-control dataBox" id="breakTime` + yy + `" style="border-radius:2px;width:330px" name="break_time[]" value="` + data.ytimes[yy] + `"> 之间购买减 
                                                    <input class="form-control dataBox" style="width: 100px;" maxlength="10" type="text" name="break_price[]" value="` + data.ymoneys[yy] + `"> 元
                                                    <input class="form-control dataBox" name="break_ynicknames[]" placeholder="请输入昵称" style="width: 120px;" value="${data.ynicknames[yy] || ''}" />
                                                    <button type="button" class="btn btn-danger btn-xs deleteyhli">删除</button></div>`;
                            }
                            $('.yhlist').html(yhhtml);
                            for (var yy = 0, yylen = data.ymoneys.length; yy < yylen; yy++) {
                                laydate.render({
                                    elem: '#breakTime' + yy,
                                    trigger: 'click',
                                    type: 'datetime',
                                    range: '~'
                                });
                            }
                        }
                    } else {
                        $(`input[name=timepay_day]`).val(data.timepay_day);
                        $(`input[name=timepay_price]`).val(data.timepay_price);
                    }
                }

                if (data.is_check_age == 1) {
                    $('#is_check_age').prop('checked', true);
                    isCheckAge = 1;
                } else if (data.is_check_age == 2) {
                    $('#is_child_age').prop('checked', true);
                    isCheckAge = 2;
                } else {
                    $('#is_check_age').prop('checked', false);
                    isCheckAge = 0;
                }

                // 多人优惠
                $('input[name=is_hide_full]').prop('checked', data.is_hide_full == 1 ? true : false); // 小程序隐藏该优惠项
                if (data.is_fullCut >= 1) {
                    var fullCutHtml = '';

                    $(`input[name=is_fullCut][value="${data.is_fullCut}"]`).trigger('click');


                    for (var i = 0; i < data.fullCutInfo.length; i++) {
                        var ele = data.fullCutInfo[i];
                        fullCutHtml += `<div class="fullCutItem">
                                                    满 <input type ="text" value = "${ele.peopleNum}" class="form-control fullCatIpt peopleNum">&nbsp;人，
                                                    ${data.is_fullCut == 1 ? '每人减' : '总共减'}每人减 <input type ="text" class="form-control fullCatIpt fullCutPrice" value ="${ele.price}" >&nbsp;元
                                                    <button type="button" class="btn btn-danger btn-xs deleteFullCut ${data.fullCutInfo.length == 1 ? 'hide' : ''}" >删除</button >
                                                </div>`;
                    }
                    $('.fullCutInfo').html(fullCutHtml);
                }

                $('input[name="is_vip_level_hide"]').prop('checked', data.is_vip_level_hide == 1 ? true : false); // 会员等级优惠 -> 小程序隐藏该优惠项

                // 是否可用优惠券
                if (data.card_status == 2) {
                    $('#y-card_status').trigger('click');
                }

                // 是否可用储值卡
                if (data.is_moneycard == 2) {
                    $('#y-is_moneycard').trigger('click');
                }

                // 代客下单欢迎图
                if (data.is_dk_welcome == 1) {
                    $('#y-is_dk_welcome').trigger('click');
                    $('#dkWelomeimgsrc').attr('src', data.dk_welcome_img);
                    $('input[name=dk_welcome_img]').val(data.dk_welcome_img).next().removeClass('hidden');
                }

                // 为选中的radio加样式
                $('input[type="radio"]').each(function (index, item) {
                    if ($(item).prop('checked')) {
                        $(this).parents('.radio_box').addClass('r_on');
                    }
                });

                // 保存并上架 按钮
                if (data.status != 1) {
                    $('.save-up-btn').removeClass('hide');
                }

                //购买送券渲染
                if (data.is_givecard == 1) {
                    $(`input[name=is_givecard][value="${data.is_givecard}"]`).trigger('click');
                    var htmls = "";
                    for (var i = 0; i < data.give_card_ids.length; i++) {
                        htmls += `
                                    <tr>
                                        <td>${data.give_card_ids[i].name}</td>
                                        <td><input type="number" style="width: 90px;" min="1" value="${data.give_card_ids[i].number}" /></td>
                                        <td><a href="javascript:;" class="movecard" data-id="${data.give_card_ids[i].card_id}">移除</a></td>
                                    </tr>
                                `
                    }
                    $("#selbucard").append(htmls);
                    $(".checkednum").html(`已选择${data.give_card_ids.length}张`);
                    $('#cardlistchecked').removeClass('hide');
                }

                //亲子配置
                $(`input[name=parenting_config][value="${data.parenting_config}"]`).trigger('click');

                // vip折扣
                $(`input[name=vip_pay_type][value="${data.vip_pay_type}"]`).trigger('click');

                if (data.vip_pay_type == 1) {
                    $('input[name=vip_money]').val(data.vip_money);
                    $('input[name=big_vip_money]').val(data.big_vip_money);
                }
                if (data.vip_pay_type == 2) {
                    $('input[name=vip_reduce]').val(data.vip_reduce);
                    $('input[name=big_vip_reduce]').val(data.big_vip_reduce);
                }

                //多客服
                var khdhlist = data.khdhstr;
                if (khdhlist.length) {
                    var dkfhtml = `
                                            ${khdhlist.map((item, idx) => `<div class="input-group mb-10" style="position:relative">
                                            <input class="form-control" placeholder="客服姓名" type="text" name="khdhlistname[]" value="${item.khdhlistname}">
                                            <span class="input-group-addon">-</span>
                                            <input class="form-control" placeholder="客服电话" type="text" name="khdhliststr[]" value="${item.khdhliststr}">
                                            <span class="input-group-addon">
                                            <a href="javascript:;" class="additem glyphicon glyphicon-plus"></a>
                                            </span>
                                            ${idx != 0 ? `<span class="input-group-addon">
                                            <a href="javascript:;" class="removeitem text-danger glyphicon glyphicon-minus"></a>
                                            </span>` : ''}
                                            </div>
                                            `).join('')}`;
                    dkfhtml += ``;
                    $('#khdhlistbox').html(dkfhtml);
                }

                //满减优惠
                $(`input[name=mjyh_type][value=${data.mjyh_type}]`).trigger('click');

                if (data.mjyh_list.length) {
                    var mjyhHtml = ``
                    data.mjyh_list.forEach((item, idx) => {
                        mjyhHtml += `<p>满
                                                <input type="number" value="${item.mjyh_full ? item.mjyh_full : 0}" name="mjyh_full[]" class="form-control" style="width:100px;display: inline-block;">元减
                                                <input type="number" value="${item.mjyh_reduce ? item.mjyh_reduce : 0}" name="mjyh_reduce[]" class="form-control" style="width:100px;display: inline-block;">元
                                                <button type="button" class="btn btn-danger btn-xs" onclick="fnDelMjyh(this)">删除</button>
                                            </p>`;
                });
                    $('#mjyh_list').html(mjyhHtml);
                }

                // 虚拟币优惠项
                if (data.virtual_json.length) {
                    var mjyhHtml = ``
                    data.virtual_json.forEach((item, idx) => {
                        mjyhHtml += `<p class="fullCutItem1">
                                                满 <input type="number" value="${item.num ? item.num : 0}" class="form-control peopleNum1" style="width:100px;display: inline-block;">人，每人减<input type="number" value="${item.coin ? item.coin : 0}"  class="form-control fullCutPrice1" style="width:100px;display: inline-block;">个虚拟币
                                                <button type="button" class="btn btn-danger btn-xs" onclick="fnDeQedk(this)">删除</button>
                                            </p>`;
                });
                    $('#qedk_list').html(mjyhHtml);
                }

                // 标签提醒
                if (data.is_remind_tag == 1) {
                    $(`input[name="is_remind_tag"][value="${data.is_remind_tag}"]`).trigger('click');
                    remindText = data.remind_color || '';
                    $('#remindText').spectrum("set", remindText);
                    remindBg = data.remind_bg_color || '';
                    $('#remindBg').spectrum("set", remindBg || '#51d572');
                    $('input[name=remind_tit]').val(data.remind_tit)
                    $('input[name=remind_tit_size]').val(data.remind_tit_size || 30)
                    $('input[name=remind_subtit]').val(data.remind_subtit)
                    $('input[name=remind_subtit_size]').val(data.remind_subtit_size || 26)
                    $(`input[name=remind_tap][value="${data.remind_tap || 0}"]`).trigger('click');
                    $('#remind_text').val(data.remind_text)
                    $('input[name=remind_tap_path]').val(data.remind_tap_path)
                    $("#ImgRemind").attr("src", data.remind_icon)
                    $('input[name=remind_icon]').val(data.remind_icon)
                    $('#remind-font').removeClass('hidden')
                }

                // 营种分享文案
                $(`input[name=singlecshare_txtstatus][value=${data.singlecshare_txtstatus}]`).trigger('click');
                $(`input[name=singlecshare_imgstatus][value=${data.singlecshare_imgstatus}]`).trigger('click');
                if (data.singlecshare_txtstatus == 2) {
                    $('input[name=singlecshare_txt').val(data.singlecshare_txt);
                }

                // 营种分享图片
                if (data.singlecshare_imgstatus == 2) {
                    $("#cshareimgsrc").attr("src", data.singlecshare_img + '?imageView2/2/w/750');
                    $('input[name=singlecshare_img').val(data.singlecshare_img);
                }

                // $.each($('#textarea1 .w-e-text video'), function(index, val) {
                // 	$(this).after('&nbsp; ').before('&nbsp; ')
                // });

            }
        });
    }

    $('input[name="is_medal"]').on('click', function () {
        $('.medal_list')[$(this).val() == 1 ? 'removeClass' : 'addClass']('hide');
        $(this).val() == 1 && $('.medal_list').find("input").prop("checked", false)
    })
    $('input[name="share_type"]').on('click', function () {
        $('.fx-config')[$(this).val() == 2 ? 'removeClass' : 'addClass']('hide');
        $('#is_hyaline').parent()[$(this).val() == 2 ? 'removeClass' : 'addClass']('hide');
    })
    $('input[name="registed"]').on('change', function () {
        $('.sign-show')[$(this).val() == 1 ? 'removeClass' : 'addClass']('hide')
        // $(this).val() == 1 && $('input[name=btn-text]').val(data.sign_btn_text || '立即报名');
    })
    $('input[name="is_remind_tag"]').on('click', function () {
        $('.remind-show')[$(this).val() == 1 ? 'removeClass' : 'addClass']('hide');
    })
    $('input[name="remind_tap"]').on('click', function () {
        var idx = $(this).val()
        $('#remind_tap_form').find('div').eq(idx).removeClass('hide').siblings().addClass('hide')
    })

    // 价格信息
    function getSkuFnc(cid, pid, flag, is_break_sku) {
        $.ajax({
            url: '__APP__/Admin/Goods/courseGoodsSku',
            type: 'post',
            data: {
                pid: pid,
                cid: cid
            },
            dataType: 'json',
            success: function (data) {
                if (data.code != 0) {
                    layer.msg(data.msg);
                    return;
                }
                courseSkuPriceData = data.data;
                data = data.data;
                // 处理不同出营的价格表头th
                // data.product_type = 0
                if (data.product_type == 1) {
                    data.sku_first_title.pop();
                    data.sku_first_title.pop();
                    data.sku_first_title.push({
                        id: 0,
                        name: '儿童价格'
                    });
                    data.sku_first_title.push({
                        id: 0,
                        name: '成人价格'
                    });
                }

                if (data.is_sku == 1) {
                    var tmpSkuStr = '';
                    var tableHtml = '<table class="table table-bordered table-hover" id="process" border="1" cellpadding="1" cellspacing="0" style="width:100%;padding:5px;"><thead><tr>'
                    if (data.product_type == 1) {
                        for (var i = 0; i < data.sku_first_title.length; i++) {
                            if (i == data.sku_first_title.length - 1) {
                                tableHtml += '<th style="width: 100px;" class="sku-price c-sku-price" data-id="0">' + data.sku_first_title[i].name + '</th>'
                            } else if (i == data.sku_first_title.length - 2) {
                                tableHtml += '<th style="width: 100px;" class="sku-price p-sku-price" data-id="0">' + data.sku_first_title[i].name + '</th>'
                            } else {
                                tableHtml += '<th data-id="' + data.sku_first_title[i].id + '">' + data.sku_first_title[i].name + '</th>'
                            }
                        }
                    } else {
                        for (var i = 0; i < data.sku_first_title.length; i++) {
                            if (i == data.sku_first_title.length - 1) {
                            } else if (i == data.sku_first_title.length - 2) {
                                tableHtml += '<th style="width: 100px;" class="sku-price" data-id="' + data.sku_first_title[i].id + '">' + data.sku_first_title[i].name + '</th>'
                            } else {
                                tableHtml += '<th data-id="' + data.sku_first_title[i].id + '">' + data.sku_first_title[i].name + '</th>'
                            }
                        }
                    }
                    tableHtml += '</tr></thead><tbody>';
                    if (data.product_type == 1) {
                        var newArr = [];
                        // 生成新数组
                        data.big_sku_data_list.forEach(function (vv, ii) {
                            vv.splice(0, vv.length - 1)
                        })
                        data.sku_data_list.forEach(function (v, i) {
                            newArr.push([].concat(v.slice(0, v.length - 1), data.big_sku_data_list[i]));
                        });

                        for (var i = 0; i < newArr.length; i++) {
                            tableHtml += '<tr>';
                            for (var j = 0; j < newArr[i].length; j++) {
                                if (j == newArr[i].length - 1) {
                                    tableHtml += '<td class="skuPrice skuPariceIpt"><input class="l-text form-control  input-sm" value="' + newArr[i][j] + '"></td>'
                                } else if (j == newArr[i].length - 2) {
                                    tableHtml += '<td class="skuPariceIpt skuPariceIpt skuPariceIptC"><input class="l-text form-control input-sm" value="' + newArr[i][j] + '"></td>'
                                } else if (j == newArr[i].length - 3) {
                                    tableHtml += '<td>' + newArr[i][j] + '</td>';
                                    tmpSkuStr += newArr[i][j] + '--'
                                } else {
                                    tableHtml += '<td>' + newArr[i][j] + '</td>';
                                    tmpSkuStr += newArr[i][j] + ','
                                }
                            }
                            tableHtml += '</tr>'
                        }
                        console.log(newArr);

                    } else {
                        for (var i = 0; i < data.sku_data_list.length; i++) {
                            tableHtml += '<tr>';
                            for (var j = 0; j < data.sku_data_list[i].length; j++) {
                                if (j == data.sku_data_list[i].length - 1) {
                                } else if (j == data.sku_data_list[i].length - 2) {
                                    tableHtml += '<td class="skuPariceIpt skuPariceIpt"><input class="l-text form-control input-sm" value="' + data.sku_data_list[i][j] + '"></td>'
                                } else if (j == data.sku_data_list[i].length - 3) {
                                    tableHtml += '<td>' + data.sku_data_list[i][j] + '</td>';
                                    tmpSkuStr += data.sku_data_list[i][j] + '--'
                                } else {
                                    tableHtml += '<td>' + data.sku_data_list[i][j] + '</td>';
                                    tmpSkuStr += data.sku_data_list[i][j] + ','
                                }
                            }
                            tableHtml += '</tr>'
                        }
                    }

                    tableHtml += '</tbody></table>';
                    // 生成表格.
                    $(".createTablePrice").html(tableHtml);
                    var tmpSkuArr = tmpSkuStr.split('--');
                    var tmpSkuHtml = '';
                    for (var h = 0; h < tmpSkuArr.length - 1; h++) {
                        var ele = tmpSkuArr[h];
                        tmpSkuHtml += '<span class="sku-break-box-item"><input type="checkbox"> <span>' + ele + '</span></span>'
                    }
                    if (is_break_sku == 1) {
                        $('.sku-break-box').html(tmpSkuHtml);
                    }
                    if (flag == 1) {
                        $('.virtualprice').removeClass('hide');
                    }
                }
            }
        })

    }

    // 保存
    $('.save-btn').on('click', function () {
        checksubmit(0, 1, 0, isYanxue ? productUpdateStatus : 1);
    })
    // 保存并上架
    $('.save-up-btn1').on('click', function () {
        checksubmit(1, 0, 0, 0);
    })
    $('.save-up-btn2').on('click', function () {
        checksubmit(2, 0, 0, 0);
    })
    // 保存并预览
    $('.save-up-btn3').on('click', function () {
        checksubmit(3, 0, 0, 1);
    })

    // 卡券核销 判断自定义
    $(document).on('change', 'input[name=valid_start_type]', function () {
        var _this = $(this)

        _this.parent().addClass('r_on').parent().siblings('.input_box').find('.radio_box').removeClass('r_on');
        $('input[name=valid_end_type]').prop('checked', false);
        $('.yxqhide').css('display', 'none');

        if (_this.val() == 3) {
            $('#yxq-h').prop('disabled', false)
        } else {
            $('#yxq-h').prop('disabled', true).val('')
        }

        if (_this.is(':checked')) {
            _this.parent().parent('div').next('.yxqhide').css('display', 'block')
        }

        if (_this.val() == 4) {
            $('.datepicker_one').prop('disabled', false)
        } else {
            $('.datepicker_one').prop('disabled', true).val('')
        }
    })

    $(document).on('change', 'input[name=valid_end_type]', function () {
        var _this = $(this);

        $('.yxq-d').prop('disabled', true);
        _this.parents('.valid_end_type_wrap').siblings().find('.radio_box').removeClass('r_on');

        if (_this.val() == 2) {
            if (_this.parents('.yxqhide:visible')) {
                _this.parents('.radio_box').siblings('.yxq-d').prop('disabled', false);
            }
        } else {
            if (_this.parents('.yxqhide:visible')) {
                $('.yxq-d').prop('disabled', true).val('');
            }
        }
    });

    laydate.render({
        elem: '.kaquanhexiao-picker-1',
        type: 'date'
    });
    laydate.render({
        elem: '.kaquanhexiao-picker-2',
        type: 'date'
    });

    function checkNumber(num) {
        var reg = /^[0-9]+.?[0-9]*$/;
        if (reg.test(num)) {
            return true;
        }
        return false;
    }

    function checksubmit(flag, is_edit, sub_hide, no_update_status) {
        var isplatform = '{$platform_status}';

        // 不是研学产品才判断
        if (!isYanxue) {
            // 保存营长id
            console.log(optionMajor.getValue(), medalboxOption.getValue())
            $('input[name="majorId"]').val(optionMajor.getValue().toString());

            // 获取库存sku数据
            var sku = '';
            var big_sku = '';
            var limit_sku = '';
            if ($('#hasSpec').prop('checked')) {
                var skuArr = [],
                    skuArrBig = [],
                    skuArrLimit = [],
                    skuTitle = [];
                if ($('input[name="product_type"]:checked').val() == 0 || $('input[name="product_type"]:checked').val() == 2) {
                    $('.createTable:first thead').find('th').each(function (i, v) {
                        skuTitle.push($(v).data('id'));
                    })
                    $('.createTable tbody').each(function (i, v) {
                        var arr = [];
                        arr.unshift(skuTitle);
                        $(v).find('tr').each(function (index, value) {
                            var tmpArr = [];
                            $(value).find('td').each(function (ins, item) {
                                if ($(item).hasClass('skuStockIpt')) {
                                    var retStock = $(item).find('input').val() == '' ? 0 : $(item).find('input').val();
                                    tmpArr.push(retStock);
                                } else {
                                    tmpArr.push($(item).html());
                                }
                            })
                            arr.push(tmpArr);
                        })
                        skuArr.push(arr.join('#'));
                    })
                    sku = skuArr.join('--');
                } else {
                    $('.createTable:first thead').find('th').each(function (i, v) {
                        skuTitle.push($(v).data('id'));
                    })
                    skuTitle.pop();
                    $('.createTable tbody').each(function (i, v) {
                        var arr = [];
                        var arr1 = [];
                        var arr2 = [];
                        arr.unshift(skuTitle);
                        arr1.unshift(skuTitle);
                        arr2.unshift(skuTitle);
                        $(v).find('tr').each(function (index, value) {
                            var tmpArr = [];
                            var tmpArr1 = [];
                            var tmpArr2 = [];
                            $(value).find('td').each(function (ins, item) {
                                if ($(item).hasClass('skuStockIptChild')) {
                                    var retStock = $(item).find('input').val() == '' ? 0 : $(item).find('input').val();
                                    tmpArr.push($(item).find('span').text());
                                    tmpArr.push(retStock);
                                } else if ($(item).hasClass('skuStockIptbig')) {
                                    var retStock = $(item).find('input').val() == '' ? 0 : $(item).find('input').val();
                                    tmpArr1.push($(item).find('span').text());
                                    tmpArr1.push(retStock);
                                } else if ($(item).hasClass('skuStockIptLimit')) {
                                    var retStock = $(item).find('input').val() == '' ? 0 : $(item).find('input').val();
                                    tmpArr2.push($(item).find('span').text());
                                    tmpArr2.push(retStock);
                                } else {
                                    tmpArr.push($(item).html());
                                    tmpArr1.push($(item).html());
                                    tmpArr2.push($(item).html());
                                }
                            })
                            arr.push(tmpArr);
                            arr1.push(tmpArr1);
                            arr2.push(tmpArr2);
                        })
                        skuArr.push(arr.join('#'));
                        skuArrBig.push(arr1.join('#'));
                        skuArrLimit.push(arr2.join('#'));
                    })
                    sku = skuArr.join('--');
                    big_sku = skuArrBig.join('--');
                    limit_sku = skuArrLimit.join('--');
                }
            }
            var SKUObj = $('.skuSelect').find('option:selected');
            var SKUObjNUM = 0;
            SKUObj.each(function (i, v) {
                if ($(v).val() == '') {
                    SKUObjNUM++
                }
            })
            if ($('#hasSpec').prop('checked') && SKUObjNUM > 0) {
                layer.msg('请选择规格');
                return;
            }

            var inputTags = $('input.input-tags');
            var inputTagsNum = 0;
            inputTags.each(function (i, v) {
                if ($(v).val() == '') {
                    inputTagsNum++
                }
            })
            if ($('#hasSpec').prop('checked') && inputTagsNum > 0) {
                layer.msg('请添加规格');
                return;
            }

            var sendStockNum = 0;
            $('input[name="stock[]"]').each(function (i, v) {
                if ($(v).val() == 0) {
                    sendStockNum++
                }
            })

            // 价格sku
            var skuArr = [];
            var skuArrBig = [];
            var skuTitle = [];
            if ($('input[name="product_type"]:checked').val() == 0 || $('input[name="product_type"]:checked').val() == 2) {
                $('.createTablePrice tbody tr').each(function (i, v) {
                    console.log(i)
                    var tmpArr = [];
                    $(v).find('td').each(function (index, item) {
                        if ($(item).hasClass('skuPariceIpt')) {
                            var retPrice = $(item).find('input').val() == '' ? 0 : $(item).find('input').val();
                            tmpArr.push(retPrice);
                        } else {
                            tmpArr.push($(item).html());
                        }
                    })
                    skuArr.push(tmpArr);
                })
            } else {
                $('.createTablePrice tbody tr').each(function (i, v) {
                    console.log(i)
                    var tmpArr = [];
                    var tmpArr1 = [];
                    $(v).find('td').each(function (index, item) {
                        if ($(item).hasClass('skuPariceIpt')) {
                            var retPrice = $(item).find('input').val() == '' ? 0 : $(item).find('input').val();
                            if ($(item).hasClass('skuPariceIptC')) {
                                tmpArr.push(retPrice);
                            } else {
                                tmpArr1.push(retPrice);
                            }

                        } else {
                            tmpArr.push($(item).html());
                            tmpArr1.push($(item).html());
                        }
                    })
                    skuArr.push(tmpArr);
                    skuArrBig.push(tmpArr1);
                })
            }

            $('.createTablePrice thead th').each(function (i, v) {
                skuTitle.push($(v).data('id'));
            })
            if ($('input[name="product_type"]:checked').val() == 1) {
                skuTitle.pop();
            }
            skuArr.unshift(skuTitle);
            skuArrBig.unshift(skuTitle);

            // 多人满减数据
            var fullCutArr = [];
            var fullCutInfoArr = [];

            $('.fullCutItem').each(function (i, v) {
                fullCutArr.push($(v).find('.peopleNum').val());
                var tmpObj = {};
                tmpObj.peopleNum = $(v).find('.peopleNum').val();
                tmpObj.price = $(v).find('.fullCutPrice').val();
                fullCutInfoArr.push(tmpObj);
            })
            var fullCutNewArr = [];
            for (var i = 0; i < fullCutArr.length; i++) {
                var allFlag = true;
                for (var j = 0; j < fullCutNewArr.length; j++) {
                    if (fullCutArr[i] == fullCutNewArr[j]) {
                        allFlag = false;
                    }
                }
                if (allFlag) {
                    fullCutNewArr.push(fullCutArr[i]);
                }
            }
            if (fullCutNewArr.length != fullCutArr.length) {
                layer.msg('请勿填写相同人数的满减');
                return;
            }
            var fullCutPriceNum = 0
            $('.fullCutPrice').each(function (i, v) {
                var ret = /^[0-9]+([.]{1}[0-9]+){0,1}$/.test($(v).val());
                if ($(v).val() == '' || !ret) {
                    fullCutPriceNum++;
                }
            })
            if ($('#fullCut').prop('checked') && fullCutPriceNum != 0) {
                layer.msg('请输入正确的多人满减金额');
                return
            }
            if ($('#fullCut2').prop('checked') && fullCutPriceNum != 0) {
                layer.msg('请输入正确的多人满减金额');
                return
            }

            // 排序
            var sortName = "peopleNum";

            fullCutInfoArr.sort(sortFn(sortName));

            var fullCutInfo = JSON.stringify(fullCutInfoArr);

            // 虚拟币满减数据
            fullCutArr = [];
            fullCutInfoArr = [];

            $('.fullCutItem1').each(function (i, v) {
                fullCutArr.push($(v).find('.peopleNum1').val());
                var tmpObj = {};
                tmpObj.num = $(v).find('.peopleNum1').val();
                tmpObj.coin = $(v).find('.fullCutPrice1').val();
                fullCutInfoArr.push(tmpObj);
            })
            fullCutNewArr = Array.from(new Set(fullCutArr));
            if (fullCutNewArr.length != fullCutArr.length) {
                layer.msg('请勿填写相同人数的满减');
                return;
            }
            fullCutPriceNum = 0
            $('.fullCutPrice1').each(function (i, v) {
                var ret = /^[0-9]+([.]{1}[0-9]+){0,1}$/.test($(v).val());
                if ($(v).val() == '' || !ret) {
                    fullCutPriceNum++;
                } else {
                    if ($("input[name='coin_1']").val() < $(v).val()) {
                        fullCutPriceNum++
                    }
                }
            })
            if ($('#allDeduct').prop('checked') && fullCutPriceNum != 0) {
                layer.msg('请输入正确的满减虚拟币');
                return
            }

            // 排序
            fullCutInfoArr.sort(sortFn('num'));

            var fullCutInfo1 = JSON.stringify(fullCutInfoArr);



        }

        // 验证
        if ($(".base-info input[name='cName']").val() == '') {
            layer.msg('请填写营种名称');
            return false;
        }

        if (!isplatform && $('#text1').val() == '') {
            layer.msg('请填写营种期次');
            return false;
        }

        if (!isplatform && $('#text2').val() == '') {
            layer.msg('请填写报名截止时间');
            return false;
        }

        var cover_pic = $('#uploadimg6').val();
        if (cover_pic == '' && $('#ImgPr6').attr('src') == 'https://file.dev.xinduobang.cn/images/chrome-ext/1615368309226876.jpeg') {
            layer.msg('请上传封面图片');
            return false;
        }

        // 不是研学产品才判断
        if (!isYanxue) {
            var reg = /^[+]{0,1}(\d+)$|^[+]{0,1}(\d+\.\d+)$/
            if ($('#yesvip').is(':checked') && $('#vipPrice').val() == '' && !$('#vipPrice').prop('disabled')) {
                layer.msg('请添加VIP折扣');
                return false;
            }

            // 营期差价
            if ($('#priceDiff').prop('checked')) {
                var priceDiffArr = [];
                var priceDiffNum = 0;
                $('.priceDiff-con tbody tr').each(function (i, v) {
                    var obj = {};
                    if ($(v).find('.priceDiff-type:checked')) {
                        obj.type = $(v).find('.priceDiff-type:checked').val();
                    }
                    if ($(v).find('.priceDiff-ipt').val() == '' || !/^[0-9]+([.]{1}[0-9]+){0,1}$/.test($(v).find('.priceDiff-ipt').val())) {
                        priceDiffNum++
                    } else {
                        obj.value = $(v).find('.priceDiff-ipt').val();
                    }
                    priceDiffArr.push(obj);
                })
            }
            if (priceDiffNum > 0) {
                layer.msg('请输入正确差价金额');
                return
            }

            // 简版行程 研学
            if ($('input[name=days]').val() == '') {
                $('input[name=days]').val(0);
            }
            if ($('input[name=night]').val() == '') {
                $('input[name=night]').val(0);
            }

            // 虚拟币 研学
            if ($('#yesvirtual').prop('checked') && $('#partDeduct').prop('checked') && $('inputp[name="coin"]').val() == '') {
                layer.msg('请填写购买虚拟币折扣');
                return false;
            }
            if ($('#yesvirtual').prop('checked') && $('#partDeduct').prop('checked') && !(/^[1-9]+\d*$/.test($('input[name="coin"]').val()))) {
                layer.msg('请填写正确的购买虚拟币折扣');
                return false;
            }

            if ($('#yesvirtual').prop('checked') && $('#allDeduct').prop('checked') && $('inputp[name="coin_1"]').val() == '') {
                layer.msg('请填写购买虚拟币折扣');
                return false;
            }
            if ($('#yesvirtual').prop('checked') && $('#allDeduct').prop('checked') && !(/^[1-9]+\d*$/.test($('input[name="coin_1"]').val()))) {
                layer.msg('请填写正确的购买虚拟币折扣');
                return false;
            }

            // 限购 研学
            var limits = $('input[name=limits]').val()
            var limits_perio_child = $('input[name=limits_perio_child]').val()
            var limits_perio_parent = $('input[name=limits_perio_parent]').val()
            if ($('input[name=product_type]:checked').val() != 1 && $('input[name=limits]').is(':visible')) {
                if (!checkNumber(limits) || limits == '') {
                    layer.msg('请正确填写限购条件（不能为空，必须是数字）')
                    return false
                }
            }
            if ($('input[name=product_type]:checked').val() == 1 && $('#xiangou_box_qinzi').is(':visible')) {
                if ((!checkNumber(limits_perio_parent) || limits_perio_parent == '') || (!checkNumber(limits_perio_child) || limits_perio_child == '')) {
                    layer.msg('请正确填写限购条件（不能为空，必须是数字）')
                    return false
                }
            }

            // sku 限期优惠  研学
            var is_break_sku = 1;
            var sku_break_list = [];
            if ($('#qxyes').prop('checked')) {
                //              自定义昵称
                if ($('#custom_nicknames').prop('checked')) {
                    if ($('input[name=custom_nicknames]').val() == '') {
                        layer.msg('请填写自定义昵称');
                        return
                    }
                }

                if ($('.sku-break-box-all input').prop('checked')) {
                    is_break_sku = 1;
                    sku_break_list = [];
                } else {
                    is_break_sku = 0;
                    var sku_break_list_num = 0;
                    var sku_break_list_num1 = 0;
                    $('.sku-break-box-item').each(function (i, v) {
                        var obj = {}
                        obj.name = $(v).find('span').html();
                        if ($(v).find('input').prop('checked')) {
                            obj.is_select = 1;
                            sku_break_list_num1++
                        } else {
                            obj.is_select = 0;
                            sku_break_list_num++
                        }
                        sku_break_list.push(obj);
                    })

                    if (sku_break_list_num1 == $('.sku-break-box-item').length) {
                        is_break_sku = 1;
                    }
                    if (sku_break_list_num == $('.sku-break-box-item').length) {
                        layer.msg('请选择适用限期优惠的规格');
                        return
                    }
                }
            }

            // vip折扣  研学
            if ($('#yesvip').is(':checked')) {
                if (!$('input[name=vip_money]').prop('disabled') && $('input[name=vip_money]').val() == '') {
                    layer.msg('请填写VIP固定金额')
                    return
                } else if (!$('input[name=agio]').prop('disabled') && $('input[name=agio]').val() == '') {
                    layer.msg('请填写VIP指定折扣')
                    return
                } else if (!$('input[name=vip_reduce]').prop('disabled') && $('input[name=vip_reduce]').val() == '') {
                    layer.msg('请填写VIP立减金额')
                    return
                }
            }

            // 卡券核销 研学
            if ($('#card_status2').prop('checked')) {
                if ($('.hx_num_box input').val() == '') {
                    layer.msg('请输入可核销次数');
                    return
                }
                if (!/^[1-9]\d*$/.test($('.hx_num_box input').val())) {
                    layer.msg('请输入正确可核销次数');
                    return
                }
            }

            // 卡券核销 判断自定义 研学
            var valid_start_type = $('input[name=valid_start_type]:visible')
            var valid_end_type = $('input[name=valid_end_type]:visible')
            var valid_limit_end_day = $('input[name=valid_limit_end_day]:visible')
            var valid_limit_start_date = $('input[name=valid_limit_start_date]')
            var valid_limit_end_date = $('input[name=valid_limit_end_date]')
            var yxqh = $('#yxq-h')
            var reg = /^[1-9]\d*$/;

            if ($('#yxqbox').is(':visible')) {
                if ($("#hx_isValid").prop("checked")) {
                    form.append("sku", sku);
                    form.append("big_sku", big_sku);
                    form.append("limit_sku", limit_sku);
                    form.append("give_card_ids", JSON.stringify(give_card_ids));
                    form.append("skus", skuArr.join('#'));
                    form.append("big_skus", skuArrBig.join('#'));
                    form.append("fullCutInfo", fullCutInfo);
                    form.append("virtual_json", fullCutInfo1);
                    form.append("price_diff", JSON.stringify(priceDiffArr) || '');
                    form.append("limits", limits);
                    form.append("is_limit", $('input[name=is_limit]:checked').val());
                    form.append("is_break_sku", is_break_sku);
                    form.append("sku_break_list", JSON.stringify(sku_break_list));
                    form.append("onlyinvented", $('#onlyinvented').is(':checked') ? 1 : 0);
                    form.append("is_hide_full", $('input[name=is_hide_full]').prop('checked') ? 1 : 0);
                    form.append('cTitle', cTitle);
                    form.append('yearcard_list', yearcard);
                    form.append('notice', editorNotice.txt.html());
                    form.set('is_vip_level_hide', $('input[name="is_vip_level_hide"]').prop('checked') ? 1 : 0 ); // 会员等级优惠 -> 小程序隐藏该优惠项
                    form.set('is_must_year', $('#isYearCardUserUse').prop('checked') ? 1 : 0); // 年卡优惠 -> 年卡用户专享
                    form.set('is_over_give_coin', $('[name=is_over_give_coin]').prop('checked') ? 1 : 0); // 购买送币 -> 结营后赠送虚拟币
                    form.set('is_hide_vip_price', $('input[name="is_hide_vip_price"]').prop('checked') ? 1 : 0 ); // vip折扣 -> 小程序隐藏该优惠项
                    

                    //限期优惠颜色  研学
                    if ($('#qxyes').prop('checked')) {
                        form.append('timepaystyle_json', JSON.stringify(navigitecolorset));
                    }
                    // form.append("is_total",$('.istotal').prop('checked')?1:0)

                    // vip折扣 不与其他优惠同享
                    form.append("vip_type", $('#open-vip-type').prop('checked') ? 1 : 0);

                    // vip折扣 vip专享
                    form.append("is_only_vip", $('#is_only_vip').prop('checked') ? 1 : 0);

                    // 会员等级优惠 研学
                    var vip_level_json = [];
                    var vip_level_num = 0;
                    if ($('#y-level-free').prop('checked')) {
                        $('.level-free-item').each(function (i, v) {
                            // vip_level_obj
                            if ($(v).find('.level-free-ck').prop('checked')) {
                                var vip_level_obj = {};
                                vip_level_obj.id = $(v).find('.level-free-ck').data('id');
                                vip_level_obj.level = $(v).find('.level-free-ck').data('level');
                                vip_level_obj.name = $(v).find('.level-free-ck').data('name');
                                vip_level_obj.price = $(v).find('.level-free-price').val();
                                if ($(v).find('.level-free-price').val() == '') {
                                    vip_level_num++;
                                }
                                if (!/^[0-9]+([.]{1}[0-9]+){0,1}$/.test($(v).find('.level-free-price').val() - 0)) {
                                    vip_level_num++;
                                }
                                vip_level_json.push(vip_level_obj)
                            }
                        })
                        if (vip_level_num > 0) {
                            layer.msg('请输入正确会员等级优惠金额');
                            return
                        }
                        if ($('.level-free-item .level-free-ck:checked').length == 0) {
                            layer.msg('请选择并输入会员等级优惠金额');
                            return
                        }
                        form.append("vip_level_json", JSON.stringify(vip_level_json));
                    } else if ($('#ydis-level-free').prop('checked')) {
                        $('.level-free-itemdis').each(function (i, v) {
                            // vip_level_obj
                            if ($(v).find('.level-free-ck').prop('checked')) {
                                var vip_level_obj = {};
                                vip_level_obj.id = $(v).find('.level-free-ck').data('id');
                                vip_level_obj.level = $(v).find('.level-free-ck').data('level');
                                vip_level_obj.name = $(v).find('.level-free-ck').data('name');
                                vip_level_obj.price = $(v).find('.level-free-price').val();
                                if ($(v).find('.level-free-price').val() == '') {
                                    vip_level_num++;
                                }
                                if (!/^[0-9]+([.]{1}[0-9]+){0,1}$/.test($(v).find('.level-free-price').val() - 0)) {
                                    vip_level_num++;
                                }
                                vip_level_json.push(vip_level_obj)
                            }
                        })
                        if (vip_level_num > 0) {
                            layer.msg('请输入正确会员等级优惠折扣');
                            return
                        }
                        if ($('.level-free-itemdis .level-free-ck:checked').length == 0) {
                            layer.msg('请选择并输入会员等级优惠折扣');
                            return
                        }
                        form.append("vip_level_json", JSON.stringify(vip_level_json));
                    }

                    if (!valid_start_type.is(':checked')) {
                        layer.msg('请选择有效期');
                        return
                    }
                    if ($('input[name=valid_start_type]:checked').val() != 4) {
                        if (!valid_end_type.is(':checked')) {
                            layer.msg('请选择生效时间');
                            return
                        }
                        if (!valid_limit_end_day.is(':disabled') && valid_limit_end_day.val() == '') {
                            layer.msg('生效时间不能为空');
                            return
                        }
                        if (!reg.test(valid_limit_end_day.val()) && !valid_limit_end_day.is(':disabled')) {
                            layer.msg('生效时间请填写正整数');
                            return
                        }
                    }
                    if (valid_limit_start_date.val() == '' && !valid_limit_start_date.is(':disabled')) {
                        layer.msg('请选择日期');
                        valid_limit_start_date.focus()
                        return
                    }
                    if (valid_limit_end_date.val() == '' && !valid_limit_end_date.is(':disabled')) {
                        layer.msg('请选择日期');
                        valid_limit_end_date.focus()
                        return
                    }
                    if (yxqh.val() == '' && !yxqh.is(':disabled')) {
                        layer.msg('有效期时间不能为空');
                        yxqh.focus()
                        return
                    }
                    if (!reg.test(yxqh.val()) && !yxqh.is(':disabled')) {
                        layer.msg('有效期请填写正整数');
                        yxqh.focus()
                        return
                    }
                }

            }

        }

        // tag标签
        $('input[name="tagname"]').val(postTagArr);

        // 判断报名时限            
        if ($('#edit_status_two').is(':checked')) {
            if ($('input[name=edit_form_day]').val() == '') {
                layer.msg('请填写报名表修改时限');
                return
            }
            if ($('input[name=edit_form_day]').val() <= 0) {
                layer.msg('请填写正确的报名表修改时限');
                return
            }
        }

        // 判断提醒公告
        if ($('#on_notice').is(':checked')) {
            if ($('input[name=notice_content ]').val() == '') {
                layer.msg('请填写公告内容');
                return
            }
            if ($('input[name=notice_content ]').val().length > 100) {
                layer.msg('公告内容100字以内');
                return
            }
        }

        // 判断报名成功广告
        if ($('#ad_notice').is(':checked')) {
            var ad_file = $('#uploadimgad').val();
            if (ad_file == '' && $('#ImgPrad').attr('src') == 'https://file.dev.xinduobang.cn/images/chrome-ext/1615368309226876.jpeg') {
                layer.msg('请上传广告图片');
                return false;
            }
        }

        // 统一定价
        if ((parseInt($(".noSpec-box-price input").val()) + '') === 'NaN' && $('#noSpec').prop('checked')) {
            layer.msg('销售价格格式不正确');
            return false;
        }

        var index = null;
        var form = new FormData($("#myform")[0]);
        console.log("---------------------")
        console.log(form)
        console.log("---------------------")

        form.append("photo1", $('.infoImgs .imgUrl').eq(0).val() || '');
        form.append("photo2", $('.infoImgs .imgUrl').eq(1).val() || '');
        form.append("photo3", $('.infoImgs .imgUrl').eq(2).val() || '');
        form.append("photo4", $('.infoImgs .imgUrl').eq(3).val() || '');
        form.append("photo5", $('.infoImgs .imgUrl').eq(4).val() || '');

        // 报名合同
        var numSelect = $('#contractBox select').length;
        for (var i = 0; i < numSelect; i++) {
            form.append("contract_id[]", $('#contractBox select').eq(i).val() || '');
        }

        // 获得营员积分
        let isGainIntegral = $('input[name=is_gain_integral]:checked').val()
        let gainIntegralNum = $('#gain-integral-num').val()
        form.set('is_gain_integral', isGainIntegral);

        if (isGainIntegral == 1) {
            form.set('gain_integral_num', gainIntegralNum);
        }
        if (isGainIntegral == 1 && gainIntegralNum == '') {
            layer.msg(`请输入奖励${integralName}数`);
            return false;
        } else if (isGainIntegral == 1 && gainIntegralNum < 0) {
            layer.msg(`输入的奖励${integralName}数, 无效`);
            return false;
        }

        // 不是研学产品才判断
        if (!isYanxue) {
            //判断 虚拟币抵扣  研学
            if ($('#yesvirtual').is(':checked') && $('#allDeduct').is(':checked')) {
                form.append("is_virtual", "2");
            }

            // 购买送券保存数据  研学
            var give_card_ids = []
            if ($("input[name=is_givecard]:checked").val() == 1) {
                for (var i = 0; i < $("#selbucard tr").length; i++) {
                    var obj = {}
                    var card_id = $($("#selbucard tr")[i]).find(".movecard").data("id")
                    var nums = $($("#selbucard tr")[i]).find("input[type=number]").val()
                    if (nums == "") {
                        layer.msg('请填写购买送券数量');
                        return
                    }
                    if (!reg.test(nums)) {
                        layer.msg('购买送券需为整数');
                        return
                    }

                    obj.card_id = card_id
                    obj.number = nums
                    give_card_ids.push(obj)
                }

            }

            form.append("sku", sku);
            form.append("big_sku", big_sku);
            form.append("limit_sku", limit_sku);
            form.append("give_card_ids", JSON.stringify(give_card_ids));
            form.append("skus", skuArr.join('#'));
            form.append("big_skus", skuArrBig.join('#'));
            form.append("fullCutInfo", fullCutInfo);
            form.append("virtual_json", fullCutInfo1);
            form.append("price_diff", JSON.stringify(priceDiffArr) || '');
            form.append("limits", limits);
            form.append("is_limit", $('input[name=is_limit]:checked').val());
            form.append("is_break_sku", is_break_sku);
            form.append("sku_break_list", JSON.stringify(sku_break_list));
            form.append("onlyinvented", $('#onlyinvented').is(':checked') ? 1 : 0);
            form.append("is_hide_full", $('input[name=is_hide_full]').prop('checked') ? 1 : 0);
            form.append('cTitle', cTitle);
            form.append('yearcard_list', yearcard);
            form.append('notice', editorNotice.txt.html());
            form.set('is_vip_level_hide', $('input[name="is_vip_level_hide"]').prop('checked') ? 1 : 0); // 会员等级优惠 -> 小程序隐藏该优惠项
            form.set('is_must_year', $('#isYearCardUserUse').prop('checked') ? 1 : 0); // 年卡优惠 -> 年卡用户专享
            form.set('is_over_give_coin', $('[name=is_over_give_coin]').prop('checked') ? 1 : 0); // 购买送币 -> 结营后赠送虚拟币

            //限期优惠颜色  研学
            if ($('#qxyes').prop('checked')) {
                form.append('timepaystyle_json', JSON.stringify(navigitecolorset));
            }
            // form.append("is_total",$('.istotal').prop('checked')?1:0)

            // vip折扣 不与其他优惠同享
            form.append("vip_type", $('#open-vip-type').prop('checked') ? 1 : 0);

            // vip折扣 vip专享
            form.append("is_only_vip", $('#is_only_vip').prop('checked') ? 1 : 0);

            // 会员等级优惠 研学
            var vip_level_json = [];
            var vip_level_num = 0;
            if ($('#y-level-free').prop('checked')) {
                $('.level-free-item').each(function (i, v) {
                    // vip_level_obj
                    if ($(v).find('.level-free-ck').prop('checked')) {
                        var vip_level_obj = {};
                        vip_level_obj.id = $(v).find('.level-free-ck').data('id');
                        vip_level_obj.level = $(v).find('.level-free-ck').data('level');
                        vip_level_obj.name = $(v).find('.level-free-ck').data('name');
                        vip_level_obj.price = $(v).find('.level-free-price').val();
                        if ($(v).find('.level-free-price').val() == '') {
                            vip_level_num++;
                        }
                        if (!/^[0-9]+([.]{1}[0-9]+){0,1}$/.test($(v).find('.level-free-price').val() - 0)) {
                            vip_level_num++;
                        }
                        vip_level_json.push(vip_level_obj)
                    }
                })
                if (vip_level_num > 0) {
                    layer.msg('请输入正确会员等级优惠金额');
                    return
                }
                if ($('.level-free-item .level-free-ck:checked').length == 0) {
                    layer.msg('请选择并输入会员等级优惠金额');
                    return
                }
                form.append("vip_level_json", JSON.stringify(vip_level_json));
            } else if ($('#ydis-level-free').prop('checked')) {
                $('.level-free-itemdis').each(function (i, v) {
                    // vip_level_obj
                    if ($(v).find('.level-free-ck').prop('checked')) {
                        var vip_level_obj = {};
                        vip_level_obj.id = $(v).find('.level-free-ck').data('id');
                        vip_level_obj.level = $(v).find('.level-free-ck').data('level');
                        vip_level_obj.name = $(v).find('.level-free-ck').data('name');
                        vip_level_obj.price = $(v).find('.level-free-price').val();
                        if ($(v).find('.level-free-price').val() == '') {
                            vip_level_num++;
                        }
                        if (!/^[0-9]+([.]{1}[0-9]+){0,1}$/.test($(v).find('.level-free-price').val() - 0)) {
                            vip_level_num++;
                        }
                        vip_level_json.push(vip_level_obj)
                    }
                })
                if (vip_level_num > 0) {
                    layer.msg('请输入正确会员等级优惠折扣');
                    return
                }
                if ($('.level-free-itemdis .level-free-ck:checked').length == 0) {
                    layer.msg('请选择并输入会员等级优惠折扣');
                    return
                }
                form.append("vip_level_json", JSON.stringify(vip_level_json));
            }

            // 购买送币 研学
            var is_give_coin = 0;
            var give_coin = 0
            if ($('input[name="is_give_coin"]:checked').val() == 0) {
                is_give_coin = 0
            } else {
                is_give_coin = $('input[name="is_give_coin_type"]:checked').val();
            }

            if (is_give_coin == 1) {
                if ($('input[name="give_coin_type1"]').val() == '') {
                    layer.msg('请输入购买送币数量');
                    return
                }
                if (!/^[0-9]+([.]{1}[0-9]+){0,1}$/.test($('input[name="give_coin_type1"]').val())) {
                    layer.msg('请输入正确购买送币数量');
                    return
                }
                give_coin = $('input[name="give_coin_type1"]').val();
            }
            if (is_give_coin == 2) {
                if ($('input[name="give_coin_type2"]').val() == '') {
                    layer.msg('请输入购买送币数量');
                    return
                }
                give_coin = $('input[name="give_coin_type2"]').val();
            }
            form.append("is_give_coin", is_give_coin);
            form.append("give_coin", give_coin);

            // 大转盘
            form.delete('lotternum'); // 删除lotternum 有2个
            form.set('lotternum', $(`input[name="lotternum"]:eq(${form.get('give_lottery_type')})`).val()); // 根据赠送类别赋值数量(lotternum)
            form.set('give_lottery_only_child', $('#give_lottery_only_child').prop('checked') ? 1 : 0); // 亲子营 大转盘 每购买1个营位赠送多少次 是否仅限儿童

            //销量自定义数量 研学
            if ($('#yis_show_salenum').prop('checked') && $('#yis_show_realmoney').prop('checked')) {
                form.append("is_show_salenum", 5);
            }

            if ($('#yis_show_period').prop('checked')) {
                form.append("is_show_period", 1);
            } else {
                form.append("is_show_period", 0);
            }
            if ($('#yis_show_maxnum').prop('checked')) {
                form.append("is_show_maxnum", 1);
            } else {
                form.append("is_show_maxnum", 0);
            }

            if ($('#yis_show_salenum').prop('checked')) {
                form.set('show_salenum', $('#initialSaleNum').val() || 0);
            }

            // 老营员优惠 研学
            if ($('#y_old_free').prop('checked') && $('input[name="old_money"]').val() == '') {
                layer.msg('请输入老营员优惠');
                return
            }
            if ($('#y_old_free').prop('checked') && $('input[name="old_money"]').val() < 0) {
                layer.msg('请输入正确老营员优惠');
                return
            }

            // 亲子优惠字段 研学
            if ($('#y_parent_free').prop('checked') && !$('#y_n_product_type').prop('checked')) {
                layer.msg('亲子优惠仅支持亲子营');
                return
            }
            var qz_json = {};
            if ($('#y_parent_free').prop('checked')) {
                if ($('input[name="parent_num1"]').val() == '' || $('input[name="parent_num2"]').val() == '' || $('input[name="parent_price"]').val() == '') {
                    layer.msg('请输入完整的亲子优惠');
                    return
                }
                if ($('input[name="parent_num1"]').val() <= 0 || $('input[name="parent_num2"]').val() <= 0 || $('input[name="parent_price"]').val() <= 0) {
                    layer.msg('请输入正确的亲子优惠');
                    return
                }
                qz_json.big_num = $('input[name="parent_num1"]').val();
                qz_json.small_num = $('input[name="parent_num2"]').val();
                qz_json.money = $('input[name="parent_price"]').val();
                qz_json.qz_show_status = $('#qz_show_status').val();
                form.append("qz_json", JSON.stringify(qz_json));
            }

            if ($('#y_is_start').prop('checked')) {
                if ($('input[name="start_small_num"]').val() == '') {
                    layer.msg('请输入儿童起售数量');
                    return
                }
                if ($('#y_n_product_type').prop('checked') && $('input[name="start_big_num"]').val() == '') {
                    layer.msg('请输入大人起售数量');
                    return
                }
            }

            if ($('#y_is_bed').prop('checked') && !$('#y_n_product_type').prop('checked')) {
                layer.msg('儿童拼床仅支持亲子营');
                return
            }

            // 儿童拼床 研学
            if ($('#y_is_bed').prop('checked')) {
                if ($('input[name="is_bed_num"]').val() == '' || $('input[name="is_bed_price"]').val() == '') {
                    layer.msg('请输入完整的儿童拼床配置');
                    return
                }
                if ($('input[name="is_bed_num"]').val() <= 0 || $('input[name="is_bed_price"]').val() <= 0) {
                    layer.msg('请输入正确的儿童拼床配置');
                    return
                }
                qz_json.is_bed_num = $('input[name="is_bed_num"]').val();
                qz_json.is_bed_price = $('input[name="is_bed_price"]').val();
                form.append("qz_json", JSON.stringify(qz_json));
            }

            // 集合地点选择 研学
            form.append("is_sms_gather", $('#gather_typenext').prop('checked') && $('#openGather').prop('checked') && $("#is_sms_gather input").prop('checked') ? 1 : 0);
            form.append("e_is_sms_gather", $('#e_gather_typenext').prop('checked') && $('#e_openGather').prop('checked') && $("#e_is_sms_gather input").prop('checked') ? 1 : 0);

            // 卡券核销 自定义有效期是否选中 研学
            form.set("hx_is_defined", $("#hx_isValid").prop("checked") ? 1 : 0);

            // 自定义昵称 研学
            form.append("is_custom_nicknames", $("#custom_nicknames").prop("checked") ? 1 : 0);

            // 规格 研学
            var is_total = []
            var totalnum = []
            $('.is_total').each(function (i, v) {
                is_total.push($(this).find('.istotal').prop("checked") ? 1 : 0)
            })
            $('.is_total .totalnum').each(function (i, v) {
                totalnum.push($(this).val())
            })
            form.append("is_total", is_total);
            form.append("totalnum", totalnum);

            // 小组  研学
            if ($('input[name="product_type"]:checked').val() == 2) {
                if ($('input[name="group_num"]').val() == '') {
                    layer.msg('请输入每个小组人数');
                    return
                }
                if ($('input[name="is_pre_order"]:checked').val() == 1) {
                    layer.msg('小组营种不支持预定');
                    return
                }
                if ($('input[name="add_status"]:checked').val() == 1) {
                    layer.msg('小组营种不支持下单时填写报名表');
                    return
                }
            }

            // 判断亲子差价 研学
            if ($('input[name=product_type]:checked').val() == 1 && $('input[name=qz_gap]:checked').val() == 1) {
                if ($('input[name=c_gap_price]').val() == '' && $('input[name=p_gap_price]').val() == '') {
                    layer.msg('请填写亲子差价')
                    return
                }
            }
            if ($('input[name=product_type]:checked').val() != 1 && $('input[name=qz_gap]:checked').val() == 1) {
                layer.msg('亲子差价仅支持亲子营')
                return
            }


            form.append("product_type", $('input[name=product_type]:checked').val()); // 出营类型 研学
            form.append('is_course_list', $('#is_course_list').prop('checked') ? 1 : 0); // 花呗分期 小程序营种列表显示“支持分期”字样 研学
            form.append('is_course_details', $('#is_course_details').prop('checked') ? 1 : 0); // 花呗分期 小程序营种详情显示“支持分期”字样 研学
            form.set('is_check_age', isCheckAge); // 适宜年龄 限制营员年龄必须在此年龄段  研学

            // 勋章
            if ($('input[name=is_medal]:checked').val() == 1) {
                if (medalboxOption.getValue().length == 0) {
                    layer.msg('请选择勋章')
                    return
                }
                form.append('medal_list_json', JSON.stringify(medalboxOption.getValue()));
            }


        }

        // 添加退款模板
        var tkmbRid = $('#contract_tkmb').val()
        form.append("sale_refund_status", $('#zztkmx').prop('checked') === true ? 1 : 0)
        form.append("rid", tkmbRid);
        form.append("save", "save");
        form.append("pid", pid || '');
        form.append("cid", cid || '');
        form.append('ad_file', $('#ImgPrad').attr('src'))
        form.append('info', editorFeature.txt.html())
        // 添加退款模板end

        // 增值服务
        if ($('input[name=is_take]:checked').val() == 1) {
            let flag = false;
            var arr = []
            for (var i = 0; i < $('.types').length; i++) {
                if ($('.types')[i].value == 0 || !$('.typesname')[i].value) {
                    // layer.msg('增值服务分类不能为空');
                    flag = true;
                }
                arr.push({ type_id: $('.types')[i].value, other_name: $('.typesname')[i].value })
            }
            form.append('take_json', JSON.stringify(arr));
            if (flag && isYanxue) return false;
        }

        // form.append("is_virtual", $('.virtual-checkbox').prop('checked')? '1': '0');

        if (flag == 1) {
            form.append("status", 1);
        } else if (flag == 2) {
            form.append("status", 2);
        }

        form.append("is_on", is_edit == 1 ? is_on : 1);

        form.append("no_update_status", no_update_status);



        // 显示价格 
        if ($('input[name="price_show_type"]:checked').val() == 1 && !$('input[name="show_price"]').val()) {
            layer.msg('请输入想要显示的价格内容');
            return
        }

        // 判断是否写了营期
        for (var i = 0; i < $("#period-con .period-item").length; i++) {
            var item = $($("#period-con .period-item")[i]).find('input[name="sTime[]"]').val()
            if (item == '') {
                layer.msg('请填写营种期次')
                return;
            }
        }

        // 报名成功广告 开启 点击触发
        form.append("poster_select_type", $('input[name=poster_select_type]:checked').val());

        // 报名成功广告 跳转路径
        let posters = $('input[name="posters_path"]').val();
        if (posters != '' && posters.indexOf("/") == -1) {
            layer.msg('小程序路径请以 / 开头')
            return;
        }
        form.append('posters_path', posters);

        // 立即报名按钮 自定义样式
        form.append('is_sign', $('input[name=registed]:checked').val()); //0:默认样式 1:自定义样式
        if ($('#custom_sign').prop('checked')) {
            form.append('sign_btn_text', $('input[name=btn-text]').val()); // 按钮文案
            form.append('sign_bg', signBg);	// 背景颜色
            form.append('sign_text', signText);	// 文字颜色
        }

        var checkboxs = $("#contractBox").find("input[type=checkbox]")
        var checkboxArr = []
        for (var i = 0; i < checkboxs.length; i++) {
            if ($(checkboxs[i]).prop("checked")) {
                checkboxArr.push(1)
            } else {
                checkboxArr.push(0)
            }
        }

        // 按照日历形式展示 研学
        form.set('is_calendar', $('.calendar-flag').prop('checked') ? 2 : 1);

        // 是研学产品
        if (isYanxue) {
            form.set('product_type', '3');
        }

        // 是否限购 -> 设为单次限购
        if (form.get('product_type') == 1) {
            form.set('limit_sale_type', $('#limitSaleTypeMultiple').prop('checked') ? 1 : 0);
        } else {
            form.set('limit_sale_type', $('#limitSaleTypeOne').prop('checked') ? 1 : 0);
        }


        if ($(`input[name=bgsharepic]`).val()) {
            imgnew($(`input[name=bgsharepic]`).val()).then(res => {
                let img_bei = res.width / 375
                form.append('ewm_height', $('.qode').height() * img_bei);
            form.append('ewm_width', $('.qode').width() * img_bei);
            form.append('ewm_x', parseInt($('.qode').css('left')) * img_bei);
            form.append('ewm_y', parseInt($('.qode').css('top')) * img_bei);

            form.append('contract_mustread', checkboxArr);
            $.ajax({
                url: '__APP__/Admin/CourseGoods/addCourse',
                type: 'POST',
                data: form,
                processData: false,
                contentType: false,
                dataType: 'json',
                beforeSend: function () {
                    index = layer.load(1, {
                        shade: [0.3, '#000']
                    });
                },
                success: function (data) {
                    layer.close(index);
                    if (data.code == 0) {
                        cid = data.cid
                        pid = data.pid
                        //          return false
                        if (sub_hide == 1) {
                            subHidePeriod()
                        } else {
                            layer.msg('修改成功', {
                                anim: 0
                            }, function () {
                                if (flag == 0) {
                                    return
                                }
                                var is_group = getId('is_group') || 0;
                                if (is_group == 1) {
                                    window.location.href = "__APP__/Admin/CourseGoods/group"
                                    return;
                                }
                                if (flag == 3) {
                                    getSaveCode()
                                    return;
                                }
                                window.location.href = "__APP__/Admin/CourseGoods/index"
                            });
                        }
                    } else {
                        layer.msg(data.msg);
                        if (data.code == 4) {
                            location.reload()
                        }
                        return;
                    }

                }
            })
        })
        } else {
            form.append('contract_mustread', checkboxArr);
            $.ajax({
                url: '__APP__/Admin/CourseGoods/addCourse',
                type: 'POST',
                data: form,
                processData: false,
                contentType: false,
                dataType: 'json',
                beforeSend: function () {
                    index = layer.load(1, {
                        shade: [0.3, '#000']
                    });
                },
                success: function (data) {
                    layer.close(index);
                    if (data.code == 0) {
                        cid = data.cid
                        pid = data.pid
                        // 研学产品
                        if (isYanxue) {
                            (pid && bindSchoolId) ? layer.msg('保存成功') : goBindSchool(data.pid, no_update_status, is_on);
                            return;
                        }

                        // 保存隐藏营期
                        if (sub_hide == 1) {
                            subHidePeriod()
                        } else {
                            layer.msg('修改成功', {
                                anim: 0
                            }, function () {
                                if (flag == 0) {
                                    return
                                }
                                var is_group = getId('is_group') || 0;
                                if (is_group == 1) {
                                    window.location.href = "__APP__/Admin/CourseGoods/group"
                                    return;
                                }

                                // 保存并预览
                                if (flag == 3) {
                                    getSaveCode()
                                    return;
                                }
                                window.location.href = "__APP__/Admin/CourseGoods/index"
                            });
                        }
                    } else {
                        layer.msg(data.msg);
                        if (data.code == 4) {
                            location.reload()
                        }
                        return;
                    }

                }
            })
        }
    }

    // 研学保存完 没绑学校 提示绑学校
    function goBindSchool(pid, status, is_on) {
        layer.open({
            skin: 'bind-school-layer',
            title: '温馨提示',
            content: '保存成功，当前营种为下架状态，需绑定学校才可售卖，是否进行学校绑定？',
            btn: ['返回营种列表', '去绑定'],
            yes: () => {
            window.location.href = '__APP__/Admin/CourseGoods/yanxue';
    },
        btn2: () => {
            window.location.href = `__APP__/Admin/CourseGoods/yanxue?pid=${pid}&isbindSchool=1&productStatus=${status}&isOn=${is_on}`;
        }
    });
    }

    isChildChecked.change(function () {
        isCheckAge = $(this).prop('checked') ? $(this).val() : 0;
    });

    $("input[name=days]").on('input', function () {
        var daynum = $("input[name=days]").val();
        $("tr[class=trcon]").remove();
        for (var i = 1; i <= daynum; i++) {
            $("table[class=subtable]").append('<tr class="trcon"><td class="tdcon" >第' + i + '天</td><td class="tdcon" ><textarea class="veri" type="text" name="morn[]" value=""></textarea></td><td class="tdcon" ><textarea type="text" class="veri" name="morning[]" value=""></textarea></td><td class="tdcon" ><textarea class="veri" type="text" name="afternoon[]" value=""></textarea></td><td class="tdcon" ><textarea class="veri" type="text" name="evening[]" value=""></textarea></td><input class="veri" type="hidden" name="few_days[]" value="' + i + '" /></tr>');
        }
    })

    // radio
    $(document).on('click', '.my_radio', function () {
        $(this).parents('.radio_box').siblings().removeClass('r_on');
        $(this).parents('.radio_box').addClass('r_on');

    })
    $('input[type="radio"]').each(function (index, item) {
        if ($(item).prop('checked')) {
            $(this).parents('.radio_box').addClass('r_on');
        }
    })

    var $closeImg = $(".imgvi font");
    $closeImg.on("click", function (e) {
        var e = e || event;
        e.preventDefault();
        e.stopPropagation();
        $(this).siblings("img").attr({
            "src": "https://file.dev.xinduobang.cn/images/chrome-ext/1615368309226876.jpeg"
        });
        $(this).siblings("input").val("");
        $(this).addClass("hidden");
    })
    var infoImgs = $(".infoImgs");
    infoImgs.on("click", "font", function (e) {
        var e = e || event;
        e.preventDefault();
        e.stopPropagation();
        $(this).parent().parent().remove();
        if ($('.pic-box .hidden').length == 0) {
            renderImg();
        }
        var retUrl = $(this).prev().val();
        var swiperNo = 0;
        $('.pic-box input[type="hidden"]').each(function (i, v) {
            if ($(v).val() != '') {
                swiperNo++;
            }
        })
        $('#swiperNo').html(swiperNo)
    })
    $('input[name=is_limit]').on('change', function (event) {
        if ($(this).val() == 1) {
            $($('input[name=product_type]:checked').val() == 1 ? '#xiangou_box_qinzi' : '#xiangou_box_danfei').removeClass('hide')
        } else {
            $('#xiangou_box_danfei').addClass('hide')
            $('#xiangou_box_qinzi').addClass('hide')
            $('input[name=limits]').val('')
            $('input[name=limits_perio_parent]').val('')
            $('input[name=limits_perio_child]').val('')
        }
    })
    //点击二维码
    $(document).on('click', '#editCode', function () {
        $.ajax({
            url: '/Admin/CourseGoods/getxcxcode',
            type: 'POST',
            dataType: 'json',
            data: {
                pid: pid,
                no_limits: 1
            },
            success: function (data) {
                if (data.code == 0) {
                    $('#qrcodeModal').modal();
                    $('#bigqr').html('<img src="' + data.data + '" style="width:400px;margin:0 auto;" />');
                    $('.extensionUrl').html('链接: pages/camp/detail?pid=' + pid + '&no_limits=1');
                }
            }
        })
    });

    // 批量删除期次
    var delpidAll = 0
    $('.delBatchPeriod').on('click', function () {
        delpidAll = 0
        $('#selpidall').html('全选')
        if ($("#period-con .period-item").length == 1) {
            layer.msg('只有一个营期不可删除')
            return
        }
        var html = ""
        for (var i = 0; i < $("#period-con .period-item").length; i++) {
            var item = $("#period-con .period-item")[i]
            var period = $(item).find(".form-group").find(".datepicker").val()
            var id = $(item).find(".del-period").data('id')
            html += `
                    <label data-id="${id}" class="col-sm-6">
                        <input type="checkbox" /> ${period}
                    </label>
                `
        }
        $("#delperiodlist").html(html)
        $("#delperiodDialog").modal()

    })

    $('#delperiodDialog').on('click', 'label', function (params) {
        let bool = false
        $('#delperiodDialog input[type="checkbox"]').each(function () {
            if (!$(this).prop('checked')) {
                bool = true
            }
        })
        $('#selpidall').text(!bool ? '全不选' : '全选')
    })

    $("#delperiodDialog").on('click', '#selpidall', function () {
        for (var i = 0; i < $("#delperiodlist label").length; i++) {
            var item = $("#delperiodlist label")[i]
            delpidAll ? $(item).find('input[type=checkbox]').prop("checked", false) : $(item).find('input[type=checkbox]').prop("checked", true)
        }
        delpidAll ? delpidAll = 0 && $('#selpidall').html('全选') : delpidAll = 1 && $('#selpidall').html('全不选')

    })
    $("#delperiodDialog").on('click', '#delpid', function () {
        var checkarr = []
        for (var i = 0; i < $("#delperiodlist label").length; i++) {
            var item = $("#delperiodlist label")[i]
            if ($(item).find('input[type=checkbox]').prop("checked")) {
                checkarr.push($(item).data('id'))
            }

        }
        if (!checkarr.length) {
            layer.msg('请选择营期')
            return
        }
        if (checkarr.length == $("#delperiodlist label").length) {
            layer.msg('请至少保留一个营期')
            return
        }

        layer.confirm('确定要删除所选营期吗?删除后将不可回复', {
            title: '删除提醒'
        }, function (index) {
            periodIndex - checkarr.length;
            for (var i = 0; i < checkarr.length; i++) {
                for (var j = 0; j < $("#period-con .period-item").length; j++) {
                    var item = $("#period-con .period-item")[j]
                    var id = $(item).find(".del-period").data('id')
                    if (checkarr[i] == id) {
                        $(item).remove();
                        $('.destineTR' + id).remove();
                        $('.priceDiffTR' + id).remove();
                    }
                }
            }
            layer.close(index);
            $("#delperiodDialog").modal('hide')
        })
    })

    // 批量增加期次
    var dateCkArr = [];
    $('.addBatchPeriod').on('click', function () {
        // 显示modal
        $('#batchPeriodModal .bp-days').val('');
        $('#batchPeriodModal .bp-period-name').val('');
        $('#batchPeriodModal .time-ipt').val('');
        $('#batchPeriodModal .bp-stock').val('');
        $('#batchPeriodModal .salenum').val('');
        $('#batchPeriodModal .leaftnum').val('');
        calendarNick({
            wrapId: 'calendar-box', //日历容器id
        });
        $('#batchPeriodModal').modal();
    })
    //日历选择功能
    function calendarNick(options) {
        var opt = {
            opts: options
        };
        var obj = {
            //填充日历
            fillDate: function (year, month) {
                //本月份第一天是星期几-为显示上个月的天数做铺垫
                var first_day = new Date(year, month, 1).getDay();
                //如果刚好是星期天，则空出一行（显示上个月的天数）
                // first_day = first_day == 0 ? 7 : first_day;
                //本月份最后一天是几号
                var final_date = new Date(year, month + 1, 0).getDate(),
                    //上个月的最后一天是几号
                    last_date = new Date(year, month, 0).getDate(),
                    //剩余的格子数--即排在末尾的格子数
                    surplus = 42 - first_day - final_date;

                surplus = surplus >= 7 ? surplus - 7 : surplus;
                /*设置表头的日历*/
                opt.oHeadDate.innerHTML = year + '年' + (month + 1) + '月';
                /*填充日历执行*/
                var html = '';
                //上个月的显示天数
                for (var i = 0; i < first_day; i++) {
                    // html += '<span class="prev-date-nick">' + (last_date - (first_day - 1) + i) + '</span>';
                    html += '<span class="prev-date-nick"></span>';
                }
                //本月的显示天数
                for (var j = 0; j < final_date; j++) {
                    // 显示已选
                    html += '<span class="date-nick">' + (j + 1) + '</span>';
                }

                //下个月的显示天数
                for (var k = 0; k < surplus; k++) {
                    // html += '<span class="next-date-nick">' + (k + 1) + '</span>';
                    html += '<span class="next-date-nick"></span>';
                }
                //fill
                opt.oBody.innerHTML = html;
                // 当天
                if (year == new Date().getFullYear() && month == new Date().getMonth()) {
                    opt.oBody.getElementsByTagName('span')[first_day + opt.date - 1].className = 'nick-calendar-current date-nick';
                }
                $('.date-nick').each(function (i, v) {
                    for (var h = 0; h < dateCkArr.length; h++) {
                        // 显示已选
                        var ele = dateCkArr[h];
                        if (ele.y == year && ele.m == month + 1 && ele.d == $(v).html()) {
                            $(v).addClass('active');
                        }
                    }
                })

                //点击赋值ipt得到日期
                for (var x = 0, v = opt.oBody.getElementsByTagName('span'), len = v.length; x < len; x++) {
                    v[x].onclick = function () {
                        var now = new Date(year, month, 1),
                            y = 0,
                            m = 0;
                        y = year;
                        m = month;
                        if (this.innerHTML) {
                            if ($(this).hasClass('active')) {
                                var _this = this;
                                dateCkArr.forEach(function (v, i) {
                                    if (v.y == y && v.m == m + 1 && v.d == _this.innerHTML) {
                                        dateCkArr.splice(i, 1)
                                    }
                                })
                                $(this).removeClass('active');
                                $('.data_ck_num').html(dateCkArr.length);
                            } else {
                                var obj = {};
                                obj.y = y;
                                obj.m = m + 1;
                                obj.d = this.innerHTML - 0;
                                dateCkArr.push(obj);
                                $(this).addClass('active');
                                $('.data_ck_num').html(dateCkArr.length);
                            }
                        }
                    }
                }
            },
            // 下个月
            next: function () {
                var me = this;
                opt.oNext.onclick = function () {
                    $('.nick-calendar-tit input').prop('checked', false);
                    opt.month++;
                    if (opt.month > 11) {
                        opt.month = 0;
                        opt.year++;
                    }
                    // 填充日历
                    me.fillDate(opt.year, opt.month);
                }

            },
            // 上个月
            prev: function () {
                var me = this;
                opt.oPrev.onclick = function () {
                    $('.nick-calendar-tit input').prop('checked', false);
                    opt.month--;
                    if (opt.month < 0) {
                        opt.month = 11;
                        opt.year--;
                    }
                    // 填充日历
                    me.fillDate(opt.year, opt.month);
                }

            },
            // 下一年
            nextYear: function () {
                var me = this;
                opt.oNextYear.onclick = function () {
                    $('.nick-calendar-tit input').prop('checked', false);
                    opt.year++;
                    // 填充日历
                    me.fillDate(opt.year, opt.month);
                }

            },
            // 上一年
            prevYear: function () {
                var me = this;
                opt.oPrevYear.onclick = function () {
                    $('.nick-calendar-tit input').prop('checked', false);
                    if (opt.year > 1970) {
                        opt.year--;
                    }
                    // 填充日历
                    me.fillDate(opt.year, opt.month);
                }

            },
            // 选中列
            checkCol: function () {
                var me = this;
                $('.nick-calendar-tit input').on('change', function () {
                    var index = $(this).parent().index();
                    index = 6 - index;
                    if ($(this).prop('checked')) {
                        // 全选列
                        $(".nick-calendar-bd span:nth-child(7n-" + index + ")").each(function (i, v) {
                            if ($(v).hasClass('date-nick')) {
                                var _this = this;
                                var obj = {};
                                obj.y = opt.year;
                                obj.m = opt.month + 1;
                                obj.d = this.innerHTML - 0;
                                dateCkArr.push(obj);
                                $(v).addClass('active');
                            }
                            var tmpArr = [];
                            var tmpArr1 = [];
                            for (var ii = 0; ii < dateCkArr.length; ii++) {
                                var items = JSON.stringify(dateCkArr[ii]);
                                if ($.inArray(items, tmpArr) == -1) {
                                    tmpArr.push(items);
                                }
                            }
                            for (var j = 0; j < tmpArr.length; j++) {
                                tmpArr1.push(JSON.parse(tmpArr[j]));
                            }
                            dateCkArr = tmpArr1;
                            $('.data_ck_num').html(dateCkArr.length);
                        })
                    } else {
                        // 全不选列
                        $(".nick-calendar-bd span:nth-child(7n-" + index + ")").each(function (i, v) {
                            if ($(v).hasClass('date-nick')) {
                                var _this = this;
                                dateCkArr.forEach(function (vv, ii) {
                                    if (vv.y == opt.year && vv.m == opt.month + 1 && vv.d == _this.innerHTML) {
                                        dateCkArr.splice(ii, 1)
                                    }
                                })
                                $(v).removeClass('active');
                                $('.data_ck_num').html(dateCkArr.length);
                            }
                        })
                    }
                })
            },
            // 全选
            checkAll: function () {
                var me = this;
                $('.nick-calendar-hd input').on('change', function () {
                    if ($(this).prop('checked')) {
                        // 全选
                        $(".nick-calendar-bd span").each(function (i, v) {
                            if ($(v).hasClass('date-nick')) {
                                var _this = this;
                                var obj = {};
                                obj.y = opt.year;
                                obj.m = opt.month + 1;
                                obj.d = this.innerHTML - 0;
                                dateCkArr.push(obj);
                                $(v).addClass('active');
                            }
                        })
                        var tmpArr = [];
                        var tmpArr1 = [];
                        for (var ii = 0; ii < dateCkArr.length; ii++) {
                            var items = JSON.stringify(dateCkArr[ii]);
                            if ($.inArray(items, tmpArr) == -1) {
                                tmpArr.push(items);
                            }
                        }
                        for (var j = 0; j < tmpArr.length; j++) {
                            tmpArr1.push(JSON.parse(tmpArr[j]));
                        }
                        dateCkArr = tmpArr1;
                        $('.data_ck_num').html(dateCkArr.length);
                    } else {
                        // 全不选
                        $(".nick-calendar-bd span").each(function (i, v) {
                            if ($(v).hasClass('date-nick')) {
                                var _this = this;
                                dateCkArr.forEach(function (vv, ii) {
                                    if (vv.y == opt.year && vv.m == opt.month + 1 && vv.d == _this.innerHTML) {
                                        dateCkArr.splice(ii, 1)
                                    }
                                })
                                $(v).removeClass('active');
                            }
                        })
                        $('.data_ck_num').html(dateCkArr.length);
                    }
                })
            },
            //获取元素偏移位置
            offset: function (ele) {
                var l = ele.offsetLeft,
                    t = ele.offsetTop,
                    p = ele.offsetParent;
                while (p) {
                    l += p.offsetLeft + p.clientLeft;
                    t += p.offsetTop + p.clientTop;
                    p = p.offsetParent;
                }
                return {
                    left: l,
                    top: t
                }
            },
            init: function () {
                //初始化
                //  初始化参数
                //创建日历容器固定结构，每次切换日期值即可
                var div = document.getElementById(opt.opts.wrapId)
                div.innerHTML = '<div class="nick-calendar-hd"><button class="nick-calendar-prev-year">&lt;&lt;</button>' +
                    '<button class="nick-calendar-prev">&lt;</button><span class="nick-calendar-date"></span>' +
                    '<button class="nick-calendar-next">&gt;</button><button class="nick-calendar-next-year">&gt;&gt;</button> <input type="checkbox"> 全选  共选择<span class="data_ck_num">0</span>个日期' +
                    '</div><div class="nick-calendar-tit clear">' +
                    '<span>日 <input type="checkbox" /></span><span>一 <input type="checkbox" /></span><span>二 <input type="checkbox" /></span><span>三 <input type="checkbox" /></span><span>四 <input type="checkbox" /></span><span>五 <input type="checkbox" /></span><span>六 <input type="checkbox" /></span>' +
                    '</div><div class="nick-calendar-bd clear"></div>';
                opt.oWrap = document.getElementById(opt.opts.wrapId); //日历容器
                opt.oHeadDate = opt.oWrap.getElementsByClassName('nick-calendar-date')[0]; //头部日期
                opt.oBody = opt.oWrap.getElementsByClassName('nick-calendar-bd')[0]; //日期容器
                opt.oTit = opt.oWrap.getElementsByClassName('nick-calendar-tit')[0]; //星期容器
                opt.oPrev = opt.oWrap.getElementsByClassName('nick-calendar-prev')[0]; //上月按钮
                opt.oNext = opt.oWrap.getElementsByClassName('nick-calendar-next')[0]; //下月按钮
                opt.oPrevYear = opt.oWrap.getElementsByClassName('nick-calendar-prev-year')[0]; //上月按钮
                opt.oNextYear = opt.oWrap.getElementsByClassName('nick-calendar-next-year')[0]; //下月按钮
                opt.year = 0; //年
                opt.month = 0; //月
                opt.date = 0; //日

                // 获取今天的日历时间
                var now = new Date();
                opt.year = now.getFullYear();
                opt.month = now.getMonth();
                opt.date = now.getDate();
                // 初始化--填充日历
                this.fillDate(opt.year, opt.month);
                //切换年月
                this.next();
                this.nextYear();
                this.prev();
                this.prevYear();
                this.checkCol();
                this.checkAll();
            }
        };
        obj.init(); //初始化
    }

    // 批量添加营期 点击生成
    $('#batchPeriodBtn').on('click', function () {
        var period_name = $('.bp-period-name').val();
        var day = $('.bp-days').val();
        var stopDay = $('.time-ipt').val();
        var stopDay1 = $('.time-ipt1').val();
        var stopDay2 = $('.time-ipt2').val();
        var stock = $('.bp-stock').val();
        var salenum = $('.salenum').val();
        var leaftnum = $('.leaftnum').val();
        if (dateCkArr.length == 0) {
            layer.msg('请选择营期')
            return
        }
        if (day == '') {
            layer.msg('请输入出营天数');
            return
        }
        if (!/^\d+$/.test(day)) {
            layer.msg('请输入正确出营天数');
            return
        }
        if (stopDay == '' && stopDay1 == '' && stopDay2 == '') {
            layer.msg('请输入报名截止时间');
            return
        }
        if ((!/^\d+$/.test(stopDay)) || (!/^\d+$/.test(stopDay1)) || (!/^\d+$/.test(stopDay2))) {
            layer.msg('请输入正确报名截止时间');
            return
        }
        if (stock == '') {
            layer.msg('请输入库存');
            return
        }
        if (!/^\d+$/.test(stock)) {
            layer.msg('请输入正确库存');
            return
        }

        // 排序
        dateCkArr.forEach(function (v) {
            v.time = new Date(v.y + '-' + v.m + '-' + v.d).getTime()
        })
        dateCkArr.sort(sortFn('time'));
        var tableHtml = '';
        tableHtml = $('.createTable').html();
        //				清除有规格的已售数量
        $('.tablestore').html(tableHtml);
        $('.tablestore .skuStockIptChild').children("span").html(0)
        $('.tablestore .skuStockIptbig').children("span").html(0)
        tableHtml = $('.tablestore').html();

        if (!cid) {
            tableHtml = tableHtml.replace(/<span\s*[^>]*>(.*?)<\/span>/g, " ");
        } else {
            tableHtml = tableHtml.replace(/<td class="ddd"\s*[^>]*>(.*?)<\/td>/g, '<td class="ddd">0</td>');
        }
        if ($('#hasSpec').prop('checked')) {
            skuFlag = true;
        } else {
            skuFlag = false;
        }
        if ($('.period-item').length == 1 && periodConBox.find('input[name="sTime[]"]').val() == '' ||
            periodConBox.find('input[name="bTime[]"]').val() == '') {
            periodConBox.html('');
            periodIndex = 0;
            // 删除订金第一个
            $('.destine-table tbody').html('');
            // 删除营期差价第一个
            $('.priceDiff-con tbody').html('');
        }
        var HTML = '';
        var desRet = '';
        var diffRet = '';
        for (var i = 0; i < dateCkArr.length; i++) {
            var ele = dateCkArr[i];
            ele.m = parseInt(ele.m) > 9 ? ele.m : '0' + parseInt(ele.m);
            ele.d = parseInt(ele.d) > 9 ? ele.d : '0' + parseInt(ele.d);
            starttime = ele.y + '-' + '' + ele.m + '-' + ele.d + ' 23:59:59';
            starttime_end = ele.y + '-' + '' + ele.m + '-' + ele.d + ' 24:00:00';
            var weektime = (day - 1) * 24 * 3600 * 1000;
            stoptime = 0;
            if (stopDay) {
                stoptime += stopDay * 24 * 3600 * 1000;
            }
            if (stopDay1) {
                stoptime += stopDay1 * 3600 * 1000;
            }

            if (stopDay2) {
                stoptime += stopDay2 * 60 * 1000;
            }
            var start = new Date(starttime);
            starttime = ele.y + '-' + '' + ele.m + '-' + ele.d;
            var end = new Date(starttime_end);
            var newstart = parseInt(start.getTime()) + weektime;
            var newend = parseInt(start.getTime()) - stoptime;
            console.log(new Date(newend), start)
            // console.log(parseInt(end.getTime()))
            // console.log(stoptime)
            var sty, stm, std, ety, etm, etd, eth, eti;
            sty = new Date(newstart).getFullYear();
            stm = parseInt(new Date(newstart).getMonth()) + 1 >= 10 ? parseInt(new Date(newstart).getMonth()) +
                1 : "0" + (parseInt(new Date(newstart).getMonth()) + 1);
            std = new Date(newstart).getDate() >= 10 ? new Date(newstart).getDate() : "0" + new Date(
                newstart).getDate();

            ety = new Date(newend).getFullYear();
            etm = parseInt(new Date(newend).getMonth()) + 1 >= 10 ? parseInt(new Date(newend).getMonth()) +
                1 : "0" + (parseInt(new Date(newend).getMonth()) + 1);
            etd = new Date(newend).getDate() >= 10 ? new Date(newend).getDate() : "0" + new Date(newend).getDate();
            eth = new Date(newend).getHours() >= 10 ? new Date(newend).getHours() : "0" + new Date(newend).getHours();
            eti = new Date(newend).getMinutes() >= 10 ? new Date(newend).getMinutes() : "0" + new Date(newend).getMinutes();

            endtime = sty + "-" + stm + "-" + std;
            bendtime = ety + "-" + etm + "-" + etd + " " + eth + ":" + eti + ":00";
            HTML += renderPeriod((periodIndex + dateCkArr.length - i), tableHtml, skuFlag, '', stock,
                period_name, '', stock, '', $('input[name="product_type"]:checked').val(), '', '', '', '', '', salenum, leaftnum, 0);
            HTML = HTML.replace(/name="big_overplus\[\]" value="(.*?)"/g, `name="big_overplus[]" value="${stock}"`)
            HTML = HTML.replace(/overplus_patch" name="stock\[\]" value="(.*?)"/g, `overplus_patch" name="stock[]" value="${stock * $('.createTable').find('tbody').find('tr').length}"`)
            HTML = HTML.replace(/big_overplus_patch" name="big_overplus\[\]" value="(.*?)"/g, `big_overplus_patch" name="big_overplus[]" value="${stock * $('.createTable').find('tbody').find('tr').length}"`)
            desRet += renderDestinePrice((periodIndex + dateCkArr.length - i), starttime.slice(0, 10), endtime);
            diffRet += renderPriceDiff((periodIndex + dateCkArr.length - i), starttime.slice(0, 10), endtime);
        }
        periodIndex += dateCkArr.length;
        var periodIndexNum = $('.period-con > div').length;
        periodConBox.prepend(HTML);
        setYanxueStyle();
        for (var j = 0; j < dateCkArr.length; j++) {
            // 初始化 时间插件
            uselaydate(periodIndexNum + j + 1);
        }
        // 生成订金
        // 生成不同营期不同价格
        $('.destine-table table tbody').prepend(desRet);
        $('.priceDiff-box table tbody').prepend(diffRet);
        initDestineData();
        $('#batchPeriodModal').modal('hide');
        if ($('.period-item').length > 10) {
            $('.period-con').css({
                'height': '540px',
                'overflow': 'hidden'
            })
            $('.period-con-mask,.period-con-btn').show()
        } else {
            $('.period-con').css({
                'height': 'auto',
            })
            $('.period-con-mask,.period-con-btn').hide()
        }
        var dateCkArrCus = dateCkArr.map(item => {
            return item.y + '-' + item.m + '-' + item.d
        })
        $('.period-item').each(function (idx, itm) {
            var that = $(this)
            if (that.find('input[name="sTime[]"]').attr('s') == dateCkArrCus[idx]) {
                $(itm).find('tr').each(function (trIdx, trItm) {
                    var _this = $(this)
                    if (trIdx > 0) {
                        _this.find('td.skuStockIpt').find('input').val(stock)
                        _this.find('td.skuStockIptChild').find('input').val(stock)
                        _this.find('td.skuStockIptbig').find('input').val(stock)
                        _this.find('.sku-child').val('儿童库存:' + stock)
                        _this.find('.sku-parent').val('成人库存:' + stock)
                    } else {
                        _this.find('th.sku-stock').find('.allStockNum').html(stock * $(itm).find('tbody').find('tr').length)
                        _this.find('th.skuStockIptChild').find('input').html(stock)
                        _this.find('th.skuStockIptbig').find('input').html(stock)
                        _this.find('.sku-child').html('儿童库存:' + stock * $(itm).find('tbody').find('tr').length)
                        _this.find('.sku-parent').html('成人库存:' + stock * $(itm).find('tbody').find('tr').length)
                    }
                })
            }
        });

        if (skuFlag) {
            $('.is_total').removeClass('hide')
        }
    });

    function sortFn(sortName) {
        return function (a, b) {
            var v1 = a[sortName] - 0;
            var v2 = b[sortName] - 0;
            if (v1 < v2) {
                return 1;
            } else if (v1 > v2) {
                return -1;
            } else {
                return 0;
            }
        }
    }

    // 会员等级优惠
    $('#n-level-free').on('click', function () {
        $('.level-free-con').addClass('hide');
        $('.level-free-condis').addClass('hide');
    })
    $('#y-level-free').on('click', function () {
        $('.level-free-con').removeClass('hide');
        $('.level-free-condis').addClass('hide');
    })
    $('#ydis-level-free').on('click', function () {
        $('.level-free-condis').removeClass('hide');
        $('.level-free-con').addClass('hide');
    })

    $.ajax({
        url: '/Admin/CourseGoods/levelList',
        type: 'post',
        data: {
            pid: pid
        },
        dataType: 'json',
        success: function (data) {
            if (data.code != 0) {
                layer.msg(data.msg);
                return
            }
            $('[name=coin_level]').html($.map(data.coin_level_list, function (item, index) {
                return `<option value="${item.level}" ${item.is_select == 1 ? 'selected' : ''}>Lv.${item.level}</option>`;
            }).join(''))

            // 会员优惠等级
            $(`input[name="is_vip_level"][value="${data.is_vip_level}"]`).trigger('click');
            $('input[type="radio"]').each(function (index, item) {
                if ($(item).prop('checked')) {
                    $(this).parents('.radio_box').addClass('r_on');
                }
            });
            var leveltype = data.is_vip_level
            data = data.level_list;
            var html = '', htmls = ''
            for (var i = 0; i < data.length; i++) {
                var ele = data[i];
                var name = ele.name ? '(' + ele.name + ')' : '';
                var ck = ele.is_select == 0 ? '' : 'checked';
                var peice = ele.is_select == 0 ? '' : ele.price;
                if (leveltype == 1) {
                    html += '<div class="level-free-item" style="margin-bottom: 5px;">\
                                <input class="level-free-ck" ' + ck + ' data-id="' + ele.id + '" data-name="' + ele.name + '" data-level="' + ele.level + '" style="vertical-align: -2px" type="checkbox"> Lv' + ele.level + ' ' + name + ' 减 <input type="text" value="' + peice + '" class="form-control level-free-price" style="width: 100px;display: inline-block;"> 元\
                                </div>'
                    htmls +=
                        '<div class="level-free-itemdis" style="margin-bottom: 5px;">\
                                <input class="level-free-ck" data-id="' +
                        ele.id + '" data-name="' + ele.name + '" data-level="' + ele.level +
                        '" style="vertical-align: -2px" type="checkbox"> Lv' + ele.level + ' ' + name +
                        ' 指定折扣 <input type="text" class="form-control level-free-price" style="width: 100px;display: inline-block;"> 折\
                            </div>'
                } else if (leveltype == 2) {
                    html += '<div class="level-free-item" style="margin-bottom: 5px;">\
                                <input class="level-free-ck" data-id="' +
                        ele.id + '" data-name="' + ele.name + '" data-level="' + ele.level +
                        '" style="vertical-align: -2px" type="checkbox"> Lv' + ele.level + ' ' + name +
                        ' 减 <input type="text" class="form-control level-free-price" style="width: 100px;display: inline-block;"> 元\
                            </div>'
                    htmls += '<div class="level-free-itemdis" style="margin-bottom: 5px;">\
                                <input class="level-free-ck" ' + ck + ' data-id="' + ele.id + '" data-name="' + ele.name + '" data-level="' + ele.level + '" style="vertical-align: -2px" type="checkbox"> Lv' + ele.level + ' ' + name + ' 指定折扣 <input type="text" value="' + peice + '" class="form-control level-free-price" style="width: 100px;display: inline-block;"> 折\
                                </div>'
                } else {
                    html +=
                        '<div class="level-free-item" style="margin-bottom: 5px;">\
                                <input class="level-free-ck" data-id="' +
                        ele.id + '" data-name="' + ele.name + '" data-level="' + ele.level +
                        '" style="vertical-align: -2px" type="checkbox"> Lv' + ele.level + ' ' + name +
                        ' 减 <input type="text" class="form-control level-free-price" style="width: 100px;display: inline-block;"> 元\
                            </div>'

                    htmls +=
                        '<div class="level-free-itemdis" style="margin-bottom: 5px;">\
                                    <input class="level-free-ck" data-id="' +
                        ele.id + '" data-name="' + ele.name + '" data-level="' + ele.level +
                        '" style="vertical-align: -2px" type="checkbox"> Lv' + ele.level + ' ' + name +
                        ' 指定折扣 <input type="text" class="form-control level-free-price" style="width: 100px;display: inline-block;"> 折\
                                </div>'
                }

            }
            $('.level-free-con>.col-sm-8').html(html);
            $('.level-free-condis>.col-sm-8').html(htmls);
        }
    });
    // 卡券核销
    $('#card_status1').on('click', function () {
        $('.hx_num_box').addClass('hide');
    })
    $('#card_status2').on('click', function () {
        $('.hx_num_box').removeClass('hide');
    })
    // 购买送币控制
    $('[name=is_give_coin]').on('change', function () {
        $('.give_coin_con')[$(this).val() == 1 ? 'removeClass' : 'addClass']('hide');
    })
    //参与大转盘

    $('input[name=joinlottery]').on('change', function () {
        $('#joinlottery-select')[$(this).val() == 0 ? 'addClass' : 'removeClass']('hide')
        $('.joinlottery-label')[$(this).val() == 0 ? 'addClass' : 'removeClass']('hide')
        $('#joinlottery-y')[$(this).val() == 0 ? 'addClass' : 'removeClass']('hide')
        $(this).val() == 0 && $('input[name=lottermoney]').val('') && $('input[name=lotternum]').val('')
    })

    //      亲子差价
    $('input[name=qz_gap]').on('change', function () {
        $('#child_gap')[$(this).val() == 0 ? 'addClass' : 'removeClass']('hide')
        $('#parent_gap')[$(this).val() == 0 ? 'addClass' : 'removeClass']('hide')
        $(this).val() == 0 && $('input[name=c_gap_price]').val('') && $('input[name=p_gap_price]').val('')
    })

    function fnGetLotteryItem(_pid) {
        $.ajax({
            url: "/Admin/Lottery/getlottery",
            method: "POST",
            data: {
                pid: _pid
            },
            success: function (res) {
                if (res.code != 0) {
                    layer.msg(res.msg)
                    return
                }
                var html = `<option value="">请指定大转盘活动</option>`
                data = res.data
                if (data) {
                    data.forEach(item => {
                        html += `<option ${item.is_select == 1 ? 'selected' : ''} value="${item.id}">${item.name}</option>`
                })
                }
                $('#joinlottery-select').html(html)
            }
        });
    }
    fnGetLotteryItem(pid)
    $(document).on('blur', 'input[name=lottermoney]', function () {
        var _this = $(this),
            _val = Number(_this.val())
        if (_val == 0) {
            $('select[name=lottermoneytype]').val(1)
        }
    })

    // 出营类型切换
    $('input[name="product_type"]').on('click', function () {
        var _this = this;
        // 编辑获取详情改用trigger触发时不走这里 会覆盖已生成的值
        if (hasGetInfo) {
            step.Creat_Table(1);
            step.Creat_Table(2, false);
        }
        if ($(_this).val() == 0) {
            $('#give_lottery_only_child').parent('span').addClass('hide'); // 购买送优惠 -> 参与大转盘 -> 仅支持儿童(仅亲子显示)
            $('.unqinzi').addClass('hide');
            $('.qinzi').removeClass('hide');
            $("#parenting_config_card").addClass("dn")
            // 孩子单飞 
            $('#nav-parenting-box').hide()
            $('#nav-parenting').addClass('hidden-title')
            $('.nav-parent').hide()
            $('.right-nav-2').css('height', '301px')
            // 表单处理
            var html = '';
            html += '<label class="col-sm-2 control-label"><span class="must">*</span> 选择报名表:</label><div class="col-sm-3 "> <select class="form-control" style="display: inline-block; width: 60%;" name="form_id" id="form_id">'
            for (var i = 0; i < form_list.length; i++) {
                var ele = form_list[i];
                if (ele.is_select == 1) {
                    html += '<option selected value="' + ele.form_id + '">' + ele.name + '</option>';
                } else {
                    html += '<option value="' + ele.form_id + '">' + ele.name + '</option>';
                }
            }
            html += '</select><a href="/Admin/Set/studentTpl" target="_blank">去设置</a></div>'
            $('.form_id_box').html(html);
            // 库存处理 无修改
            $('.stock-name').text('库存');
            $('.big_overplus_box').addClass('hide');
            // 价格处理
            // 无sku
            $('.price-name').text('');
            $('.noSpec-box-price').css('margin', '0')
            $('.big_price_box').addClass('hide');

            $('.group-camp').addClass('hide');
            $('input[name="is_pre_order"]').prop('disabled', false);
            $('input[name="add_status"]').prop('disabled', false);
            $('.age_hide').hide();
            $('.age_show').show();
            hasGetInfo && $('input[name="sage"]').val('');
            hasGetInfo && $('input[name="eage"]').val('');
        } else if ($(_this).val() == 1) {
            $('#give_lottery_only_child').parent('span').removeClass('hide'); // 购买送优惠 -> 参与大转盘 -> 仅支持儿童(仅亲子显示)
            $('.qinzi').addClass('hide');
            $('.unqinzi').removeClass('hide');
            if ($("input[name=is_givecard]:checked").val() == 1) {
                $("#parenting_config_card").removeClass("dn")
            }
            // 家庭亲子
            $('#nav-parenting-box').show()
            $('#nav-parenting').removeClass('hidden-title')
            $('.nav-parent').show()
            $('.right-nav-2').css('height', '344px')
            // 表单处理
            var _html = '';
            _html += '<label class="col-sm-2 control-label"><span class="must">*</span> 报名表单:</label><div class="col-sm-4">儿童: <select style="display: inline-block; width: 60%;" class="form-control" name="form_id">'
            for (var i = 0; i < form_list.length; i++) {
                var ele = form_list[i];
                if (ele.is_select == 1) {
                    _html += '<option selected value="' + ele.form_id + '">' + ele.name + '</option>';
                } else {
                    _html += '<option value="' + ele.form_id + '">' + ele.name + '</option>';
                }
            }
            _html += '</select><br><br>成人: <select style="display: inline-block; width: 60%;" class="form-control" name="big_form_id">';
            // 添加的时候不会返回big_from_list
            if (!big_form_list) {
                big_form_list = form_list;
            }
            for (var j = 0; j < big_form_list.length; j++) {
                var ele = big_form_list[j];
                if (ele.is_select == 1) {
                    _html += '<option selected value="' + ele.form_id + '">' + ele.name + '</option>';
                } else {
                    _html += '<option value="' + ele.form_id + '">' + ele.name + '</option>';
                }
            }
            _html += '</select><a href="/Admin/Set/studentTpl" target="_blank">去设置</a></div>';
            $('.form_id_box').html(_html);
            // 库存处理
            // 无sku 增加 儿童库存, 成人库存, 总库存上限(默认disabled), 是否启用总库存上限(checkbox).
            $('.stock-name').text('儿童库存');
            $('.big_overplus_box').removeClass('hide');
            // 有sku

            // 价格处理
            // 无sku
            $('.price-name').text('儿童价格:');
            $('.noSpec-box-price').css('margin', '20px 0')

            $('.big_price_box').removeClass('hide');

            $('.group-camp').addClass('hide');
            $('input[name="is_pre_order"]').prop('disabled', false);
            $('input[name="add_status"]').prop('disabled', false);
            $('.age_hide').show();
            $('.age_show').hide();
        } else if ($(_this).val() == 2) {
            $('.unqinzi').addClass('hide');
            $('.qinzi').removeClass('hide');
            $("#parenting_config_card").addClass("dn")
            // 表单处理
            var html = '';
            html +=
                '<label class="col-sm-2 control-label"><span class="must">*</span> 选择报名表:</label><div class="col-sm-3 "> <select class="form-control" style="display: inline-block; width: 60%;" name="form_id" id="form_id">'
            for (var i = 0; i < form_list.length; i++) {
                var ele = form_list[i];
                html += '<option value="' + ele.form_id + '">' + ele.name + '</option>';
            }
            html += '</select><a href="/Admin/Set/studentTpl" target="_blank">去设置</a></div>'
            hasGetInfo && $('.form_id_box').html(html);
            // 库存处理 无修改
            $('.stock-name').text('库存');
            $('.big_overplus_box').addClass('hide');
            // 价格处理
            // 无sku
            $('.price-name').text('');
            $('.noSpec-box-price').css('margin', '0')

            $('.big_price_box').addClass('hide');

            // 小组竞赛
            $('.group-camp').removeClass('hide');
            $('#nodestine').prop('checked', true);
            $('#enroll_order1').prop('checked', true);
            $('.destine-table').addClass('hide');
            $('input[name="is_pre_order"]').prop('disabled', true);
            $('input[name="add_status"]').prop('disabled', true);
            $('input[type="radio"]').each(function (index, item) {
                if ($(item).prop('checked')) {
                    $(this).parents('.radio_box').addClass('r_on').siblings().removeClass('r_on');
                }
            });
            $('.age_hide').hide();
            $('.age_show').show();
            hasGetInfo && $('input[name="sage"]').val('');
            hasGetInfo && $('input[name="eage"]').val('');
        }
    })

    // 总库存上限切换
    $(document).on('click', '.is_max', function () {
        console.log($(this).val());

        if ($('input[name="is_sku"]:checked').val() == 0) {
            // 无sku
            if ($(this).prop('checked')) {
                $(this).next().val(1).parent().next().find('input').prop('readonly', false);
            } else {
                $(this).next().val(0).parent().next().find('input').prop('readonly', true);
            }
        } else {
            if ($(this).prop('checked')) {
                $(this).next().val(1).parent().parent().parent().parent().find('.skuStockIptLimit input').prop('readonly', false);
                $(this).parents('.sku-stock-box').prev().find('input[name="limit_overplus[]"]').prop('readonly', false);
                $(this).parents('.sku-stock-box').prev().find('input[name="is_max[]"]').val(1);
            } else {
                $(this).next().val(0).parent().parent().parent().parent().find('.skuStockIptLimit input').prop('readonly', true);
                $(this).parents('.sku-stock-box').prev().find('input[name="is_max[]"]').val(0);
                $(this).parents('.sku-stock-box').prev().find('input[name="limit_overplus[]"]').prop('readonly', false);
            }
        }
    })
    // 点击帮助
    $(document).on('click', '.help', function () {
        layer.open({
            title: '温馨提示',
            content: '总库存代表儿童库存数+成人库存数，开启后，会员报名该营种的儿童加成人总数将不可超过总库存'
        });
    })

    // 使用click事件监听 避免点击浏览器返回按钮到这个页面的时候不触发
    $(document).on('click', 'input[name=vip_pay_type]', function () {
        var _this = $(this),
            _val = _this.val()
        // console.log(_val);
        _this.siblings('input[type=number]').prop('disabled', false)
        _this.parent('.radio_box').siblings('.radio_box').find('input[type=number]').prop('disabled', true).val('')
    })

    $(document).on('click', '.period-con-mask,.period-con-btn', function () {
        $('.period-con').css({
            'height': 'auto',
            'overflow': 'inherit'
        })
        $('.period-con-mask,.period-con-btn').hide()
    })

    $(document).on('click', '.additem', function () {
        var html = `<div class="input-group mb-10" style="position:relative">
            <input class="form-control" placeholder="客服姓名" type="text" name="khdhlistname[]" value="">
            <span class="input-group-addon">-</span>
            <input class="form-control" placeholder="客服电话" type="number" name="khdhliststr[]" value="">
            <span class="input-group-addon">
            <a href="javascript:;" class="additem glyphicon glyphicon-plus"></a>
            </span>
            <span class="input-group-addon">
            <a href="javascript:;" class="removeitem text-danger glyphicon glyphicon-minus"></a>
            </span>
            </div>`
        if ($('#khdhlistbox').find('.input-group').length >= 5) {
            layer.msg('最多支持6个客服')
            return
        }
        $('#khdhlistbox').append(html)
    })
    $(document).on('click', '.removeitem', function () {
        $(this).parents('.input-group').remove()
    })
    //已售数量
    $(document).on('change', 'input[name=is_show_salenum]', function () {
        var _this = $(this),
            _val = _this.val()
        var show_salenum = $('#show_salenum')
        if (_val == 3) {
            $("#yis_show_realmoney").prop('disabled', false)
            show_salenum.prop('disabled', true).val('')
            $("#yis_show_period").prop('disabled', false)
            $("#yis_show_maxnum").prop('disabled', false)
            $("input[name=maxshownum]").prop('disabled', false)
            $('#initialSaleNum').prop('disabled', false);
        } else if (_val == 4) {
            $("#yis_show_realmoney").prop('disabled', true)
            $("#yis_show_realmoney").prop('checked', false)
            $("#yis_show_period").prop('disabled', true)
            $("#yis_show_period").prop('checked', false)
            $("#yis_show_maxnum").prop('disabled', true)
            $("#yis_show_maxnum").prop('checked', false)
            $("input[name=maxshownum]").prop('disabled', true)
            $("input[name=maxshownum]").val('');
            $('#initialSaleNum').prop('disabled', true);

            show_salenum.prop('disabled', false)
        } else {
            $("#yis_show_realmoney").prop('disabled', true)
            $("#yis_show_realmoney").prop('checked', false)
            $("#yis_show_period").prop('disabled', true)
            $("#yis_show_period").prop('checked', false)
            $("#yis_show_maxnum").prop('disabled', true)
            $("#yis_show_maxnum").prop('checked', false)
            $("input[name=maxshownum]").prop('disabled', true)
            $("input[name=maxshownum]").val('')
            show_salenum.prop('disabled', true)
            $('#initialSaleNum').prop('disabled', true);
        }
    })
    $('#show_salenum').on('input', function (params) {
        $('#sell_num').html(Number($(this).val()) + Number(sell_num))
    })
    // 老营员优惠
    $('input[name="old_status"]').on('click', function () {
        $('.old-free-box')[$(this).val() == 0 ? 'addClass' : 'removeClass']('hide');
    })
    // 亲子优惠
    $('input[name="qz_status"]').on('click', function () {
        $('.parent-free-box')[$(this).val() == 0 ? 'addClass' : 'removeClass']('hide');
    })
    // 儿童拼床
    $('input[name="is_bed"]').on('click', function () {
        $('.is-bed-box')[$(this).val() == 0 ? 'addClass' : 'removeClass']('hide');
    })

    // 起售数量
    $('input[name="is_start_num"]').on('click', function () {
        $('.is-start-box')[$(this).val() == 0 ? 'addClass' : 'removeClass']('hide');
        $('.is-start-big-box')[$('#y_n_product_type').is(':checked') ? 'removeClass' : 'addClass']('hide');
    })
    $('input[name="vip_tq_type"]').on('click', function () {
        $('.vipType')[$(this).val() == 1 ? 'addClass' : 'removeClass']('hide');
    })
    $('input[name=is_timepay_type]').change(function () {
        $('.yhcondatetime')[$(this).val() == 0 ? 'removeClass' : 'addClass']('hide')
        $(`input[name=timepay_day],input[name=timepay_price]`).prop('disabled', $(this).val() == 0 ? true : false).val('')
    })

    //      {$year_name}优惠
    $('input[name=is_yearcard]').change(function () {
        $('#yearcard_content').css('display', $(this).val() == 1 ? 'block' : 'none')
    })

    /*
        满减优惠
        */
    $('input[name=mjyh_type]').change(function () {
        if ($(this).val() == 1) {
            $('#mjyh_box').removeClass('hide')
            $(`input[name=mjyh_full],input[name=mjyh_reduce]`).val('')
        } else {
            $('#mjyh_box').addClass('hide')
        }
    })
    /*
        添加满减优惠
        */
    function fnAddMjyh() {
        var html = `<p>
                每满
                <input type="number" name="mjyh_full[]" class="form-control" style="width:100px;display: inline-block;">元减
                <input type="number" name="mjyh_reduce[]" class="form-control" style="width:100px;display: inline-block;">元
                <button type="button" class="btn btn-danger btn-xs" onclick="fnDelMjyh(this)">删除</button>
                </p>`
        $('#mjyh_list').append(html)
    }
    /*
        删除满减优惠
        */
    function fnDelMjyh(el) {
        var _this = $(el)
        if (_this.parents('#mjyh_list').find('p').length == 1) {
            layer.msg('满减优惠开启状态下至少保留一条')
            return
        }
        _this.parents('p').remove()
    }

    // 全额抵扣同上
    // $('input[name=deduct]').change(function() {
    // 	var _this = $(this),
    // 		_val = _this.val()
    // 	if(_val == 1) {
    // 		$('#mjyh_box').removeClass('hide')
    // 		$(`input[name=qedk_full],input[name=qedk_reduce]`).val('')
    // 	} else {
    // 		$('#mjyh_box').addClass('hide')

    // 	}
    // })

    function fnAddQedk() {
        var html = `<p class="fullCutItem1">
                满<input type="number" class="form-control peopleNum1" style="width:100px;display: inline-block;">人，每人减<input type="number" class="form-control fullCutPrice1" style="width:100px;display: inline-block;">个虚拟币
                    <button type="button" class="btn btn-danger btn-xs" onclick="fnDeQedk(this)">删除</button>
                </p>`
        $('#qedk_list').append(html)
    }

    function fnDeQedk(el) {
        var _this = $(el)
        _this.parents('p').remove()
    }
    /*
        规格总库存
        */
    $(document).on('change', '.istotal', function () {
        var _this = $(this),
            _checkedType = _this.is(':checked')
        console.log(_checkedType);
        if (_checkedType) {
            _this.parents('.is_total').find('.totalnum').prop('disabled', false)
        } else {
            _this.parents('.is_total').find('.totalnum').prop('disabled', true).val('')
        }
    })

    function getSaveCode() {
        $.ajax({
            url: '/Admin/CourseGoods/getxcxcode',
            type: 'POST',
            dataType: 'json',
            data: {
                pid: pid
            },
            success: function (data) {
                if (data.code == 0) {
                    $('#codeModal').modal();
                    $('#codeImg').html('<img src="' + data.data + '" style="width:400px;margin:0 auto;" />');
                    $('.codeUrl').html('链接: pages/camp/detail?pid=' + pid);
                    $('#codeModal').modal();
                }
            }
        })
    }

    // 请求{$year_name}列表
    var yearcard = ''

    function fnGetYearcard() {

        $.ajax({
            url: "/Admin/CourseGoods/getCardInfoajax",
            method: "GET",
            data: {
                id: pid
            },
            success: function (res) {
                if (res.code != 0) {
                    layer.msg(res.msg)
                    return
                }
                var yearcardArr = [];
                if (res.list.length != 0) {
                    var tmp = '';
                    $.each(res.list, function () {
                        if (this.is_select == 1) {
                            yearcardArr.push(this.id);
                            tmp += `<option value="${this.id}" selected="selected" ${this.is_optional == 0 ? 'disabled' : ''}>${this.yearcard_name}</option>`;
                        } else {
                            tmp += `<option value="${this.id}" ${this.is_optional == 0 ? 'disabled' : ''}>${this.yearcard_name}</option>`;
                        }
                    })
                    $('#yearcard').html(tmp);
                    if (yearcardArr.length > 0) {
                        yearcard = yearcardArr.join(',');
                    }
                    $('#yearcard').selectize({
                        plugins: ['remove_button'],
                        persist: true,
                        createOnBlur: true,
                        create: false,
                        onChange: function (name) {
                            if (name) {
                                yearcard = name.join(',');
                            } else {
                                yearcard = '';
                            }
                        }
                    });
                }
            }

        });
    }
    fnGetYearcard()

    function showTip(text) {
        let templateDom = text;
        if (text == 'yanxueUseDesc') {
            templateDom = `<img src="http://file.dev.xinduobang.cn/headimg/0b0aa8ec8be884c9af0a96bbe96550d0.png?imageView2/2/w/750" style="width:533px; height:auto;" />`;
        }
        layer.open({
            title: '温馨提示',
            type: 1,
            content: `<div style="padding:20px;">${templateDom}</div>`,
            btn: 0
        })
    }

    $('#check-period').on('click', function (params) {
        $('#hidelist input[type="checkbox"]').prop('checked', $(this).text() == '全选' ? true : false)
        $(this).text($(this).text() == '全选' ? '全不选' : '全选')
    })
    $('#hidelist').on('click', '.checkedes', function (params) {
        let bool = false
        $('#hidelist input[type="checkbox"]').each(function () {
            if (!$(this).prop('checked')) {
                bool = true
            }
        })
        $('#check-period').text(!bool ? '全不选' : '全选')
    })
    function qxhide() {
        var loading = layer.load(2, {
            shade: [0.3, '#000']
        });
        $.ajax({
            url: '__APP__/Admin/Course/course_sku',
            type: 'post',
            data: {
                cid: cid,
                pid: pid
            },
            dataType: 'json',
            success: function (data) {
                $('#hidelist').html('<p>勾选后对应的营期将不会在营前用户端显示</p>')
                data.data.list.map(res => {
                    $('#hidelist').append(`<label style="width:50%;" class="checkedes">
                                <input type="checkbox" ${res.is_hide == 1 ? 'checked' : ''} value="${res.id}" />${res.name}
                            </label>`)
            })
                layer.close(loading);
            }
        })
    }
    $('#sub-hide-period').on('click', function (params) {
        checksubmit(0, 1, 1, 0);
    })
    function subHidePeriod(params) {
        let arr = []
        $('#hidelist input[type="checkbox"]:checked').each(function () {
            arr.push($(this).val())
        })
        var loading = layer.load(2, {
            shade: [0.3, '#000']
        });
        $.ajax({
            type: "POST",
            url: "/Admin/CourseGoods/periodstatusajax",
            data: {
                cid: getId('cid'),
                period: arr.join(',')
            },
            success: function (res) {
                layer.close(loading);
                if (res.code != 0) {
                    layer.msg(res.msg)
                    return
                }
                $('#hidePeriodList').modal('hide');
                layer.msg(res.msg, { anim: 0 }, function () {
                    document.location.reload();
                });
            }
        });
    }
    function getmarkform(params) {
        var loading = layer.load(2, {
            shade: [0.3, '#000']
        });
        $.ajax({
            type: "get",
            async: false,
            url: "/Admin/CourseGoods/getmarkform",
            success: function (data) {
                layer.close(loading);
                if (data.code != 0) {
                    layer.msg(data.msg)
                    return
                }
                data.data.forEach(res => {
                    $('#mark_form_id').append(`<option value="${res.id}">${res.name}</option>`)
            })
            }
        });
    }
    var medalboxSelect, medalboxOption;
    function getmedalajax() {
        var loading = layer.load(2, {
            shade: [0.3, '#000']
        });
        $.ajax({
            type: "POST",
            url: "/Admin/CourseGoods/getmedalajax",
            data: {
                pid: pid
            },
            success: function (data) {
                layer.close(loading);
                if (data.code != 0) {
                    layer.msg(data.msg)
                    return
                }
                var html = ""

                for (var i = 0; i < data.data.length; i++) {
                    if (data.data[i].data.length != 0) {
                        for (var j = 0; j < data.data[i].data.length; j++) {
                            if (data.data[i].data[j].is_checkbox == 1) {
                                html += `<option value="${data.data[i].data[j].id}" selected>${data.data[i].data[j].medal_name}</option>`
                            } else {
                                html += `<option value="${data.data[i].data[j].id}">${data.data[i].data[j].medal_name}</option>`
                            }

                        }
                    }
                }
                $(".medalbox").html(html)

                medalboxSelect = $('.medalbox').selectize({
                    plugins: ['remove_button']
                });
                medalboxOption = medalboxSelect[0].selectize;
            }
        });
    }
    // 小程序码拖拽
    var qode = document.getElementsByClassName("qode")[0]
    var coor = document.getElementsByClassName("coor")[0]
    var imglabel = document.getElementsByClassName("imglabel")[0]

    qode.onmousedown = function (e) {
        e.preventDefault()
        e = e || event;
        var x = e.clientX;  //获取鼠标按下的位置
        var y = e.clientY;
        var blockwidth = $(qode).width();
        var gapX = x - e.target.offsetLeft
        var gapY = y - e.target.offsetTop
        if (e.target.classList[0] == 'coor') {
            document.onmousemove = function (e) {
                console.log('big')
                e = e || event;
                e.preventDefault()
                let newwidth = (e.clientX - x) > (e.clientY - y) ? (e.clientX - x) : (e.clientY - y)
                $(qode).width(newwidth + blockwidth);
                $(qode).height(newwidth + blockwidth);
                if ((newwidth + blockwidth) > 375) {
                    $(qode).width(375);
                    $(qode).height(375);
                }

                if ($(qode).width() < 10) {
                    qode.style.width = '10px';
                    qode.style.height = '10px';
                }
            }
        } else {
            document.onmousemove = function (e) {
                console.log('move')
                e = e || event;
                e.preventDefault()
                qode.style.left = e.clientX - gapX + "px"
                qode.style.top = e.clientY - gapY + "px"
                var maxX = imglabel.clientWidth - qode.offsetWidth
                var maxY = imglabel.clientHeight - qode.offsetHeight

                if (e.clientX - gapX < 0) {
                    qode.style.left = 0
                } else if (e.clientX - gapX > maxX) {
                    qode.style.left = maxX + "px"
                }

                if (e.clientY - gapY < 0) {
                    qode.style.top = 0
                } else if (e.clientY - gapY > maxY) {
                    qode.style.top = maxY + "px"
                }
            }
        }
        document.onmouseup = function (e) {
            e = e || event;
            e.preventDefault()
            document.onmousemove = null
        }

    }

    $('#uploadimgfx').on('change', function () {
        upLoadsImgfx(this);
    })

    function upLoadsImgfx(_this) {
        var qodetop = qode.offsetTop
        var reader = new FileReader();
        reader.readAsDataURL(_this.files[0]);
        reader.onload = function (e) {
            var url = e.target.result;
            $.ajax({
                type: "post",
                url: "__APP__/home/camp/upLoadImg",
                data: "base64=" + url + "&url=1",
                dataType: "json",
                success: function (data) {
                    if (data.status) {
                        layer.msg('上传成功');
                        $(_this).next().find("#ImgPrfx").attr('src', data.url);
                        $(_this).next().find("input[name=bgsharepic]").val(data.url);
                        $(_this).next().find("font").removeClass("hidden");
                        setTimeout(function () {

                            if ($("#ImgPrfx").height() < qodetop + 120) {
                                qode.style.left = 0
                                qode.style.top = 0
                            }
                        }, 1000)

                    } else {
                        layer.msg('上传失败，请重试');
                        return;
                    };
                },
                error: function () {
                    layer.msg('上传失败，请重试');
                }
            });
        };
    }

    if (getId('tab') == 1) {
        $('#step1-btn').tab('show');
    } else if (getId('tab') == 2) {
        $('#step2-btn').tab('show');
    } else if (getId('tab') == 3) {
        $('#step3-btn').tab('show');
    } else {
        $('#step1-btn').tab('show');
    }
    function changeURLArg(url, arg, arg_val) {
        var pattern = arg + '=([^&]*)';
        var replaceText = arg + '=' + arg_val;
        if (url.match(pattern)) {
            var tmp = '/(' + arg + '=)([^&]*)/gi';
            tmp = url.replace(eval(tmp), replaceText);
            return tmp;
        } else {
            if (url.match('[\?]')) {
                return url + '&' + replaceText;
            } else {
                return url + '?' + replaceText;
            }
        }
        return url + '\n' + arg + '\n' + arg_val;
    }

    function imgnew(params) {
        var p = new Promise(function (resolve, reject) {
            //做一些异步操作
            setTimeout(function () {
                var start_time = new Date().getTime();
                var img_url = params + '?' + start_time;
                var img = new Image();
                img.src = img_url;
                var check = function () {
                    if (img.width > 0 || img.height > 0) {
                        var diff = new Date().getTime() - start_time;
                        clearInterval(set);
                    }
                };
                var set = setInterval(check, 40);
                img.onload = function () {
                    var diff = new Date().getTime() - start_time;
                    resolve(img);
                }
            }, 2000);
        });
        return p;
    }

    // 增值服务
    function addtype(e) {
        $('#addserviceitem').append(typestr)
    } function removetype(e) {
        if ($('.types').length == 1) {
            layer.msg('至少保留一项，如不需要请关闭')
            return
        }
        $(e.target).parent().remove()
    }
    function showservice() {
        $('#addserviceitem').show()
    }
    function hideservice() {
        $('#addserviceitem').hide()
    }
    function actNav(e) {
        $(e.target).siblings().removeClass('right-nav-act')
        $(e.target).addClass('right-nav-act')
    }
    // 生成上传图片盒子
    function renderImg(imgSrc) {

        if (imgSrc) {
            $('.pic-box').append(
                `<span class="imgvi">
                        <label>
                            <img src="${imgSrc}" />
                            <input type="file" />
                            <input class="imgUrl" type="hidden" value="${imgSrc}">
                            <font class="hidden">&#10005;</font>
                        </label>
                    </span>`
            )
        } else {
            $('.pic-box').append(
                `<span class="imgvi">
                        <label>
                            <img src="https://file.dev.xinduobang.cn/images/chrome-ext/1615368309226876.jpeg" />
                            <input type="file" />
                            <input class="imgUrl" type="hidden" value="">
                            <font class="hidden">&#10005;</font>
                        </label>
                    </span>`
            )
        }
        var swiperNo = 0;
        $('.pic-box input[type="hidden"]').each(function (i, v) {
            if ($(v).val() != '') {
                swiperNo++;
            }
        })
        $('#swiperNo').html(swiperNo)
    }
    $.ajax({
        url: '/Admin/CourseGoods/getCourseConfig',
        type: 'post',
        beforeSend: function () {
            upIndex = layer.load(1, {
                shade: [0.3, '#000']
            });
        },
        dataType: 'json',
        success: function (data) {
            layer.close(upIndex);
            if (data.code != 0) {
                layer.msg(data.msg);
                return;
            }
            var arr = []
            data.data.forEach((item) => {
                item.list.forEach((val) => {
                if (val.status == 2) {
                $('.no' + val.id).hide()
            }
        })
        })
            isYanxue && $('.no9').show(); // 研学要展示副标题
        }
    })

    // 右侧快捷导航
    $('.courseAdd').scroll(function () {
        var wScrollTop = $("#step1").scrollTop() + 100;
        if ($('#step3').is(":hidden") && $('#step2').is(":hidden")) {
            $('.right-nav-1 a').removeClass('right-nav-act')
            wScrollTop > $('#nav-detail').offset().top ? $('.right-nav-1 a').eq(1).addClass('right-nav-act') : $('.right-nav-1 a').eq(0).addClass('right-nav-act')
        }
        if ($('#step1').is(":hidden") && $('#step2').is(":hidden")) {
            $('.right-nav-2 a').removeClass('right-nav-act')
            var tops = [$('#nav-sale').offset().top, $('#nav-receive-discount').offset().top, $('#nav-send-discount').offset().top, $('#nav-parenting').offset().top, $('#nav-sales').offset().top, $('#nav-sign-up').offset().top, $('#nav-share').offset().top, $('#nav-bar').offset().top]
            for (var i = tops.length - 1; i >= 0; i--) {
                if (wScrollTop > tops[i]) {
                    $('.right-nav-2 a').eq(i).addClass('right-nav-act');
                    break;
                }
            }
        }
    })

    // 透明小程序码提示
    $('#is_hyaline').on('change', function (event) {
        event.preventDefault();
        $(this).is(':checked') && layer.open({
            title: '透明小程序码注意事项'
            , content: '由于微信的限制，小程序码所在区域的底色应与小程序码颜色应有明显区别，否则可能造成无法识别小程序码的情况'
            , btn: ['我知道了']
        });
    });

    // 营期时间检查
    $('#period-con').on('blur', '.datepicker', function (event) {
        event.preventDefault();
        var val = $(this).val()
        if (!val) return;
        var start = val.split(' - ')[0]
        var end = val.split(' - ')[1]
        if (!start || !end) {
            $(this).val('')
            layer.msg('时间输入有误请重新选择')
            return;
        }
        if (moment(start).valueOf() > moment(end).valueOf()) {
            $(this).val('')
            layer.msg('时间输入有误请重新选择')
        }
    });

    !isYanxue && getYmceList();

    // 获取所属板块 所属产品
    function getYmceList() {
        $.ajax({
            url: '__APP__/Admin/CashStand/getYmceList',
            type: 'post',
            dataType: 'json',
            data: {
                pid
            },
            success: function (data) {
                if (data.code != 0) {
                    layer.msg(data.msg);
                    return;
                }

                if (data.is_have != 1) {
                    return;
                }

                $('select[name="bk_id"]').html(getYmceListOption(data.bk_list)).parents('.form-group').removeClass('hide');
                $('select[name="bk_product_id"]').html(getYmceListOption(data.bk_product_list)).parents('.form-group').removeClass('hide');

            }
        })
    }

    // 获取下拉选择的option
    function getYmceListOption(options) {
        let t = '';
        options.forEach(item => {
            t += `<option value="${item.id}" ${item.is_select ? 'selected="selected"' : ''}>${item.name}</option>`
    });

        return t;
    }

    // 全局单选样式切换
    $('.my_radio').click(function () {
        $(this).parents('.radio_box').siblings().removeClass('r_on');
        $(this).parents('.radio_box').addClass('r_on');
    })

    // 研学初始化
    if (isYanxue) {
        $('#campNameLabel').html(`<span class="must">*</span> 活动名称:`);
        $('#campSecondaryNameLabel').text('活动副标题:');
        $('#enroll_order2').trigger('click'); // 研学默认下单时填写报名表
        $('#courser-goods-nav').find('a:eq(0)').attr('href', '__APP__/Admin/CourseGoods/yanxue');
    } else {
        $('#textarea1').removeClass('hide');
    }

    setYanxueStyle();

    // 设置研学或非研学的样式
    function setYanxueStyle() {
        if (isYanxue) {
            $('.show-yanxue').show();
            $('.hide-yanxue').hide();
            $('.yanxue-is-power').html('权重:');
            $('.hide-yanxue-only').hide(); // 研学不显示 但非研学默认不显示 .hide-yanxue 会直接显示出来
        } else {
            $('.show-yanxue').hide();
            $('.hide-yanxue').show();
            $('.hide-yanxue-inline-block').css('display', 'inline-block');
        }
    }

    // 研学产品详情开启关闭
    $('input[name="is_show_detail"]').on('change', function () {
        $('#textarea1')[$(this).val() == 1 ? 'removeClass' : 'addClass']('hide');
    });

    // 大转盘切换赠送类型
    $('input[name="give_lottery_type"]').on('change', function () {
        const flag = $(this).val() == '0';
        $('select[name="lottermoneytype"]').prop('disabled', !flag);
        $('input[name="lottermoney"]').prop('disabled', !flag);
        $('input[name="lotternum"]:eq(0)').prop('disabled', !flag);
        $('input[name="lotternum"]:eq(1)').prop('disabled', flag);
        $('#give_lottery_only_child').prop('disabled', flag);
    });

    // 开启显示额外控制项
    $('.input-has-hide-extra').on('change', function () {
        const _this = $(this);
        const name = _this.attr('name');
        const v = $(`input[name="${name}"]:checked`).data('control-extra');
        $(`.${name}-extra`)[v]('hide');
    });

    // 自助退款免销售审核
    function fnOpenWebTitle() {
        layer.open({
            title: '提示',
            type: 1,
            content: `<div style="padding:20px;">选择退款模板后，当员工发起退款或会员自助发起退款时，系统将自动根据退款模板规则算出退款的各项金额，并自动填入，不关闭审核流时，员工可在审核时进行二次修改。<br/>“自助退款免销售审核”勾选后，请在“设置”-“基础设置”中开启自助退营功能，否则“自助退款免销售审核”不生效</div>`,
            btn: 0
        })
    }
</script>
</body>

</html>